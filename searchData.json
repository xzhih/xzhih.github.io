[{"title":"è®©ä½ çš„ç½‘ç«™æ”¯æŒmacOSå’ŒIOSçš„æ·±è‰²æ¨¡å¼","url":"/website-darkmode-on-macos/","content":"\n## å‰è¨€\n\nå¦‚æœä½ åœ¨ä½¿ç”¨ macOS 10.14.4 æˆ–è€…ä¹‹åçš„ç³»ç»Ÿï¼Œåœ¨ç³»ç»Ÿå†…å¼€å¯æ·±è‰²æ¨¡å¼ï¼Œæ‰“å¼€ Safari æµè§ˆå™¨ï¼Œä½ ä¼šå‘ç°æˆ‘çš„åšå®¢å˜æˆäº†æš—é»‘ç‰ˆæœ¬ã€‚\n\n<p class=\"success\">æœ¬æ–‡å‘è¡¨äº2019-03-26ï¼Œè€Œåœ¨2019-06-04å‡Œæ™¨ï¼ŒApple å‘å¸ƒäº† IOS 13ï¼Œæœ¬æ–‡æ‰€è¯´çš„æ–¹æ³•ä¹ŸåŒæ—¶é€‚ç”¨äº IOS Safari</p>\n\n<p class=\"success\">2019-08-08 ä»Šå¤©çªç„¶å‘ç° Chrome ä¹Ÿæ”¯æŒäº†</p>\n\næ·±è‰²æ¨¡å¼ï¼ˆDark Modeï¼‰æ˜¯ Apple åœ¨ macOS Mojave ä¸Šå…¨æ–°æ¨å‡ºçš„ä¸€é¡¹åŠŸèƒ½ï¼ŒmacOS å†…ç½®çš„ App èƒ½å®Œç¾æ”¯æŒï¼Œå‡­å€Ÿç€æ˜“ç”¨çš„æ¥å£ï¼Œè¶Šæ¥è¶Šå¤šçš„ç¬¬ä¸‰æ–¹ App å·²ç»è¿›è¡Œäº†é€‚é…ï¼Œå¯å¤§å®¶ä½¿ç”¨æœ€å¤šçš„æµè§ˆå™¨å´æ²¡èƒ½å¾ˆå¥½çš„æ”¯æŒï¼Œè™½ç„¶ä½ å¯ä»¥ä½¿ç”¨ Safari çš„é˜…è¯»è§†å›¾æµè§ˆæ·±è‰²æ¨¡å¼ä¸‹çš„é¡µé¢å†…å®¹ï¼Œä½†ä½“éªŒç»ˆå½’æ²¡æœ‰ç½‘ç«™è‡ªèº«æ”¯æŒçš„å¥½ã€‚\n\nåŸå› ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œä¸€æ˜¯æµè§ˆå™¨æ²¡æœ‰ç»™å‡ºè®©å¼€å‘è€…é€‚é…çš„æ¥å£ï¼ŒäºŒæ˜¯ç½‘ç«™è®¾è®¡å¹¶ä¸ç»Ÿä¸€ï¼Œå¼ºè¡Œè¿›å…¥æ·±è‰²æ¨¡å¼ä¼šç ´åé¡µé¢çš„è®¾è®¡å’Œå†…å®¹çš„å¯è¯»æ€§ã€‚\n\näºæ˜¯ç»è¿‡å‡ æ¬¡çš„å‡çº§ï¼ŒmacOS ç»ˆäºåœ¨ Safari 12.1 ä¸­åŠ å…¥äº†ä¸€ä¸ªæ–°çš„åª’ä½“æŸ¥è¯¢ `prefers-color-scheme`ï¼Œå¹¶ä¸” FireFox 67 ä¹Ÿå¼€å§‹è¿›è¡Œæ”¯æŒï¼Œå…¶ä»–æµè§ˆå™¨çš„å…·ä½“æ”¯æŒæƒ…å†µå¯åœ¨è¿™é‡ŒæŸ¥çœ‹ï¼šhttps://caniuse.com/#search=prefers-color-scheme\n\n## ç®€å•ä½¿ç”¨\n\n```\nName:   prefers-color-scheme\nFor:    @media\nValue:  no-preference | light | dark\n```\n\n- no-preferenceï¼šæ— é¢œè‰²åå¥½\n- lightï¼šæµ…è‰²æ¨¡å¼\n- darkï¼šæ·±è‰²æ¨¡å¼\n\nå’Œä½ æ˜¯ç”¨çš„å…¶ä»–åª’ä½“æŸ¥è¯¢ä¸€æ ·ï¼Œç”¨èµ·æ¥å¾ˆç®€å•\n\n```CSS\n@media (prefers-color-scheme: light) {\n    /* æµ…è‰²æ¨¡å¼æ ·å¼ */\n}\n\n@media (prefers-color-scheme: dark) {\n    /* æ·±è‰²æ¨¡å¼æ ·å¼ */\n}\n```\n\né»˜è®¤éƒ½æ˜¯æµ…è‰²æ¨¡å¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªå†™æ·±è‰²æ¨¡å¼çš„æ ·å¼å°±è¡Œ\n\n## ä½¿ç”¨CSSå˜é‡\n\nç°åœ¨ä¹Ÿé¡µé¢éƒ½ä¼šæ¶‰åŠåˆ°å¤§é‡çš„æ ·å¼ï¼Œè¦é€‚é…æ·±è‰²æ¨¡å¼ï¼Œæœ€å¥½ä½¿ç”¨å˜é‡ã€‚\n\n```CSS\n:root {\n  --background-color: #FFFFFF;\n  --content-color: #15171A;\n}\n\n@media (prefers-color-scheme: dark) {\n  :root {\n    --background-color: #222;\n    --content-color: #dfdfdf;\n  }\n}\n\n.main-page {\n    background: var(--background-color);\n}\n\n.full-content {\n    color: var(--content-color)\n}\n```\n\nä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåªå®šä¹‰äº†å‡ ä¸ªé¢œè‰²ç›¸å…³çš„æ ·å¼ï¼Œäº‹å®ä¸Šä½ å¯ä»¥è·Ÿå…¶ä»–åª’ä½“æŸ¥è¯¢ä¸€æ ·ï¼Œå®šä¹‰å…¶ä»–çš„æ ·å¼ï¼Œè®©ä½ çš„æ·±è‰²æ¨¡å¼æœ‰æ›´å¤šä¸åŒçš„å¸ƒå±€ã€‚\n\n## é¢œè‰²\n\né¢œè‰²è¿™ä¸ªå°±çœ‹è‡ªå·±å–œæ¬¢äº†ï¼Œä¸è¿‡è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœä½ æ˜¯ä½¿ç”¨ macOS å†…ç½® App çš„é…è‰²ï¼Œå¼ºè°ƒè‰²ä¼šæ”¹å˜ä¸€äº›åŸºç¡€é…è‰²ï¼Œæ¯”å¦‚å¼ºè°ƒè‰²ä¸æ˜¯çŸ³å¢¨è‰²çš„æ—¶å€™ï¼ŒèƒŒæ™¯é¢œè‰²ä¼šå˜å¾—æ¯”è¾ƒæš–ã€‚\n\nåœ¨è®¾ç½®é¢œè‰²çš„æ—¶å€™ï¼Œè¦ä¿è¯å†…å®¹çš„å¯è¯»æ€§ï¼Œæˆ‘ä»¬éœ€è¦å°†æ–‡æœ¬å’ŒèƒŒæ™¯çš„é¢œè‰²å¯¹æ¯”åº¦ä¿æŒåœ¨ä¸€ä¸ªå®‰å…¨çš„èŒƒå›´å†…ï¼Œè¿™æ—¶å€™ä½ éœ€è¦ç”¨åˆ°è¿™ä¸ªå·¥å…·ï¼š https://github.com/leaverou/contrast-ratio\n\n## å›¾ç‰‡\n\nåœ¨å†™å¥½é¢œè‰²ç›¸å…³çš„æ ·å¼ä¹‹åï¼Œä½ ä¼šå‘ç°é¡µé¢ä¸Šçš„å›¾ç‰‡å˜å¾—å¾ˆåˆºçœ¼ï¼Œè¿™æ—¶ä½ å¯ä»¥é™ä½ä¸€ä¸‹å›¾ç‰‡çš„é€æ˜åº¦ï¼Œå…·ä½“é™å¤šå°‘ä¹Ÿæ˜¯çœ‹ä½ èƒŒæ™¯è®¾ç½®çš„è‰²æ·±ï¼Œå¦å¤–å¯ä»¥è®¾ç½®ä¸€ä¸‹é¼ æ ‡æ‚¬åœæ—¶æ¢å¤é€æ˜åº¦ï¼Œè¿™æ ·èƒ½æœ‰æ›´å¥½çš„ä½“éªŒã€‚\n\næˆ‘ç”¨çš„ blazy æ‡’åŠ è½½ï¼Œæ‰€ä»¥æ˜¯è¿™æ ·è®¾ç½®çš„\n\n```CSS\n@media (prefers-color-scheme: dark) {\n    .b-lazy.b-loaded {\n        opacity: .9;\n        transition: opacity .5s ease-in-out;\n    }\n\n    .b-lazy.b-loaded:hover {\n        opacity: 1;\n    }\n}\n```\n\n## åè¯\n\nåœ¨æ·±è‰²æ¨¡å¼æ¨å‡ºä¹‹åï¼Œå¾—åˆ°äº†ä¸é”™çš„åå“ï¼Œæˆ‘è®¤ä¸º IOS 13 ä¼šå¼•å…¥ä¸€å®šæ·±è‰²æ¨¡å¼ã€‚å¦å¤–ï¼ŒWindows ä¹Ÿæœ‰â€œæš—â€æ¨¡å¼ï¼Œç›¸ä¿¡è¶Šæ¥è¶Šå¤šçš„åº”ç”¨ä¼šè¿›è¡Œè¿™æ ·æ·±è‰²æ¨¡å¼çš„é€‚é…ï¼Œåœ¨ macOS 10.14.4 å‡çº§ä¹‹åï¼Œæˆ‘åœ¨ç¬¬ä¸€æ—¶é—´è¿›è¡Œäº†åšå®¢ä¸»é¢˜æ›´æ–°ï¼Œåªæœ‰å¤§å®¶éƒ½ç”¨äº†è¿™ä¸ªæ–°çš„åª’ä½“æŸ¥è¯¢ï¼Œæ‰ä¼šæ¨åŠ¨å…¶ä»–å¹³å°å’Œæµè§ˆå™¨çš„é€‚é…ï¼Œå¥½ä¸œè¥¿å€¼å¾—æ¨å´‡ã€‚\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n","tags":["web","macOS"],"categories":["WEB"]},{"title":"å¡æ¢…éš†è¿™æ¬¡ç¿»è½¦äº†ï¼Ÿã€Šé˜¿ä¸½å¡”ï¼šæˆ˜æ–—å¤©ä½¿ã€‹","url":"/https://mp.weixin.qq.com/s/j1peUPif3e6LgsH7iFEKaQ#a/","content":"\nã€Šé˜¿å‡¡è¾¾ã€‹åˆ°ç°åœ¨å·²ç»æœ‰10å¹´çš„äº†ï¼Œå½“å¹´é‚£ä»¤äººéœ‡æ’¼çš„3Dæ•ˆæœã€é€¼çœŸçš„åœºæ™¯å¼€åˆ›äº†æ–°3Dæ—¶ï¼Œå¹¶ä¸”ä»æ˜¯å½±å²æœ€é«˜ç¥¨æˆ¿ï¼Œå…¨çƒç¥¨æˆ¿27.88äº¿ç¾å…ƒã€‚\n\næœ€è¿‘å¡æ¢…éš†çš„æ”¹ç¼–è‡ªæ¼«ç”»ã€Šé“³æ¢¦ã€‹çš„ç”µå½±ã€Šé˜¿ä¸½å¡”ï¼šæˆ˜æ–—å¤©ä½¿ã€‹ä¸Šæ˜ äº†\n\n\næ•…äº‹å‘ç”Ÿåœ¨2563å¹´ï¼Œ300å¹´å‰ä¸€åœºç¾éš¾æ€§æˆ˜äº‰è®©åœ°çƒå½»åº•æ¯ç­ï¼Œæ•´ä¸ªä¸–ç•Œåªå‰©ä¸‹ä¸€åº§â€œæ’’å†·â€å¤©ç©ºåŸã€‚\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/å¤©ç©ºåŸ.gif)\n\nä¸Šç­‰äººåœ¨â€œæ’’å†·â€ä¸­è¿‡ç€å¥¢åçš„ç”Ÿæ´»ï¼Œæ¯å¤©æ¸…å€’ä¸‹æ¥çš„åƒåœ¾æ˜¯åœ°è¡¨å¹³æ°‘çš„é‡è¦ç‰©è´¨ï¼Œäººä»¬èšé›†äºæ­¤ï¼Œæ¸æ¸çš„å½¢æˆäº†é’¢é“åŸã€‚\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/åƒåœ¾åœº.jpg)\n\nå¹³æ°‘åªèƒ½ç”Ÿæ´»åœ¨ç–®ç—çš„åºŸé“åŸä¸­ï¼Œä¸ºå¤©ç©ºåŸå·¥ä½œå¹¶è¾“é€ç‰©èµ„ï¼Œä¸¤è€…é€šè¿‡å‡ æ ¹è¿è€é¼ éƒ½ä¸è®©è¿‡çš„ç®¡é“è¿æ¥ã€‚\n\nè€Œä¸Šç­‰äººç›‘è§†ç€åœ°ä¸Šçš„ä¸€åˆ‡ã€‚\n\næ¯ä¸ªç”Ÿæ´»åœ¨åº•å±‚çš„äººç±»ï¼Œéƒ½æ¢¦æƒ³å‰å¾€åˆ°è¿™ä¸ªè¿‘åœ¨çœ¼å‰å´åˆé¥ä¸å¯åŠçš„å¤©ç©ºåŸï¼Œä»¥è¿‡ä¸Šæ›´å¥½çš„ç”Ÿæ´»ã€‚\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/å¤©ç©ºåŸ1.jpg)\n\næœºå™¨äººç§‘å­¦å®¶ä¾å¾·åšå£«åœ¨åƒåœ¾å †ä¸­å‘ç°äº†ä¸€ä¸ªæ‹¥æœ‰å®Œæ•´äººç±»å¤§è„‘çš„æ®‹ç¼ºå¥³æ€§æœºå™¨äººï¼Œå¹¶ä¿®å¤äº†å·²ç»æ²¡æœ‰ä»»ä½•è®°å¿†çš„å¥¹ï¼Œè¿˜ç”¨å·²æ•…å¥³å„¿çš„åå­—â€œé˜¿ä¸½å¡”â€ç»™å¥¹å‘½åï¼Œé˜¿ä¸½å¡”æœ‰ç€æƒŠäººçš„æˆ˜æ–—å¤©èµ‹ï¼ŒåŸæ¥ï¼Œå¥¹æ˜¯300å¹´å‰çš„ç«æ˜Ÿç‹‚æˆ˜å£«ã€‚\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/æ¡åˆ°é˜¿ä¸½å¡”.jpg)\n\né˜¿ä¸½å¡”å¯¹è¿™ä¸ªä¸–ç•Œçš„ä¸€åˆ‡éƒ½æå…·å¥½å¥‡å¿ƒï¼Œå¥½æœ‹å‹é›¨æœä¸ºå¥¹ä»‹ç»ä¸€åˆ‡ï¼Œåœ¨ç›¸å¤„ä¸­é˜¿ä¸½å¡”çˆ±ä¸Šäº†é›¨æœã€‚\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/å’Œé›¨æœ.gif)\n\né›¨æœçš„æ¢¦æƒ³æ˜¯è¿›å…¥å¤©ç©ºåŸä¸­è¿‡ä¸Šå¯Œè£•çš„ç”Ÿæ´»ï¼Œå› æ­¤ä¸­äº†ç»´å…‹ç‰¹çš„è°è¨€ï¼Œç»´å…‹ç‰¹ä¹Ÿä¸è¿‡æ˜¯ Nova çš„ä¸€é¢—æ£‹å­ç½¢äº†ï¼Œè€Œ Nova æƒ³è¦å¾—åˆ°é˜¿ä¸½å¡”çš„å°¸ä½“ã€‚\n\né˜¿ä¸½å¡”åœ¨ä¸€æ¬¡æ¬¡çš„æˆ˜æ–—ä¸­è‡ªæˆ‘è§‰é†’ï¼Œä¹Ÿå›å¿†èµ·æ›¾ç»çš„ä»»åŠ¡ï¼šæ€æ‰ Novaï¼Œè€Œè¿›å…¥å¤©ç©ºåŸçš„æ–¹å¼åªæœ‰ä¸€ä¸ªï¼šå‚åŠ æœºåŠ¨çƒæ¯”èµ›å¹¶æ‹¿åˆ°å† å†›ã€‚\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/å‡ºæ‹³.jpg)\n\n## ä¸‡ä¼—æœŸå¾…\n\nè¿™å°±æ˜¯è¢«è±†ç“£è¯„ä¸º2019æœ€å€¼å¾—æœŸå¾…çš„å¤–è¯­ç”µå½±ä¹‹ä¸€ã€‚\n\nå½±è¿·ä»¬æœ‰è¿™ä¹ˆå¤§çš„æœŸå¾…ï¼Œæœ€å¤§çš„åŸå› å°±æ˜¯è¢«ç§°ä¸ºå¡ç¥çš„å¡æ¢…éš†\n\næ—©åœ¨2000å¹´å¡ç¥å°±æœ‰è¦å‡ºç›¸å…³ä½œå“çš„åŠ¨ä½œï¼Œè€Œåœ¨2003å¹´ä¼ å‡ºäº†ç›¸å…³ç”µå½±çš„æ¶ˆæ¯ï¼Œå¯æ˜¯åœ¨2005ã€2006ã€2008ã€2009å¹´ï¼Œå¡ç¥åœ¨ä¸€æ¬¡æ¬¡çš„é‡‡è®¿ä¸­è¡¨ç¤ºç”µå½±æ¨è¿Ÿï¼Œè¿™å…¶ä¸­çš„å¾ˆå¤§åŸå› å°±æ˜¯ã€Šé˜¿å‡¡è¾¾ã€‹ï¼Œä¹Ÿå› æ­¤æœ‰ã€Šé˜¿å‡¡è¾¾ã€‹æ˜¯ä¸ºã€Šé˜¿ä¸½å¡”ã€‹åšæŠ€æœ¯é“ºå«çš„è¨€è®ºï¼Œåœ¨2010å¹´å¡ç¥ä¹Ÿå› ä¸ºã€Šé˜¿å‡¡è¾¾ã€‹ç»­é›†çš„é¡¹ç›®æŠŠå¯¼æ¼”ä½ç½®è®©ç»™äº†ç½—ä¼¯ç‰¹Â·ç½—å¾·é‡Œæ ¼å…¹\n\näºæ˜¯ã€Šé˜¿ä¸½å¡”ã€‹ä¸€æ‹–å†æ‹–ï¼Œç›´åˆ°æœ€è¿‘æ‰ä¸Šæ˜ \n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/å¡æ¢…éš†.jpg)\n\nä¹Ÿè®¸æ˜¯æœŸå¾…è¿‡é«˜ï¼Œå½±è¿·ä»¬åœ¨çœ‹åçº·çº·è¡¨ç¤ºæ•´ä½“å¹³åº¸ã€å‰§æƒ…è€å¥—\n\nç›®å‰åœ¨è±†ç“£å’ŒIMDbä¸Šéƒ½åªæ‹¿åˆ°äº†7.6åˆ†ï¼Œçƒ‚ç•ªèŒ„æŒ‡æ•°60%\n\nä¹Ÿæœ‰ç½‘å‹è¡¨ç¤ºç‰¹æ•ˆçˆ†ç‚¸ã€å€¼å›ç¥¨ä»·ï¼ŒçŒ«çœ¼ç”µå½±9åˆ†ï¼Œçˆ†ç±³èŠ±æŒ‡æ•°94%\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/è¯„åˆ†.jpg)\n\n## è¿™æ˜¯ä¸€éƒ¨ä¼˜ç§€çš„ç§‘å¹»ç”µå½±\n\næ— è®ºæ˜¯CGç‰¹æ•ˆã€åŠ¨ä½œè®¾è®¡ï¼Œéƒ½å¯ä»¥è¯´æ˜¯åœ°çƒä¸Šæœ€å¥½çš„äº†ï¼Œå¡æ¢…éš†å›¢é˜Ÿç¡®å®ç»™å¤§å®¶å¸¦æ¥äº†ä¸€åœºè§†è§‰ç››å®´\n\nè¿™æ˜¯æˆ‘çœ‹è¿‡**æœ€è‡ªç„¶**çš„CGç”µå½±\n\nç°åœ¨å¸‚é¢ä¸Šæœ‰å¤§é‡ä½¿ç”¨åŠ¨ä½œæ•æ‰çš„å½±è§†ä½œå“ï¼Œå·²ç»ä¸ç®—æ˜¯ä»€ä¹ˆæ–°é²œç©æ„ï¼Œä½†æ˜¯å¤§å¤šæ•°çš„çœ‹èµ·æ¥éƒ½ä¸è‡ªç„¶\n\nè€Œé˜¿ä¸½å¡”å°±å¾ˆè‡ªç„¶ï¼Œç”šè‡³è®©äººæ„Ÿè§‰åˆ° -- çœŸå®\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/é†’æ¥.jpg)\n\nç”µå½±ä¸­æœ‰å¤§é‡çš„å’Œé˜¿ä¸½å¡”ä¸€æ ·çš„åˆæˆäººï¼Œæ‰€ä»¥ä¼šæœ‰å¤§é‡çš„ä¹‰è‚¢ï¼Œä½ ä¼šå‘ç°è¿™äº›ä¹‰è‚¢çš„åŠ¨ä½œçµæ´»è‡ªç„¶ï¼Œä¸ä¼šæœ‰å¼ºçƒˆçš„æœºæ¢°æ„Ÿï¼Œå°±åƒâ€œåŸè£…â€ä¼¼çš„\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/æ­¦æœ¯.gif)\n\né˜¿ä¸½å¡”å¤§é‡çš„é¢éƒ¨ç‰¹å†™ï¼Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°æ¯ä¸ªæ¯›å­”ã€ç«æ¯›å’Œè¡¨æƒ…å½¢æˆçš„è¤¶çš±\n\nè€Œæœ€ä»¤äººæƒŠè®¶çš„æ˜¯é‚£åŒæ°´æ±ªæ±ªçš„å¤§çœ¼ç›ï¼Œç³å­”ç¼©æ”¾æ—¶è™¹è†œçš„å˜åŒ–ï¼Œç»†èŠ‚ä¸°å¯Œå¾—å¯æ€•ï¼Œç”šè‡³èƒ½çœ‹åˆ°çœ¼çƒåæ˜ çš„çœ¼å‰åœºæ™¯\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/çœ¼ç›ç‰¹å†™.gif)\n\nåœ¨çœ¼æ³ªæ»´è½æ—¶é‚£ä¸è§„åˆ™çš„æ³ªæ»´åŠæ³ªç—•ä¹Ÿè¡¨ç°äº†å‡ºæ¥\n\nå…¶ä¸­ä¸€ä¸ªé•œå¤´ï¼Œé˜¿ä¸½å¡”å’Œé›¨æœåœ¨æˆ¿é¡¶ä¸Šæœ›å‘å¤©ç©ºåŸï¼Œå¾®é£å¹åŠ¨å¤´å‘ï¼Œå‘ä¸åœ¨é£ä¸­çš„è¿åŠ¨\n\nè¿˜æœ‰ä¸€ä¸ªæƒ…èŠ‚ï¼Œé˜¿ä¸½å¡”æ½œå…¥æ°´ä¸­æ‹¿ç‹‚æˆ˜å£«è£…ç”²ï¼Œæ°´æ‰“æ¹¿é˜¿ä¸½å¡”ï¼Œæµ¸æ°´åå¤´å‘å’Œè¡£ç‰©æ»´æ°´çš„çŠ¶å†µï¼Œå’Œç°å®ç®€ç›´ä¸€æ ·ï¼Œè¿™æ ·çš„ç»†èŠ‚è¿˜æœ‰å¾ˆå¤šå¾ˆå¤š\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/å–æˆ˜ç”².jpg)\n\n## ä»–ä»¬åœ¨åˆ›é€ æŠ€æœ¯\n\nä¸å¾—ä¸è¯´ï¼Œå¡æ¢…éš†å¯¹æŠ€æœ¯çš„ç—´è¿·å·²ç»è¾¾åˆ°äº†ç–¯ç‹‚ã€‚\n\næ®è¯´ã€Šé˜¿ä¸½å¡”ã€‹ä¸­çš„å¤§é‡CGåœ¨å¸‚é¢ä¸Šæ‰¾ä¸åˆ°ç°æˆçš„è½¯ä»¶ï¼Œä»–ä»¬åªèƒ½è‡ªç ”ç®—æ³•ã€å¼€å‘è½¯ä»¶ï¼Œå¯¹äºé‚£äº›å—åˆ°æŠ€æœ¯é™åˆ¶çš„ç”µå½±æ¥è¯´ï¼Œé’ˆå¯¹æ€§å¼€å‘çš„ä¼˜åŠ¿ä¸è¨€è€Œå–»\n\né˜¿ä¸½å¡”çš„çœ¼ç ç‰¹å†™é•œå¤´è¿ç”¨åˆ°äº†830ä¸‡å¤šè¾¹å½¢æ•°é‡çš„å‡ ä½•å»ºæ¨¡ï¼Œä¸€åªçœ¼ç›ç”±å°†è¿‘900ä¸‡ä¸ªåƒç´ åˆ¶ä½œï¼Œçœ¼ç›çš„è¿‘æ™¯é•œå¤´ä¹Ÿæ²¡æœ‰ç”¨ä¼ ç»Ÿçš„åŠ¨æ€è´´å›¾åˆ¶ä½œï¼Œè€Œæ˜¯å®Œæ•´çš„åˆ›å»ºäº†åŒ…æ‹¬è™¹è†œå†…çš„ä¸æ¨¡å‹åœ¨å†…çš„æ•´ä¸ªçœ¼çƒç»“æ„\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/åŠ¨ä½œæ•æ‰.jpg)\n\næ¯”è¾ƒå¯æƒœçš„æ˜¯ï¼Œå‰§ç»„èŠ±å¤§åŠ›æ°”å»ºé€ çš„åŸå¸‚å®æ™¯ï¼Œæ„Ÿè§‰æ²¡èƒ½åœ¨ç”µå½±ä¸­å®Œå…¨è¡¨ç°å‡ºæ¥\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/åŸå¸‚å®æ™¯.jpg)\n\nåªèƒ½é€šè¿‡ä¸€äº›ä¿¯ç°é•œå¤´ï¼Œå’Œè¿œå¤„æœ›å»çš„åŸå¸‚å‰ªå½±å±•ç°ã€‚\n\nç”µå½±ä¸­å¤§é‡è¿½å‡»æ‰“æ–—é•œå¤´ï¼ŒæœºåŠ¨çƒå¤§æˆ˜ã€é…’å§å¤§æˆ˜ï¼Œæ··åˆç€çœŸäººå’ŒCGè§’è‰²çš„å„ç§æ‰“æ–—ï¼Œå„ç§ç‡ƒç‚¹çˆ†ç‚¹ï¼Œçˆ½ç‚¸äº†ã€‚\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/æ‰“æ–—.jpg)\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/æ­»äº¡çƒ.gif)\n\n## å‰§æƒ…å¤ªç³Ÿç³•äº†\n\nä»åˆ¶ä½œå’Œå‘ˆç°çš„æ•ˆæœæ¥è¯´ï¼Œè¿™éƒ¨ç”µå½±å·²ç»ç›¸å½“ä¼˜ç§€ã€‚\n\näºæ˜¯å‰§æœ¬ä¸Šçš„ç¼ºç‚¹è¢«æ— é™æ”¾å¤§ã€‚\n\næˆ‘å¹¶ä¸æ˜¯åŸè‘—å…šï¼Œæˆ‘å‹æ ¹æ²¡çœ‹è¿‡åŸè‘—ï¼Œæˆ‘ç›¸ä¿¡æœ‰å¾ˆå¤šçš„äººéƒ½å’Œæˆ‘ä¸€æ ·ï¼Œæ‰€ä»¥å¯¹åŸè‘—ä¸­çš„ä¸–ç•Œè§‚å’Œè®¾å®šä¸€æ¦‚ä¸çŸ¥ã€‚\n\nçœ‹å®Œç”µå½±åï¼Œæˆ‘äº§ç”Ÿäº†è¿™æ ·çš„æ„Ÿè§‰ï¼šå¥³ä¸»ç¬¨ã€ç”·ä¸»å‚»ã€‚\n\nä»–ä»¬éƒ½ä¸è®¨æˆ‘å–œæ¬¢ã€‚\n\n![](https://pic.zhih.me/blog/posts/Alita-Battle-Angel/å’Œé›¨æœ2.jpg)\n\nè¿‘ä¸¤ä¸ªå°æ—¶çš„çŸ­æš‚æ—¶é—´é‡Œæ”¾å…¥å‡ åœºå¤§æˆ˜ï¼Œè¿˜è¦æ³¨æ„äººç‰©è‡ªèº«çš„å¡‘é€ å’Œäººç‰©ä¹‹é—´çš„å…³ç³»å‘å±•ï¼Œç¡®å®ä¼šæœ‰å¾ˆå¤šä¸œè¥¿éš¾ä»¥å–èˆã€‚\n\n\næœ«æ—¥åºŸåœŸï¼Ÿ\n\n300å¹´å‰çš„å¤§æˆ˜å¿«æŠŠåœ°çƒæ¯ç­ï¼Œåº”è¯¥è¥é€ çš„æ˜¯æœ«æ—¥åºŸåœŸçš„æ°›å›´å•Šï¼Œæˆ‘æ€ä¹ˆæ„Ÿè§‰é‚£é‡Œçš„äººæ°‘ç”Ÿæ´»å¾—æŒºå¹¸ç¦ï¼ŸåºŸé“åŸæ²¡é‚£ä¹ˆç³Ÿç³•ï¼Œä¸ºä»€ä¹ˆäººäººå‘å¾€å¤©ç©ºåŸï¼Ÿ\n\nè·¯è¾¹ç«Ÿç„¶èƒ½ä¹°åˆ°å·§å…‹åŠ›åƒï¼ŒåŸå¸‚æ™šä¸Šè¿˜èƒ½çœ‹åˆ°ä¸‡å®¶ç¯ç«ã€‚ã€‚ã€‚\n\n\nåœ¨æŒ‚é€¼é¢å‰ï¼Œæ•Œäººéƒ½æ˜¯æ¸£æ¸£\n\nå¥³ä¸»å¥½ä»»æ€§å•Šï¼Œè‡ªå·±æƒ³å¹²å˜›å°±å¹²å˜›ï¼Œå¯¹æ•‘å‘½æ©äººä¹Ÿä¸å°Šé‡ç‚¹ï¼Œæˆ‘å¸Œæœ›å¥¹èƒ½å¯çˆ±ç‚¹ï¼Œè¦ä¸é‚£åŒå¤§çœ¼ç›å²‚ä¸æ˜¯æµªè´¹äº†\n\nå¥¹å¤±å¿†äº†ï¼Œå¯å®åŠ›è¿˜åœ¨ï¼Œå¥¹æ˜¯ç«æ˜Ÿç‹‚æˆ˜å£«ï¼Œæˆ˜æ–—å¤©èµ‹ç‚¹æ»¡ï¼Œæ²¡äººèƒ½æ‹›æƒ¹å¥¹ã€‚\n\nè½»æ¾æŠŠåäººæ‰“è¶´ï¼Œå¾·æ™ºä½“ç¾åŠ³æ ·æ ·å‘å±•ï¼Œèº«ä½“è¢«æ‰“åäº†æ¢ä¸Šæ–°çš„å°±å¥½ï¼Œæ²¡åœ¨æ€•çš„ï¼Œæ–°è£…å¤‡è¿˜æœ‰å±æ€§åŠ æˆã€‚\n\nè¿˜æ²¡æ‰“ä½ å°±çŸ¥é“å¥¹ä¼šèµ¢ï¼Œè¿™è¿˜æœ‰ä»€ä¹ˆæ„æ€å•Šï¼Œçœ‹å¥¹çš„æ‚æŠ€è¡¨æ¼”ï¼Œä»¿ä½›å¼€äº†æŒ‚ã€‚\n\n\nä¸ªäººè‹±é›„ä¸»ä¹‰\n\nå¯èƒ½åŸè‘—ä¸æ˜¯æè¿°è‹±é›„çš„æ•…äº‹ï¼Œä½†è¿™éƒ¨ç”µå½±ç¡®å®æœ‰è¿™ç§æ„Ÿè§‰ï¼Œå´åˆä¸è¶³ï¼Œå¾€å¸¸æˆ‘ä»¬çœ‹çš„ä¸ªäººè‹±é›„ä¸»ä¹‰ç”µå½±ï¼Œéƒ½èƒ½çœ‹åˆ°ä¸»è§’çš„è‡ªæˆ‘è§‰é†’å’Œæˆé•¿ï¼Œç ´è€Œåç«‹ã€‚\n\nå¯ã€Šé˜¿ä¸½å¡”ã€‹ï¼Œæˆ‘æ²¡çœ‹åˆ°ã€‚\n\n\nçˆ¶å¥³å…³ç³»\n\nä¾å¾·åšå£«æŠŠå¥³å„¿çš„æƒ…æ„Ÿå¯„æ‰˜åœ¨é˜¿ä¸½å¡”èº«ä¸Šï¼Œåœ¨é˜¿ä¸½å¡”è¦æ¢ä¸Šç‹‚æˆ˜å£«è£…ç”²çš„æ—¶å€™åå¯¹äº†ï¼Œåœ¨é˜¿ä¸½å¡”è¢«æ ¼é²ä¾ä»€å¡æ‰“æ®‹åï¼Œå¸®æ¢ä¸Šç‹‚æˆ˜å£«è£…ç”²ï¼Œå†åˆ°é˜¿ä¸½å¡”å‚åŠ æœºåŠ¨çƒèµ›çš„æ—¶å€™ï¼Œä¸ºé˜¿ä¸½å¡”åˆ¶ä½œè½®æ»‘äº²è‡ªä¸ºä¹‹ç©¿ä¸Šï¼Œè¿™äº›å¿ƒç†å˜åŒ–æ²¡æœ‰é“ºå«ï¼Œè½¬æ¢å¾—å¾ˆåƒµç¡¬ã€‚\n\né˜¿ä¸½å¡”ç©¶ç«Ÿæ˜¯ä¸ºä»€ä¹ˆè€Œæˆ˜ï¼Œä¾å¾·åšå£«å†…å¿ƒä¸–ç•Œæˆ‘ä¹Ÿçœ‹ä¸åˆ°ã€‚\n\nå„ç§æƒ…æ„Ÿè¿‡æ¸¡ï¼ŒçœŸæ˜¯è®©æˆ‘æ‰æ‘¸ä¸é€ã€‚\n\n\næ‹çˆ±çº¿ï¼Œè´¥ç¬”\n\næ¥åˆ°é™Œç”Ÿçš„æ–°ä¸–ç•Œï¼Œé‡åˆ°ä¸€ä¸ªå¸…æ°”å°å“¥ï¼Œéª‘æ‘©æ‰˜å¸¦ä½ å…œé£ï¼Œå¸¦ä½ ç©è½®æ»‘æ‰£ç¯®ï¼Œè¯·ä½ åƒå·§å…‹åŠ›ã€‚\n\nç„¶åä½ å°±çˆ±ä¸Šäº†ä»–ï¼Œæ„¿æ„ä¸ºä»–æå‡ºå¿ƒè„æ‹¿æ¥è¿˜é’±ã€‚\n\nå°å“¥å¸¦ä½ å»é¢†èµé‡‘çŒäººè¯ä¹¦ï¼Œå¸¦ä½ åˆ°å±‹é¡¶è°ˆäººç”Ÿå’Œç†æƒ³ï¼Œé™ªä½ ä½ åˆ°é…’å§é—¹äº‹ã€‚\n\nç”šè‡³ï¼Œéª—ä½ å»å‚åŠ æ­»äº¡çƒèµ›ï¼Œä½ è¿˜åœ¨æƒ³èµšå¤Ÿé’±å¸¦ä»–å»å¤©ç©ºåŸã€‚\n\n\nåæ´¾ï¼Œæ— åŠ›åç³Ÿ\n\nåœ¨æ•´éƒ¨ç”µå½±ä¸­æ²¡æœ‰å“ªä¸ªåæ´¾èƒŒæ™¯æ˜¯è¢«ä»‹ç»æ˜ç™½äº†çš„ï¼Œè¿™ä½¿å¾—äººç‰©å¾ˆå•è–„ã€‚\n\nçƒ‚ä¿—å‰§æƒ…ï¼Œæ¯«æ— æ–°æ„ã€‚\n\n\næ€»ç»“\n\næŠŠæ—¥å¼çƒ­è¡€æ¼«ç”»å¼ºè¡Œæ”¹ç¼–æˆç¾å›½ä¸ªäººè‹±é›„ä¸»ä¹‰ç”µå½±ï¼Œä¸å–œæ¬¢ã€‚\n\nã€Šæ”»å£³æœºåŠ¨é˜Ÿã€‹å·²æ˜¯å‰è½¦ä¹‹é‰´ï¼Œç¼ºå°‘æƒ…æ„Ÿé“ºå«ï¼Œè‹ç™½çš„è§’è‰²ä¹Ÿä¸è®¨å–œï¼Œæ— æ³•è®©è§‚ä¼—äº§ç”Ÿå…±æƒ…ï¼Œåªèƒ½æ˜¯ä¸€éƒ¨çº¯ç²¹çš„â€œç‰¹æ•ˆå¤§ç‰‡â€ã€‚\n\næƒ…èŠ‚ä¸Šå¤ªå¤šä¸œè¥¿æ²¡èƒ½äº¤ä»£æ¸…æ¥šï¼Œä¹Ÿæ²¡æœ‰è·Œå®•èµ·ä¼çš„æ„Ÿè§‰ï¼Œã€Šé˜¿ä¸½å¡”ã€‹å®åœ¨æ˜¯å¯æƒœã€‚\n\nè™½è¯´ç‚«é…·çš„ç”»é¢å’Œæ¿€çƒˆçš„æ‰“æ–—è¿˜æ²¡è¾¾åˆ°ç‘•ä¸æ©ç‘œçš„åœ°æ­¥ï¼Œä½†çˆ½æ˜¯çœŸçˆ½ã€‚\n\nå¡æ¢…éš†è™½ç„¶ä¸æ˜¯å¯¼æ¼”ï¼Œä½†ä½œä¸ºç›‘åˆ¶ï¼Œä¾æ—§è®©å¤§å®¶çœ‹åˆ°äº†ç”¨å¿ƒã€‚\n\nç‰¹åˆ«æ˜¯åœ¨ä»Šå¤©ï¼Œäººä»¬è¿›å…¥å½±é™¢é€‰æ‹©çœ‹ç§‘å¹»ç”µå½±ï¼Œå°±æ˜¯ä¸ºäº†å¯»æ‰¾æ„Ÿå®˜ä¸Šä¸°å¯Œçš„åˆºæ¿€ã€‚\n\nåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œã€Šé˜¿ä¸½å¡”ã€‹ä½œä¸ºç”µå½±å·¥ä¸šçš„é¡¶çº§äº§å“ï¼Œå¯è°“æ˜¯è¯šæ„æ»¡æ»¡ã€‚\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","categories":["å½±è¯„"]},{"title":"ZeroTierå†…ç½‘ç©¿é€æ•™ç¨‹","url":"/zerotier-getting-started/","content":"\n## å‰è¨€\n\næœ‰æ—¶å€™éœ€è¦åœ¨å¤–è¾¹è®¿é—®å®¶é‡Œçš„è®¾å¤‡ï¼Œè€Œä¼—æ‰€å‘¨çŸ¥ä¸€èˆ¬å®¶é‡Œéƒ½æ²¡æœ‰å›ºå®š IP çš„ï¼Œè¿™æ—¶å€™å°±è¦å†…ç½‘ç©¿é€äº†ï¼Œè¯´åˆ°ç©¿é€çš„æ—¶å€™ï¼Œå¤§å®¶éƒ½ä¼šæåˆ° DDNS(åŠ¨æ€åŸŸåè§£æ)ï¼Œæˆ–è€…ä½¿ç”¨åå‘ä»£ç†çš„æ–¹å¼å¦‚ FRPã€Ngrokã€‚\n\né¦–å…ˆè¯´è¯´ DDNSï¼Œè¿™ç§æ–¹å¼ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œåªè¦è®¾ç½®å¥½ç›¸åº”çš„æœåŠ¡æä¾›å•†çš„ APIï¼Œå°±èƒ½åšåˆ°æ¯æ¬¡ IP å˜åŒ–åè‡ªåŠ¨è§£æï¼Œè¿™æ ·ä¸ç®¡å®¶é‡Œ IP æ€ä¹ˆå˜ï¼Œç”¨åŸŸåéƒ½èƒ½è®¿é—®å›å®¶ã€‚è¿™é‡Œæœ€å¤§çš„ç¡¬ä¼¤å°±æ˜¯**å…¬ç½‘IP**ï¼Œæœ‰äº›æœ‹å‹çš„å¸¦å®½å°±æ˜¯ä¸ªå¤§å±€åŸŸç½‘ï¼Œè·¯ç”±å™¨åªèƒ½è·å–åˆ°ä¸Šä¸€çº§å†…ç½‘çš„ IPï¼Œè¿™æ—¶å°± GG äº†ã€‚\n\nç„¶åæ˜¯ FRPã€Ngrok è¿™æ ·çš„åå‘ä»£ç†ç¨‹åºï¼Œé€šè¿‡æœåŠ¡å™¨è½¬å‘æ•°æ®æ¥è¾¾åˆ°å¤–ç½‘è®¿é—®çš„ç›®çš„ï¼Œè¿™æ ·å°±éœ€è¦è‡ªå·±æœ‰ä¸ª VPSï¼Œæˆ–è€…ä½¿ç”¨ä»–äººæ­å»ºçš„æœåŠ¡ï¼Œæ®æˆ‘æ‰€çŸ¥çš„å…è´¹æœåŠ¡éƒ½æ˜¯é™é€Ÿçš„ï¼Œè¦æ˜¯è‡ªå·±æ­å»ºçš„è¯ï¼Œä½“éªŒå°±è¦çœ‹æœåŠ¡å™¨çš„**ç½‘ç»œè´¨é‡**äº†ã€‚\n\nç°åœ¨æˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œ**ä¸éœ€è¦å…¬ç½‘ IPï¼Œä¸ä¾èµ–æœåŠ¡ç«¯ç½‘ç»œæ€§èƒ½çš„ ZeroTier**ã€‚\n\n## ç®€ä»‹\n\n[ZeroTier å®˜ç½‘](https://www.zerotier.com)ä¸Šè¯´\n\n>ZeroTier is a smart Ethernet switch for planet Earth.\n\n!!! é€‚ç”¨äºåœ°çƒçš„æ™ºèƒ½ç½‘ç»œäº¤æ¢æœº ...\n\nå®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç½‘ç»œè™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼Œå»ºç«‹åœ¨åŠ å¯†å®‰å…¨çš„å…¨çƒå¯¹ç­‰ç½‘ç»œä¹‹ä¸Šã€‚å®ƒæä¾›ä¸ä¼ä¸š SDN äº¤æ¢æœºåŒç­‰çš„é«˜çº§ç½‘ç»œè™šæ‹ŸåŒ–å’Œç®¡ç†åŠŸèƒ½ï¼Œè€Œä¸”å¯ä»¥è·¨æœ¬åœ°å’Œå¹¿åŸŸç½‘å¹¶è¿æ¥å‡ ä¹ä»»ä½•ç±»å‹çš„åº”ç”¨ç¨‹åºæˆ–è®¾å¤‡ã€‚\n\nå¥½å§ğŸ˜¥ï¼Œæœ‰ç‚¹ç‰›é€¼\n\nè€Œè¯´åˆ°ä¸»è¦åŠŸèƒ½ï¼Œå°±æ˜¯å¯ä»¥æŠŠå¤šä¸ªä¸åŒç½‘ç»œçš„è®¾å¤‡è¿æ¥åœ¨ä¸€èµ·ï¼Œç”¨æ¥å°±åƒåœ¨ä¸€ä¸ªå±€åŸŸç½‘ä¸‹\n\nä¾‹å¦‚ï¼Œæˆ‘åœ¨è·¯ç”±å™¨ä¸Šè£…äº† ZeroTierï¼Œè·¯ç”±å™¨æŒ‚äº†ä¸€ä¸ªç¡¬ç›˜ï¼Œè€Œç°åœ¨æˆ‘åœ¨å¤–è¾¹æƒ³è¦è®¿é—®è¿™ä¸ªç¡¬ç›˜ï¼Œé‚£ä¹ˆåªéœ€è¦è¿è¡Œç”µè„‘ä¸Šçš„ ZeroTierï¼Œå°±èƒ½é€šè¿‡ Sambaã€FTP ç­‰æ–¹å¼è®¿é—®ç¡¬ç›˜ï¼Œè€Œä¸”çœ‹èµ·æ¥å°±åƒæˆ‘å°±åœ¨å®¶é‡Œä¸€æ ·ã€‚\n\n## åŸºæœ¬åŸç†ä»‹ç»\n\nè¯´ç™½äº†å°±æ˜¯ P2P(Peer to Peer)ï¼Œè€Œä¸”ç»„ç»‡æ–¹å¼å¾ˆåƒ DNS(å…³äº DNS å¯ä»¥çœ‹[è¿™é‡Œ](https://zhih.me/how-the-web-works/#DNS-%E6%9F%A5%E8%AF%A2))\n\næ ¹æœåŠ¡å™¨ R è®°å½•äº†è·¯å¾„ä¿¡æ¯ï¼Œè®¾å¤‡ A èƒ½é€šè¿‡**ZeroTierå”¯ä¸€åœ°å€æ ‡è¯†**æ‰¾åˆ°éœ€è¦è¿æ¥çš„è®¾å¤‡ B\n\nè¿™ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n1. A æƒ³è¦å°†æ•°æ®åŒ…å‘é€åˆ° Bï¼Œä½†ç”±äºå®ƒæ²¡æœ‰ç›´æ¥è·¯å¾„ï¼Œå› æ­¤å°†å…¶å‘ä¸Šå‘é€åˆ° Rã€‚\n2. å¦‚æœ R æœ‰ç›´æ¥é“¾æ¥åˆ° Bï¼Œå®ƒä¼šè½¬å‘æ•°æ®åŒ…ç»™ Bã€‚å¦åˆ™å®ƒä¼šç»§ç»­å‘ä¸Šæ¸¸å‘é€æ•°æ®åŒ…ï¼Œç›´åˆ°è¾¾åˆ°è¡Œæ˜Ÿæ ¹(planet)ã€‚è¡Œæ˜Ÿæ ¹çŸ¥é“æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¦‚æœ B åœ¨çº¿ï¼Œæœ€ç»ˆæ•°æ®åŒ…å°†åˆ°è¾¾ Bã€‚\n3. R è¿˜å‘ A å‘é€ä¸€ä¸ªåä¸º**ä¼šå’Œ**çš„æ¶ˆæ¯ï¼ŒåŒ…å«æœ‰å…³å®ƒå¦‚ä½•åˆ°è¾¾ B çš„æç¤ºã€‚åŒæ—¶ï¼Œå°†**ä¼šå’Œ**å‘ç»™ Bï¼Œé€šçŸ¥ B å®ƒå¦‚ä½•åˆ°è¾¾ Aã€‚\n4. A å’Œ B è·å–å®ƒä»¬çš„ä¼šåˆæ¶ˆæ¯å¹¶å°è¯•ç›¸äº’å‘é€æµ‹è¯•æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šå¯¹ NAT æˆ–çŠ¶æ€é˜²ç«å¢™è¿›è¡Œç©¿é€ã€‚å¦‚æœè¿™æ ·å¯ä»¥å»ºç«‹ç›´æ¥é“¾è·¯ï¼Œåˆ™ä¸å†éœ€è¦ä¸­ç»§ã€‚\n5. å¦‚æœæ— æ³•å»ºç«‹ç›´æ¥è·¯å¾„ï¼Œåˆ™é€šä¿¡å¯ä»¥ç»§ç»­ä¸­ç»§(é€Ÿåº¦æ…¢)\n\nZeroTier å®˜æ–¹æ­å»ºäº†ä¸€ä¸ªè¡Œæ˜Ÿæ ¹æœåŠ¡å™¨å«åšåœ°çƒ Earthï¼Œè¡Œæ˜Ÿæ ¹æœåŠ¡å™¨å”¯ä¸€çš„ä¸”æ˜¯å…è´¹çš„ï¼Œå®ƒè®°å½•äº†æ‰€æœ‰çš„è·¯å¾„ä¿¡æ¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¤§å®¶éƒ½ç›´æ¥ç”¨çš„è¿™ä¸ªã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ 12 ä¸ªéå¸ƒå…¨çƒçš„æ ¹æœåŠ¡å™¨ï¼Œè¿™äº›æ˜¯æ”¶è´¹çš„æœåŠ¡ã€‚æ‰€ä»¥å¦‚æœä½¿ç”¨å…è´¹å¥—é¤ï¼Œè¿æ¥æ—¶çš„å»¶è¿Ÿå¯èƒ½ä¼šå¾ˆé«˜ï¼Œå¦å¤–ç”±äº Earth åœ¨å›½å¤–ï¼Œä¸€äº›ä¸ç¡®å®šå› ç´ å¯èƒ½ä¼šå½±å“åˆ°ä½¿ç”¨ã€‚è€ƒè™‘åˆ°ç½‘ç»œçš„ä¸ç¡®å®šæ€§ï¼ŒZeroTier èƒ½è‡ªå·±åˆ›å»ºæ ¹æœåŠ¡å™¨æœˆçƒ Moonsï¼Œè¿™æ ·å°±èƒ½åœ¨å¤§å±€åŸŸç½‘ä¸­å¾—åˆ°æ›´å¥½çš„ä½“éªŒäº†ã€‚\n\n## å®‰è£…\n\nZeroTier æ˜¯è·¨å¹³å°çš„ï¼Œèƒ½å®‰è£…åœ¨å‡ ä¹ä»»ä½•å¹³å°\n\nWindowsã€macOSã€Linuxã€iOSã€Androidã€QNAPã€Synologyã€è¥¿æ•° MyCloud NASï¼Œä¸‹è½½åœ°å€ï¼šhttps://www.zerotier.com/download.shtml\n\nè·¯ç”±å™¨æ¨èå®‰è£… [Entware](https://zhih.me/tags/entware/) åä½¿ç”¨ `opkg install zerotier` å‘½ä»¤å®‰è£…\n\n## ZeroTierä½¿ç”¨æ•™ç¨‹\n\nå› ä¸ºæˆ‘ä»¬æ²¡æœ‰è‡ªå·±åˆ›å»º Moons æœåŠ¡å™¨ï¼Œç°åœ¨å°±å…ˆä½¿ç”¨ ZeroTier æä¾›çš„æœåŠ¡\n\n### æ³¨å†Œ\n\nåœ°å€ï¼šhttps://my.zerotier.com/\n\n![æ³¨å†Œ](https://pic.zhih.me/blog/posts/zerotier-getting-started/create-account.jpg)\n\næ³¨å†Œä¹‹åæ˜¯è¿™æ ·çš„ï¼Œä¿æŒé»˜è®¤å°±å¥½ï¼Œå…è´¹å¥—é¤èƒ½è¿æ¥ 100 ä¸ªè®¾å¤‡ï¼Œä¸€èˆ¬äººå¤Ÿç”¨äº†\n\n![è´¦æˆ·](https://pic.zhih.me/blog/posts/zerotier-getting-started/account.jpg)\n\n### åˆ›å»ºç½‘ç»œ\n\n![åˆ›å»ºç½‘ç»œ](https://pic.zhih.me/blog/posts/zerotier-getting-started/create-network.jpg)\n\nåˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª Network IDï¼Œè¿™ä¸ªåœ¨åé¢çš„è®¾å¤‡è¿æ¥æ—¶éœ€è¦ç”¨åˆ°ï¼Œç‚¹å‡»åˆšåˆšåˆ›å»ºçš„ç½‘ç»œæˆ‘ä»¬å¯ä»¥è®¾ç½®æ›´å¤šé€‰é¡¹\n\n![ç½‘ç»œè®¾ç½®](https://pic.zhih.me/blog/posts/zerotier-getting-started/network-setting.jpg)\n\né»˜è®¤çš„è®¾ç½®å°±å¯ä»¥ç”¨äº†ï¼Œå³è¾¹ IPv4 çš„è®¾ç½®å°±æ˜¯åˆ†é…è®¾å¤‡å†…ç½‘ IP ç½‘æ®µï¼Œå…¶ä»–çš„è®¾ç½®å¯ä»¥åœ¨ Setting help é‡Œçœ‹åˆ°è¯´æ˜ï¼Œä¸äº†è§£çš„ä¸å»ºè®®ä¹±è®¾ç½®ï¼Œå¦‚æœä¸å°å¿ƒæŠŠè‡ªå·±çš„ç½‘ç»œæš´éœ²åœ¨å¤–éƒ¨ï¼Œä¼šç›¸å½“å±é™©\n\n### è¿æ¥\n\nç›´æ¥åœ¨å®¢æˆ·ç«¯è¾“å…¥åˆšæ‰åˆ›å»ºçš„ Network ID\n\n**ç”µè„‘**\n\n![macOS](https://pic.zhih.me/blog/posts/zerotier-getting-started/macos-join.jpg)\n\n**è·¯ç”±å™¨**\n\næˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯å®‰è£…äº† [Entware](https://zhih.me/tags/entware/) çš„ LEDE\n\n```bash\n# å¯åŠ¨\nzerotier-one -d\n\n# è·å–åœ°å€å’ŒæœåŠ¡çŠ¶æ€\nzerotier-cli status\n\n# åŠ å…¥ã€ç¦»å¼€ã€åˆ—å‡ºç½‘ç»œ\nzerotier-cli join # Network ID\nzerotier-cli leave # Network ID\nzerotier-cli listnetworks\n```\n\n### å…è®¸è¿æ¥\n\nåå°è®¾ç½®é»˜è®¤æ˜¯éœ€è¦ Auth æ‰èƒ½è¿æ¥çš„ï¼Œåœ¨å®¢æˆ·ç«¯ç”³è¯·åŠ å…¥ç½‘ç»œåï¼Œéœ€è¦åœ¨åå°å…è®¸ä¸€ä¸‹\n\n![å…è®¸åŠ å…¥](https://pic.zhih.me/blog/posts/zerotier-getting-started/members.jpg)\n\n### æµ‹è¯•è¿æ¥\n\nä¸ºäº†æµ‹è¯•ä¸åŒç½‘ç»œè®¿é—®ï¼Œæˆ‘æ·»åŠ äº†ä¸€å°å®‰å“æ‰‹æœºï¼Œåœ¨ç§»åŠ¨ç½‘ç»œä¸‹ç›´æ¥ä½¿ç”¨åˆ†é…ç»™è·¯ç”±å™¨çš„ IPï¼Œè¿æ¥äº† ssh å’Œ [onmp](https://zhih.me/tags/onmp/) åˆ›å»ºçš„ PHP æ¢é’ˆé¡µé¢ï¼Œè€Œä¸”é€Ÿåº¦è¿˜ç®—ä¸é”™ï¼Œå®½å¸¦æ˜¯ç”µä¿¡çš„ï¼Œæ‰‹æœºæ˜¯è”é€šçš„ï¼Œä¸‹æ–‡ä»¶æ—¶èƒ½æœ‰ä¸ª 800k/sï¼Œä¸çŸ¥é“ç“¶é¢ˆåœ¨å“ª\n\n![å®‰å“](https://pic.zhih.me/blog/posts/zerotier-getting-started/android-test.jpg)\n\n## ç»“è¯­\n\nç›®å‰ IPv6 è¿˜æ²¡å¾—åˆ°æ™®åŠï¼Œè™½ç„¶æˆ‘è¿™é‡Œå·²ç»èƒ½æœ‰ IPv6 åœ°å€å¹¶ä¸”èƒ½ IPv6 ç«™ç‚¹äº†ï¼Œå¥ˆä½•ä¸æ˜¯å›ºå®š IPï¼Œä¹Ÿä¸çŸ¥é“å“ªæ—¶æ‰èƒ½äººæ‰‹ä¸€ä¸ªå›ºå®š IPã€‚å°±ç›®å‰æƒ…å†µæ¥çœ‹ï¼Œä½¿ç”¨ ZeroTier æ¥åšå†…ç½‘ç©¿é€è¿˜æ˜¯ä¸é”™çš„ï¼Œä½¿ç”¨é—¨æ§›è¾ƒä½ï¼Œå¯ç”¨æ€§ä¹Ÿè¿˜è¡Œï¼Œå€¼å¾—ä¸€è¯•ã€‚ \n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n\n\n","tags":["Linux","å†…ç½‘ç©¿é€"],"categories":["æ•™ç¨‹"]},{"title":"ç»™ä½ çš„NginxåŠ ä¸ªé˜²ç«å¢™","url":"/ngx-lua-waf/","content":"\n## å¼•è¨€\n\nå‰å‡ å¤©æœ‰ä¸ªæœ‹å‹è·Ÿæˆ‘è¯´ï¼Œä»–çš„ä¸€ä¸ª WordPress ç«™ç»å¸¸è®¿é—®æ…¢ã€‚\n\nå¸®ä»–çœ‹äº†ä¸€ä¸‹æ—¥å¿—ï¼Œå‘ç°æ•´å¤©è¢«äººæ‰«ç½‘ç«™ç›®å½•çš„ä»€ä¹ˆ phpmyadmin æˆ–è€… SQL æ–‡ä»¶ï¼Œè¦ä¸å°±æ˜¯è¢« CCï¼Œåˆšå¼€å§‹æˆ‘è¿˜ä»¥ä¸ºæ˜¯ä¸»æœºå•†å¸®æ‰«æ¼æ´ä¹‹ç±»çš„ï¼Œåæ¥å‘ç°å®åœ¨æ˜¯å¤ªå¯†é›†äº†ï¼Œçœ‹æ¥ä¸æ˜¯ã€‚\n\næˆ‘å°±ç¬‘äº†ï¼Œä»–é‚£ç ´ç«™æœ‰å•¥å€¼å¾—æ‰«çš„ï¼Œä¸è¿‡ CC çš„è¯å€’ä¹Ÿä¸å¥‡æ€ªï¼Œæœ‰äº›äººå°±æ˜¯çˆ±æè¿™äº›æ— èŠçš„äº‹æƒ…ã€‚\n\nç„¶åä»–åˆè¯´ï¼Œç”¨çš„æ˜¯è…¾è®¯äº‘çš„1å…ƒå°é¸¡ï¼Œåˆšå¼€å§‹éå¸¸æµç•…çš„å•Šï¼Œä¸è‡³äºç°åœ¨è¿™ä¹ˆæƒ¨å§ã€‚\n\næˆ‘çœ‹äº†ä¸€ä¸‹çœŸæç¬‘ï¼Œæœ¬èº«æœºå™¨æ€§èƒ½å°±ä¸è¡Œäº†ï¼Œè¿˜ä¸åšé™æ€åŒ–ï¼Œè¢« CC çš„æ—¶å€™è´Ÿè½½è‡ªç„¶ä¸Šå»äº†ï¼Œè€Œä¸”å°é¸¡æ‰ 1M çš„å¸¦å®½ï¼Œä¸æ…¢æ‰æ€ªã€‚\n\nä»–è¯´ä»–çš„ç«™å°±å†™å†™ç¬”è®°æˆ–è€…è½¬è½½ä¸€äº›æ–‡ç« ï¼Œä¹Ÿä¸æ˜¯ä»€ä¹ˆé‡è¦çš„ä¸œè¥¿ï¼Œä½†æ˜¯æ•´å¤©è¢«æä¹Ÿæ˜¯ä¸å¤ªçˆ½ï¼Œæ€ä¹ˆå¼„æ‰èƒ½è§£å†³ã€‚ã€‚ã€‚\n\næˆ‘æƒ³ä¹Ÿæ˜¯ï¼Œè™½ç„¶ä¸œè¥¿æ˜¯åƒåœ¾ï¼Œä½†å¥½æ­¹è¿˜æ˜¯åœ¨ç”¨çš„ï¼Œä¸è¿‡å˜›è§£å†³æ˜¯ä¸å¯èƒ½è§£å†³çš„ï¼Œåªè¦åˆ«äººèƒ½è®¿é—®ï¼Œä½ å°±ä¼šé‡åˆ°è¿™æ ·é‚£æ ·çš„å‚»é€¼ï¼Œä¸è¿‡æ”¹å–„è¿˜æ˜¯å¯ä»¥å•¦ã€‚æ—¢ç„¶ä¸»æœºå•†çš„å„ç§å®‰å…¨å¥—é¤å’±ä»¬ç”¨ä¸èµ·ï¼Œé‚£å°±ç”¨ä¸€äº›å¤§ä½¬å†™å¥½çš„æ–¹æ¡ˆå§ã€‚\n\næ‰¾äº†ä¸€ä¸‹ï¼Œå‘ç° ngx_lua_waf æ˜¯ä¸ªä¸é”™çš„æ–¹æ¡ˆï¼Œä½†æ˜¯å¤ªä¹…ä¸æ›´æ–°äº†ï¼Œè€Œä¸”ä»£ç æˆ‘çœ‹ä¸æ‡‚ï¼ŒçŒ\n\næœ€åæ‰¾åˆ° oneinstack ä¸€é”®åŒ…å†…ç½®çš„ ngx_lua_wafï¼ŒåŸºäºä¹‹å‰çš„ä»£ç ï¼Œä¸è¿‡é‡æ„ äº†ï¼Œè¿™ä¸‹æˆ‘èƒ½çœ‹æ‡‚äº†ï¼Œä»¥åè¦ä¿®æ”¹ä¹Ÿèƒ½ç®€å•ä¸€äº›\n\n## ä»‹ç»\n\n[ngx_lua_waf](https://github.com/xzhih/ngx_lua_waf) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„è½»é‡çº§ web åº”ç”¨é˜²ç«å¢™ï¼ŒåŸºäº lua-nginx-moduleã€‚\n\n![ngx_lua_waf](https://pic.zhih.me/blog/posts/ngx-lua-waf/waf.jpg)\n\nå®ƒå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š\n\n```\né˜²æ­¢sqlæ³¨å…¥ï¼Œæœ¬åœ°åŒ…å«ï¼Œéƒ¨åˆ†æº¢å‡ºï¼Œfuzzingæµ‹è¯•ï¼Œxss,SSRFç­‰webæ”»å‡»\né˜²æ­¢svn/å¤‡ä»½ä¹‹ç±»æ–‡ä»¶æ³„æ¼\né˜²æ­¢ApacheBenchä¹‹ç±»å‹åŠ›æµ‹è¯•å·¥å…·çš„æ”»å‡»\nå±è”½å¸¸è§çš„æ‰«æé»‘å®¢å·¥å…·ï¼Œæ‰«æå™¨\nå±è”½å¼‚å¸¸çš„ç½‘ç»œè¯·æ±‚\nå±è”½å›¾ç‰‡é™„ä»¶ç±»ç›®å½•phpæ‰§è¡Œæƒé™\né˜²æ­¢webshellä¸Šä¼ \n```\n\nç»è¿‡ [unixhot](https://github.com/unixhot/waf) çš„ä¿®æ”¹å’Œé‡æ„ï¼Œæ‹¥æœ‰äº†ä»¥ä¸‹åŠŸèƒ½ï¼š\n\n```\næ”¯æŒIPç™½åå•å’Œé»‘åå•åŠŸèƒ½ï¼Œç›´æ¥å°†é»‘åå•çš„IPè®¿é—®æ‹’ç»\næ”¯æŒURLç™½åå•ï¼Œå°†ä¸éœ€è¦è¿‡æ»¤çš„URLè¿›è¡Œå®šä¹‰\næ”¯æŒUser-Agentçš„è¿‡æ»¤ï¼ŒåŒ¹é…è‡ªå®šä¹‰è§„åˆ™ä¸­çš„æ¡ç›®ï¼Œç„¶åè¿›è¡Œå¤„ç†ï¼ˆè¿”å›403ï¼‰\næ”¯æŒCCæ”»å‡»é˜²æŠ¤ï¼Œå•ä¸ªURLæŒ‡å®šæ—¶é—´çš„è®¿é—®æ¬¡æ•°ï¼Œè¶…è¿‡è®¾å®šå€¼ï¼Œç›´æ¥è¿”å›403\næ”¯æŒCookieè¿‡æ»¤ï¼ŒåŒ¹é…è‡ªå®šä¹‰è§„åˆ™ä¸­çš„æ¡ç›®ï¼Œç„¶åè¿›è¡Œå¤„ç†ï¼ˆè¿”å›403ï¼‰\næ”¯æŒURLè¿‡æ»¤ï¼ŒåŒ¹é…è‡ªå®šä¹‰è§„åˆ™ä¸­çš„æ¡ç›®ï¼Œå¦‚æœç”¨æˆ·è¯·æ±‚çš„URLåŒ…å«è¿™äº›ï¼Œè¿”å›403\næ”¯æŒURLå‚æ•°è¿‡æ»¤ï¼ŒåŸç†åŒä¸Š\næ”¯æŒæ—¥å¿—è®°å½•ï¼Œå°†æ‰€æœ‰æ‹’ç»çš„æ“ä½œï¼Œè®°å½•åˆ°æ—¥å¿—ä¸­å»\næ—¥å¿—è®°å½•ä¸ºJSONæ ¼å¼ï¼Œä¾¿äºæ—¥å¿—åˆ†æï¼Œä¾‹å¦‚ä½¿ç”¨ELKStackè¿›è¡Œæ”»å‡»æ—¥å¿—æ”¶é›†ã€å­˜å‚¨ã€æœç´¢å’Œå±•ç¤º\n```\n\nè¿™äº›åŠŸèƒ½åˆšå¥½èƒ½æ»¡è¶³æˆ‘æœ‹å‹çš„éœ€æ±‚\n\n## å®‰è£…\n\nå®‰è£…èµ·æ¥ä¹Ÿæ˜¯ç›¸å½“å®¹æ˜“ï¼Œè¯´ç™½äº†å°±æ˜¯ç»™ nginx å¢åŠ  ngx_devel_kitã€lua-nginx-module è¿™ä¸¤ä¸ªæ¨¡å—ï¼Œç„¶åå†ä¿®æ”¹ nginx é…ç½®æ¥è¿è¡Œ ngx_lua_wafã€‚\n\n### ä¸€é”®å®‰è£…\n\nä¸€é”®å‘½ä»¤æˆ‘å·²ç»ç»™ä½ ä»¬å‡†å¤‡å¥½äº†ï¼Œä¸€é”®å‘½ä»¤ä¼šç¼–è¯‘ nginx-1.15.6ï¼Œç¼–è¯‘çš„è¯¦ç»†æ¨¡å—å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡å¸–å­ https://zhih.me/make-your-website-support-tls1-3 ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥çœ‹è„šæœ¬çš„ä»£ç \n\n```\nsh -c \"$(curl -kfsSl https://raw.githubusercontent.com/xzhih/nginx-compile/master/install.sh)\"\n```\n\n### æ‰‹åŠ¨å®‰è£…\n\n#### ä¸‹è½½ ngx_lua_waf é˜²ç«å¢™çš„å„ç§ä¾èµ–åŠæ¨¡å—\n\n```bash\ncd /usr/src/\nwget https://github.com/openresty/luajit2/archive/v2.1-20181029.tar.gz\ntar xzvf v2.1-20181029.tar.gz\nmv luajit2-2.1-20181029 luajit-2.1\n\nwget https://github.com/openresty/lua-cjson/archive/2.1.0.6.tar.gz\ntar xzvf 2.1.0.6.tar.gz\nmv lua-cjson-2.1.0.6 lua-cjson\n\nwget https://github.com/simplresty/ngx_devel_kit/archive/v0.3.1rc1.tar.gz\ntar xzvf v0.3.1rc1.tar.gz\nmv ngx_devel_kit-0.3.1rc1 ngx_devel_kit\n\nwget https://github.com/openresty/lua-nginx-module/archive/v0.10.13.tar.gz\ntar xzvf v0.10.13.tar.gz  \nmv lua-nginx-module-0.10.13 lua-nginx-module\n```\n\n#### ç¼–è¯‘å®‰è£… luajit\n\n```bash\ncd luajit-2.1\nmake -j2 && make install\necho '/usr/local/lib' >> /etc/ld.so.conf.d/local.conf\nldconfig\n```\n\n#### ç¼–è¯‘å®‰è£… lua-cjson\n\n```bash\ncd /usr/src/lua-cjson\nexport LUA_INCLUDE_DIR=/usr/local/include/luajit-2.1 \nmake -j2 && make install\n```\n\n#### è®¾ç½® LUAJIT ç¯å¢ƒå˜é‡\n\n```bash\nexport LUAJIT_LIB=/usr/local/lib\nexport LUAJIT_INC=/usr/local/include/luajit-2.1\n```\n\n#### ç¼–è¯‘ nginx çš„æ—¶å€™åŠ ä¸Šä»¥ä¸‹ä¸¤ä¸ªæ¨¡å—\n\n```bash\n--add-module=../lua-nginx-module\n--add-module=../ngx_devel_kit\n```\n\n#### ä¸‹è½½é…ç½® ngx_lua_waf\n\n```bash\ncd /usr/local/nginx/conf/\ngit clone https://github.com/xzhih/ngx_lua_waf.git waf \n\ncat > /usr/local/nginx/conf/waf.conf << EOF\nlua_shared_dict limit 20m;\nlua_package_path \"/usr/local/nginx/conf/waf/?.lua\";\ninit_by_lua_file \"/usr/local/nginx/conf/waf/init.lua\";\naccess_by_lua_file \"/usr/local/nginx/conf/waf/access.lua\";\nEOF\n\nmkdir -p /usr/local/nginx/logs/waf \nchown www-data:www-data /usr/local/nginx/logs/waf \n```\n\nä½ å¯ä»¥åœ¨ `/usr/local/nginx/logs/waf` æ‰¾åˆ°é˜²ç«å¢™æ—¥å¿—\n\n#### åœ¨ `nginx.conf` é‡Œ include `waf.conf`\n\n```\ninclude waf.conf;\n```\n\nå¯åŠ¨ nginx å¹¶è®¿é—® http://ä½ çš„IP/?a=a.sql \n\nå°±å¯ä»¥çœ‹åˆ°é˜²ç«å¢™æç¤ºäº†\n\n## Copyright\n\nhttps://github.com/lj2007331/ngx_lua_waf\n\nhttps://github.com/loveshell/ngx_lua_waf\n\nhttps://github.com/unixhot/waf\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["nginx","web"],"categories":["æ•™ç¨‹"]},{"title":"ä½¿ç”¨acme.shè·å–å…è´¹SSLè¯ä¹¦","url":"/acme-sh-guide/","content":"\n## å¼•è¨€\n\n[acme.sh](https://github.com/Neilpang/acme.sh) æ˜¯ä¸€ä¸ª ACME(è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†ç¯å¢ƒ) è„šæœ¬ï¼Œå¯ä»¥ä» letsencrypt ç”Ÿæˆå…è´¹çš„è¯ä¹¦ã€‚\n\næœ¬æ¥è¿™ä¸ªæ•™ç¨‹æ˜¯å†™åœ¨ [ç¼–è¯‘Nginxæ”¯æŒTLS1.3](https://zhih.me/make-your-website-support-tls1-3/) é‚£ç¯‡å¸–å­é‡Œçš„ï¼Œåæ¥æ„Ÿè§‰è¿˜æ˜¯å•ç‹¬æ‹¿å‡ºæ¥æ¯”è¾ƒå¥½ï¼Œå³èƒ½è®©é‚£ç¯‡æ•™ç¨‹æ›´ç®€æ´ï¼Œä¹Ÿèƒ½æ›´æ–¹ä¾¿çš„è®©éœ€è¦çš„äººçœ‹åˆ°è¿™ä¸ªæ•™ç¨‹ã€‚\n\n## å®‰è£…å·¥å…·\n\n```bash\napt-get install cron socat -y\n```\n\n## è·å– acme.sh\n\n```bash\ncurl  https://get.acme.sh | sh \n```\n\né‡å¯ç»ˆç«¯ï¼Œå¦‚æœä½ ä½¿ç”¨ zsh å¯ä»¥è¿™æ · `source ~/.zshrc`\n\n## ç”Ÿæˆè¯ä¹¦\n\nä½¿ç”¨ http æ–¹å¼éªŒè¯åŸŸåï¼Œéœ€è¦å…ˆæ­å»º HTTP ç«™ç‚¹ï¼Œè¿™é‡Œä½¿ç”¨ acme.sh è‡ªå¸¦çš„ webserverï¼Œæ‰€ä»¥å…ˆæŠŠ nginx åœæ‰\n\n```bash\nservice nginx stop\n```\n\næ¥ä¸‹æ¥æŒ‡å®šåŸŸåï¼Œå¼€å§‹ç­¾å‘\n\n```bash\nacme.sh --issue -d onmp.ooo \\\n        --keylength ec-256 \\\n        --standalone\n```\n\nå¦‚æœæ˜¯å¤šåŸŸåï¼Œå¯ä»¥ä½¿ç”¨ -d å‚æ•°æ·»åŠ ï¼Œå¦‚ï¼š`-d www.onmp.ooo` \n`--keylength ec-256` æ˜¯ç­¾å‘ ECC ç±»å‹çš„è¯ä¹¦ï¼Œå®ƒçš„å®‰å…¨æ€§æ›´é«˜ï¼Œåˆ é™¤åˆ™ä½¿ç”¨é»˜è®¤çš„ RSA è¯ä¹¦\n\n\n## å¤åˆ¶è¯ä¹¦\n\nè¯ä¹¦å·²ç»ç­¾å‘äº†ï¼Œä¸è¿‡é»˜è®¤æ˜¯ä¿å­˜åœ¨ `~/.acme.sh/` é‡Œ\n\n```bash\nacme.sh --ecc --installcert -d onmp.ooo \\\n        --key-file /usr/local/nginx/conf/ssl/onmp.ooo.key \\\n        --fullchain-file /usr/local/nginx/conf/ssl/onmp.ooo.cer \\\n        --reloadcmd \"service nginx restart\"\n```\n\næŒ‡å®šåŸŸåï¼ŒæŒ‡å®šè¯ä¹¦ä¿å­˜ç›®å½•ï¼Œæˆ‘è¿™é‡Œè®¾ç½®åœ¨ `/usr/local/nginx/conf/ssl/`ï¼ŒæŒ‡å®š Nginx é‡è½½å‘½ä»¤ï¼Œå¦‚æœç­¾å‘çš„ä¸æ˜¯ ECC è¯ä¹¦ï¼ŒæŠŠ `--ecc` å‚æ•°å»æ‰\n\nè¿™æ ·ä½¿ç”¨ acme.sh å°±å®Œæˆäº†è¯ä¹¦çš„ç­¾å‘ï¼Œå¦‚æœè¯ä¹¦å¿«è¦è¿‡æœŸäº†ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ›´æ–°è¯ä¹¦\n\nè„šæœ¬è‡ªåŠ¨æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤\n\n```bash\nacme.sh --upgrade --auto-upgrade \n```\n\n## è¯ä¹¦å®‰è£…\n\nè¯ä¹¦å·²ç»è·å–å¹¶ä¸”å¯ä»¥è‡ªåŠ¨æ›´æ–°äº†ï¼Œå…·ä½“å®‰è£…æ–¹æ³•çœ‹ [ç¼–è¯‘Nginxæ”¯æŒTLS1.3](https://zhih.me/make-your-website-support-tls1-3/) \n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["nginx","https","web"],"categories":["æ•™ç¨‹"]},{"title":"ç¼–è¯‘Nginxæ”¯æŒTLS1.3","url":"/make-your-website-support-tls1-3/","content":"\n## å¼•è¨€\n\nTLS1.2 å‘å¸ƒäº 2008 å¹´ 8 æœˆï¼Œè‡³ä»Šæ­£å¥½æœ‰ 10 å¹´ï¼Œéšç€äº’è”ç½‘å®‰å…¨è¶Šæ¥è¶Šå—åˆ°é‡è§†ï¼Œæ–°åè®® TLS1.3 å‘¼ä¹‹æ¬²å‡ºã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä»ç¬¬ä¸€ä»½è‰æ¡ˆç¼–å†™è‡³ä»Šï¼Œå·²ç»æœ‰å‡ å¹´æ—¶é—´äº†ï¼Œæˆªæ­¢è¿™ç¯‡æ–‡ç« ç¼–å†™ï¼Œå·²ç»æ˜¯ç¬¬ 28 ä»½è‰æ¡ˆã€‚åœ¨æœ€è¿‘çš„ Chrome ç‰ˆæœ¬æ›´æ–°ä¸­ä¹Ÿé€æ­¥å¯¹ TLS1.3 è¿›è¡Œæ”¯æŒï¼ŒChrome 65 å¼€å§‹é»˜è®¤å¼€å¯ draft 23ã€Chrome 68 å¼€å§‹æ”¯æŒ draft 28\n\n>æ›´æ–°ï¼šTLS 1.3 æ ‡å‡†å·²äº 2018 å¹´ 8 æœˆæ­£å¼å‘å¸ƒä¸º [ RFC 8446 ](https://tools.ietf.org/html/rfc8446)ï¼Œè· TLS1.2 å‘å¸ƒæ­£å¥½ 10 å‘¨å¹´\n\nTLS1.3 å¯¹äº TLS1.2 æœ‰é‡å¤§æ”¹å†™ï¼Œæ—¢æé«˜äº†å®‰å…¨æ€§åˆæé«˜äº†é€Ÿåº¦ï¼Œä»¥è‡³äºæœ‰äº‰è®®ç§°ï¼Œåº”è¯¥æŠŠå®ƒå«åš TLS2.0\n\nå…³äº TLS1.3 çš„ç§‘æ™®å¯ä»¥çœ‹ä¸‹é¢çš„é¡µé¢\n\nhttps://wiki.openssl.org/index.php/TLS1.3 \nhttps://zhuanlan.zhihu.com/p/28850798\n\nä¹‹å‰æˆ‘ä¹Ÿå†™è¿‡ Nginx çš„ https çš„é…ç½® https://zhih.me/nginx-http2-https/ ï¼Œå½“æ—¶æ˜¯ä½¿ç”¨ TLS1.2 çš„\n\nç¢°å·§å‰å‡ å¤©å‘ç° `.ooo` å¯ä»¥å…è´¹ç”¨ 1 å¹´ï¼Œå°±æ’¸äº†ä¸€ä¸ª `onmp.ooo` æ¥åšä¸ºæˆ‘ onmp é¡¹ç›®çš„é¡µé¢ï¼ŒæŠŠå®ƒæ­åœ¨ 4 åˆ€å¹´ä»˜çš„ virmach ä¸Šï¼Œé¡ºä¾¿æµ‹è¯• TLS1.3\n\n## ä¸€é”®å®‰è£…\n\næœ€è¿‘æ›´æ–°æ”¯æŒé˜²ç«å¢™åŠŸèƒ½ï¼Œè¯¦æƒ…å¯ä»¥çœ‹ https://zhih.me/ngx-lua-waf/\n\n```bash\nsh -c \"$(curl -kfsSl https://raw.githubusercontent.com/xzhih/nginx-compile/master/install.sh)\"\n```\n\n## å®‰è£…\n\næˆ‘è¿™é‡Œç”¨çš„ç³»ç»Ÿæ˜¯ Debian 8\n\n### å®‰è£…ä¾èµ–\n\n```bash\napt-get install git gcc make build-essential -y\n```\n\n### ä¸‹è½½æºç \n\næˆ‘ä»¬æŠŠæºç å…¨éƒ½æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæ–¹ä¾¿ä½¿ç”¨ï¼Œåˆ›å»º nginx çš„è¿è¡Œç”¨æˆ· www-data\n\n```bash\nrm -rf /usr/src/\nmkdir -p /usr/src/\nmkdir -p /var/log/nginx/\nuseradd -s /sbin/nologin -M www-data\n```\n\n**å…‹éš† OpenSSL**\n\nè¿™é‡Œç”¨çš„æ˜¯ 1.1.1 ç¨³å®šç‰ˆçš„æºç \n\n```bash\ncd /usr/src\nwget https://github.com/openssl/openssl/archive/OpenSSL_1_1_1.tar.gz \ntar xzvf OpenSSL_1_1_1.tar.gz\nmv openssl-OpenSSL_1_1_1 openssl\n```\n\n**ä¸‹è½½ Nginx çš„æºç **\n\n```bash\ncd /usr/src/\nwget https://nginx.org/download/nginx-1.15.6.tar.gz\ntar zxf ./nginx-1.15.6.tar.gz \nmv nginx-1.15.6 nginx\n```\n\n**å…‹éš† zlib**\n\nå¼€å¯ gzip è¦ç”¨åˆ° zlib åº“ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ Cloudflare ä¼˜åŒ–çš„ç‰ˆæœ¬ï¼Œæ¯”åŸç‰ˆå…·æœ‰æ›´é«˜çš„å‹ç¼©æ€§èƒ½\n\n```bash\ncd /usr/src/\ngit clone https://github.com/cloudflare/zlib.git zlib\ncd zlib\nmake -f Makefile.in distclean\n```\n\n**å…‹éš† Brotli**\n\nå°±åƒ gzip ä¸€æ ·ï¼ŒBrotli ä¹Ÿæ˜¯ä¸€ç§å‹ç¼©ç®—æ³•ï¼Œå®ƒæ˜¯ç”±è°·æ­Œå¼€å‘çš„ä¸€ä¸ªæ›´é€‚åˆæ–‡æœ¬å‹ç¼©çš„ç®—æ³•ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†å­—å…¸ï¼Œæ‰€ä»¥æœ‰æ›´å¥½çš„å‹ç¼©æ¯”ã€‚\n\nç°åœ¨ä¸»æµæµè§ˆå™¨éƒ½å·²ç»æ”¯æŒ Brotli äº†ï¼Œè€Œä¸”ä¹Ÿèƒ½ä¸ gzip å…±å­˜ï¼Œå¦‚æœæµè§ˆå™¨æ”¯æŒ Brotli å°±ä¼šä¼˜å…ˆä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒå…¼å®¹æ€§ï¼Œå¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°æ”¯æŒçš„æ•°æ® https://caniuse.com/#search=Brotli\n\n```bash\ncd /usr/src/\ngit clone --recursive https://github.com/google/ngx_brotli.git\n```\n\næˆ‘ç»™ nginx é»˜è®¤é…ç½®çš„ Brotli å‹ç¼©ç­‰çº§ä¸º 6 çº§ï¼Œè¿™å¯¹äºåŠ¨æ€å†…å®¹æ¯”è¾ƒå‹å¥½ï¼Œå¦‚æœä½ æ˜¯åƒæˆ‘ç°åœ¨è¿™ä¸ªåšå®¢ä¸€æ ·æ˜¯é™æ€åŒ–çš„ï¼Œé‚£ä¹ˆå»ºè®®å¼€å¯ 11 çº§å‹ç¼©ï¼Œè¿™æ ·å¯ä»¥è·å¾—æœ€å¥½çš„ä½“éªŒ\n\n**ä¸‹è½½ PCRE**\n\nnginx rewrite æ¨¡å—éœ€è¦ pcre åº“ \n\n```bash\ncd /usr/src/\nwget https://ftp.pcre.org/pub/pcre/pcre-8.42.tar.gz\ntar zxf ./pcre-8.42.tar.gz\n```\n\n### ç»™ OpenSSL æ‰“è¡¥ä¸\n\nè¡¥ä¸æ¥è‡ªï¼šhttps://github.com/hakasenyang/openssl-patch\n\næ­¤è¡¥ä¸çš„ç›®çš„æ˜¯è®© OpenSSL æ”¯æŒ TLS1.3 çš„ 23,26,28 è‰æ¡ˆï¼Œä»¥åŠ Final ç‰ˆæ ‡å‡†\n\n```bash\ncd /usr/src/\ngit clone https://github.com/hakasenyang/openssl-patch.git\ncd /usr/src/openssl \npatch -p1 < ../openssl-patch/openssl-equal-1.1.1_ciphers.patch\npatch -p1 < ../openssl-patch/openssl-1.1.1-chacha_draft.patch\n```\n\n### ç»™ Nginx æ‰“è¡¥ä¸\n\nè¡¥ä¸æ¥è‡ªï¼šhttps://github.com/kn007/patch\n\nnginx è¡¥ä¸\n  - æ·»åŠ SPDYæ”¯æŒã€‚\n  - æ·»åŠ HTTP2 HPACKç¼–ç æ”¯æŒã€‚\n  - æ·»åŠ åŠ¨æ€TLSè®°å½•æ”¯æŒã€‚\n\nnginx_auto_using_PRIORITIZE_CHACHA è¡¥ä¸ \n  - æ”¯æŒæ—¶ä½¿ç”¨ SSL_OP_PRIORITIZE_CHACHA\n\n```bash\ncd /usr/src/\ngit clone https://github.com/kn007/patch.git nginx-patch\ncd /usr/src/nginx\npatch -p1 < ../nginx-patch/nginx.patch \npatch -p1 < ../nginx-patch/nginx_auto_using_PRIORITIZE_CHACHA.patch\n```\n\n### ä½¿ç”¨ jemalloc ä½œä¸ºå†…å­˜ç®¡ç†\n\n```bash\ncd /usr/src/\nwget https://github.com/jemalloc/jemalloc/releases/download/5.1.0/jemalloc-5.1.0.tar.bz2\ntar xjvf jemalloc-5.1.0.tar.bz2\ncd jemalloc-5.1.0\n./configure\nmake && make install\necho '/usr/local/lib' >> /etc/ld.so.conf.d/local.conf\nldconfig\n```\n\n### å…¶ä»–ç¼–è¯‘é…ç½®\n\nNginx é»˜è®¤ä¼šä»¥ debug æ¨¡å¼ç¼–è¯‘ï¼Œæˆ‘ä»¬éœ€è¦æ³¨é‡Šæ‰ `/usr/src/nginx/auto/cc/gcc` ä¸­ `CFLAGS=\"$CFLAGS -g\"` è¿™è¡Œï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç”Ÿæˆæ–‡ä»¶çš„å¤§å°\n\n```bash\nsed -i 's@CFLAGS=\"$CFLAGS -g\"@#CFLAGS=\"$CFLAGS -g\"@' /usr/src/nginx/auto/cc/gcc\n```\n\n### ç¼–è¯‘å®‰è£…\n\n```bash\ncd /usr/src/nginx\n./configure \\\n--user=www-data --group=www-data \\\n--prefix=/usr/local/nginx \\\n--sbin-path=/usr/sbin/nginx \\\n--with-compat --with-file-aio --with-threads \\\n--with-http_v2_module --with-http_v2_hpack_enc \\\n--with-http_spdy_module --with-http_realip_module \\\n--with-http_flv_module --with-http_mp4_module \\\n--with-openssl=../openssl --with-http_ssl_module \\\n--with-pcre=../pcre-8.42 --with-pcre-jit \\\n--with-zlib=../zlib --with-http_gzip_static_module \\\n--add-module=../ngx_brotli \\\n--with-ld-opt=-ljemalloc\n\nmake \nmake install\n```\n\nNginx çš„å¯æ‰§è¡Œæ–‡ä»¶å®‰è£…åœ¨ `/usr/sbin/nginx` ï¼ŒNginx é…ç½®åœ¨ `/usr/local/nginx/conf/` é‡Œ\n\n## é…ç½®\n\nNginx å·²ç»å®‰è£…ä¸Šäº†ï¼Œç°åœ¨æˆ‘ä»¬æ¥é…ç½®ç½‘ç«™ï¼Œè®©å®ƒè·‘èµ·æ¥\n\n### Nginx å…¨å±€é…ç½®\n\næŠŠä»¥ä¸‹å†…å®¹è¦†ç›–å¡«å…¥ `/usr/local/nginx/conf/nginx.conf` \n\n```\nuser www-data;\npid /var/run/nginx.pid;\nworker_processes auto;\nworker_rlimit_nofile 65535;\n\nevents {\n    use epoll;\n    multi_accept on;\n    worker_connections 65535;\n}\n\nhttp {\n    charset utf-8;\n    sendfile on;\n    aio threads;\n    directio 512k;\n    tcp_nopush on;\n    tcp_nodelay on;\n    server_tokens off;\n    log_not_found off;\n    types_hash_max_size 2048;\n    client_max_body_size 16M;\n\n    # MIME\n    include mime.types;\n    default_type application/octet-stream;\n\n    # Logging\n    access_log /var/log/nginx/access.log;\n    error_log /var/log/nginx/error.log warn;\n\n    # Gzip\n    gzip on;\n    gzip_vary on;\n    gzip_proxied any;\n    gzip_comp_level 6;\n    gzip_types text/plain text/css text/xml application/json application/javascript application/xml+rss application/atom+xml image/svg+xml;\n    gzip_disable \"MSIE [1-6]\\.(?!.*SV1)\";\n\n    # Brotli\n    brotli on;\n    brotli_comp_level 6;\n    brotli_static on;\n    brotli_types text/plain text/css text/xml application/json application/javascript application/xml+rss application/atom+xml image/svg+xml;\n\n    include vhost/*.conf;\n}\n```\n\n### Nginx ç«™ç‚¹é…ç½®\n\næˆ‘ä»¬å·²ç»åœ¨å…¨å±€é…ç½®é‡Œè®¾ç½®äº†åŒ…å« `/usr/local/nginx/conf/vhost/` ç›®å½•ä¸‹çš„ conf æ–‡ä»¶\n\n```bash\nmkdir -p /usr/local/nginx/conf/vhost/\n```\n\nç„¶ååœ¨ `/usr/local/nginx/conf/vhost/` é‡Œåˆ›å»ºç«™ç‚¹é…ç½®ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯ `onmp.ooo.conf` \n\n```\nserver {\n  listen 80;\n  server_name onmp.ooo;\n  root /wwwroot/onmp.ooo;\n  location / {\n    index  index.html;\n  }\n}\n```\n\nè¿™æ · HTTP çš„ç«™ç‚¹é…ç½®å°±å¼„å¥½äº†ï¼Œä¸è¿‡è¿˜ç«™ç‚¹è¿˜æ²¡é¡µé¢ï¼Œæˆ‘ä»¬æŠŠ Nginx çš„æ¬¢è¿ä¹Ÿé¢ç»™æ”¾è¿›å»\n\n```bash\nmkdir -p /wwwroot\ncp -r /usr/local/nginx/html /wwwroot/onmp.ooo\n\n# é…ç½®ç«™ç‚¹ç›®å½•æƒé™\nchown -R www-data:www-data /wwwroot/\nfind /wwwroot/ -type d -exec chmod 755 {} \\;\nfind /wwwroot/ -type f -exec chmod 644 {} \\;\n```\n\n### service é…ç½®\n\nservice å‘½ä»¤ç”¨äºå¯¹ç³»ç»ŸæœåŠ¡è¿›è¡Œç®¡ç†ï¼Œæ¯”å¦‚å¯åŠ¨ï¼ˆstartï¼‰ã€åœæ­¢ï¼ˆstopï¼‰ã€é‡å¯ï¼ˆrestartï¼‰ã€æŸ¥çœ‹çŠ¶æ€ï¼ˆstatusï¼‰ç­‰ï¼Œæˆ‘ä»¬æ˜¯ç¼–è¯‘å®‰è£…çš„ï¼Œæ‰€ä»¥è¦æ‰‹åŠ¨åˆ›å»ºæœåŠ¡æ–‡ä»¶ã€‚\n\n```bash\nmkdir -p /usr/lib/systemd/system/\n```\n\nç¼–è¾‘ `/usr/lib/systemd/system/nginx.service` å†™å…¥ä»¥ä¸‹å†…å®¹\n\n```\n[Unit]\nDescription=nginx - high performance web server\nAfter=network.target\n\n[Service]\nType=forking\nPIDFile=/var/run/nginx.pid\nExecStartPost=/bin/sleep 0.1\nExecStartPre=/usr/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf\nExecStart=/usr/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\nExecReload=/usr/sbin/nginx -s reload\nExecStop=/usr/sbin/nginx -s stop\n\n[Install]\nWantedBy=multi-user.target\n```\n\nå¯åŠ¨æœåŠ¡\n\n```bash\nsystemctl daemon-reload #é‡è½½\nsystemctl enable nginx #å¼€æœºå¯åŠ¨\nsystemctl start nginx #è¿è¡Œ\n```\n\næˆ‘ä»¬ç°åœ¨å¯ä»¥ç”¨ `service` æˆ– `systemctl` ç®¡ç† nginx äº†\n\nå¯åŠ¨ Nginx å HTTP é¡µé¢å°±æ­£å¸¸äº†ï¼Œæ‰“å¼€ onmp.ooo å°±èƒ½çœ‹åˆ° Welcome to nginx!\n\n### ç­¾å‘è¯ä¹¦\n\né…ç½® HTTPS é¦–å…ˆè¦æœ‰è¯ä¹¦ï¼Œæˆ‘è¿™é‡Œæ˜¯ä½¿ç”¨ [acme.sh](https://github.com/Neilpang/acme.sh) è‡ªåŠ¨é¢å‘ Letâ€™s Encrypt çš„è¯ä¹¦\n\nå…·ä½“ä½¿ç”¨æ•™ç¨‹çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ•™ç¨‹ [ä½¿ç”¨acme.shè·å–å…è´¹SSLè¯ä¹¦](https://zhih.me/acme-sh-guide/)\n\nå½“ç„¶ï¼Œä½ è¦æ˜¯å·²ç»æœ‰äº† SSL è¯ä¹¦ï¼Œç›´æ¥çœ‹ä¸‹é¢é…ç½®æ–‡ä»¶é‡Œè¯ä¹¦å­˜æ”¾çš„ç›®å½•ï¼Œç›´æ¥æ”¾åˆ°é‡Œé¢å»å°±è¡Œï¼Œå…¶ä»–æ“ä½œä¸€æ ·çš„\n\n### HTTPS ç«™ç‚¹é…ç½®\n\nå› ä¸ºæˆ‘ç»™ OpenSSL æ‰“çš„æ˜¯ equal-1.1.1_ciphers è¡¥ä¸ï¼Œæ‰€ä»¥ ssl_ciphers é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼Œå¦‚æœä½ æ‰“çš„æ˜¯åˆ«çš„è¡¥ä¸ï¼Œåˆ™éœ€è¦æŸ¥çœ‹ https://github.com/hakasenyang/openssl-patch ç»™çš„é…ç½®\n\n```\nserver {\n    listen 80;\n    server_name onmp.ooo;\n    return 301 https://onmp.ooo$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name onmp.ooo;\n    root /wwwroot/onmp.ooo;\n\n    # SSL\n    ssl_certificate         /usr/local/nginx/conf/ssl/onmp.ooo.cer;\n    ssl_certificate_key     /usr/local/nginx/conf/ssl/onmp.ooo.key;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers '[TLS13+AESGCM+AES128|TLS13+AESGCM+AES256|TLS13+CHACHA20]:[EECDH+ECDSA+AESGCM+AES128|EECDH+ECDSA+CHACHA20]:EECDH+ECDSA+AESGCM+AES256:EECDH+ECDSA+AES128+SHA:EECDH+ECDSA+AES256+SHA:[EECDH+aRSA+AESGCM+AES128|EECDH+aRSA+CHACHA20]:EECDH+aRSA+AESGCM+AES256:EECDH+aRSA+AES128+SHA:EECDH+aRSA+AES256+SHA:RSA+AES128+SHA:RSA+AES256+SHA:RSA+3DES';\n    ssl_ecdh_curve X25519:P-256:P-384;\n    ssl_prefer_server_ciphers on;\n\n    ssl_session_cache shared:SSL:50m;\n    ssl_session_timeout 1d;\n    ssl_session_tickets on;\n\n    # OCSP Stapling\n    ssl_stapling on;\n    ssl_stapling_verify on;\n    resolver 119.29.29.29 8.8.8.8 valid=300s;\n    resolver_timeout 10s;\n\n    # Security headers\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header Referrer-Policy \"no-referrer-when-downgrade\" always;\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\" always;\n\n    location / {\n      index  index.html;\n      http2_push /style.css;\n    }\n\n    location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|ico)$ {\n      expires 30d;\n    }\n\n    location ~ .*\\.(js|css)?$ {\n      expires 15d;\n    }\n}\n```\n\nä»¥ä¸Šå°±æ˜¯å®Œæ•´çš„ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œè¦†ç›– `/usr/local/nginx/conf/vhost/onmp.ooo.conf` åï¼Œä½¿ç”¨ `service nginx reload` é‡è½½ Nginx å†æ‰“å¼€ç«™ç‚¹å°±èƒ½çœ‹åˆ° HTTPS çš„é¡µé¢äº†\n\n## éªŒè¯\n\nåœ¨ Chrome 65 æˆ–æ›´æ–°çš„ç‰ˆæœ¬ä¸­ï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·çš„ Security èœå•ï¼Œå°±èƒ½åœ¨é‡Œé¢çœ‹åˆ° ç«™ç‚¹æ˜¯å¦ä»¥ TLS1.3 è¿æ¥\n\n![chrome](https://pic.zhih.me/blog/posts/make-your-website-support-tls1.3/chrome.jpg)\n\næˆ–è€…å¯ä»¥åˆ° SSL Server Testï¼šhttps://www.ssllabs.com/ssltest/index.html è¿›è¡Œæµ‹è¯•\n\n![ssllabs](https://pic.zhih.me/blog/posts/make-your-website-support-tls1.3/ssllabs.jpg)\n\næˆ‘åªå¼€å¯äº† TLSv1.2 TLSv1.3 çš„æ”¯æŒï¼Œå¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥è‡ªå·±å¢åŠ å…¶ä»–åè®®çš„æ”¯æŒ\n\n## ç»“è¯­\n\näººä»¬çš„ç”Ÿæ´»å·²ç»ç¦»ä¸å¼€ç½‘ç»œï¼Œæ‰€ä»¥ç½‘ç»œå®‰å…¨åœ¨ç°åœ¨å’Œæœªæ¥éƒ½è‡³å…³é‡è¦ï¼Œæ›¾ç»å¾ˆå¤šç«™é•¿éƒ½ä»¥ HTTPS å½±å“ç«™ç‚¹é€Ÿåº¦ä¸ºç”±ï¼Œåˆæˆ–è€…è¯´ SSL è¯ä¹¦æ˜‚è´µï¼Œæ‹’ç»é… HTTPSï¼Œè€Œéšç€æŠ€æœ¯çš„è¿­ä»£å‡çº§ï¼Œé…ç½® HTTPS+HTTPS2 èƒ½æé«˜ç½‘ç«™é€Ÿåº¦ï¼Œè€Œ SSL ä¸ä»…å¯ä»¥å…è´¹è·å–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å‘½ä»¤è‡ªåŠ¨è·å–è‡ªåŠ¨æ›´æ–°ï¼Œåœ¨æˆ‘çœ‹æ¥å·²ç»æ²¡æœ‰ç†ç”±ä¸é…ç½® HTTPS äº†ï¼Œæ‰€ä»¥å¸Œæœ›å„ä½ç«™é•¿ï¼Œéƒ½èµ¶ç´§ä¸Šè½¦å§\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n\n\n","tags":["nginx","https","web"],"categories":["æ•™ç¨‹"]},{"title":"Syncthingå°±æ˜¯æˆ‘è¦çš„åŒæ­¥å¤‡ä»½è½¯ä»¶","url":"/syncthing-the-best/","content":"\n## å¼•è¨€\n\næ•°æ®æ— ä»·ï¼Œå¹³æ—¶ä¸æ³¨æ„å¤‡ä»½ï¼Œç”µè„‘çªç„¶ç¿»è½¦å°±è¿½æ‚”è«åŠå•¦ã€‚\n\næœ€å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘åœ¨è·¯ç”±å™¨ä¸Šå¼€å¯ Sambaï¼Œæ¯æ¬¡ç¼–è¾‘å®Œé¡¹ç›®å°±æ‰‹åŠ¨æ‹·è´åˆ°è·¯ç”±å™¨ç¡¬ç›˜é‡Œï¼Œéº»çƒ¦ç¨‹åº¦å¯æƒ³è€ŒçŸ¥ï¼Œåæ¥åˆç”¨äº† Google Drive/One Driveï¼Œåˆå› ä¸ºå®ƒä»¬çš„ç½‘ç»œä¸ç†æƒ³ï¼Œå°±åˆæ”¾å¼ƒä½¿ç”¨äº†ã€‚\n\nå…¶å®å°±æ˜¯å¾ˆç®€å•çš„éœ€æ±‚ï¼Œè‡ªåŠ¨å¤‡ä»½ã€é€Ÿåº¦å¿«ï¼Œç„¶åå»æ‰¾äº†ä¸€ä¸‹ï¼Œå‘ç°ä¸€å †äººæ¨èç”¨ Rsyncï¼Œè¿™è´§æˆ‘åªåœ¨ VPS ä¸Šç”¨è¿‡ï¼Œæ‹¿æ¥åšé•œåƒåŒæ­¥ï¼Œä½†æ˜¯è¦åšå®æ—¶åŒæ­¥ï¼Œä¸å¥½é…ç½®ã€‚\n\næˆ‘å°±æƒ³ï¼Œè¿™éœ€æ±‚åº”è¯¥æœ‰ä¸€å¤§å †äººæœ‰å§ï¼Œå°±å» github æœç´¢ syncï¼Œå‘ç° Syncthing è¿™ä¹ˆä¸ªå¥½ä¸œè¥¿ï¼Œæˆªæ­¢ 2018-06-13 å·²ç»å¾—åˆ° 20k+ çš„ starï¼Œå¹¶ä¸”æ›´æ–°å¾ˆæ´»è·ƒ\n\n## ä»‹ç»\n\n![logo](https://pic.zhih.me/blog/posts/syncthing-the-best/logo.jpg)\n\nSyncthing æ˜¯ä¸€ä¸ªæ–‡ä»¶è¿ç»­åŒæ­¥è½¯ä»¶\n\né¡¹ç›®åœ°å€ï¼šhttps://github.com/syncthing/syncthing\n\nå®ƒæœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š\n\n- è·¨å¹³å°\n    - ä½¿ç”¨ Golang å¼€å‘ï¼Œå‡ ä¹èƒ½åœ¨æ‰€æœ‰å¹³å°ä¸Šä½¿ç”¨ï¼ŒåŒ…æ‹¬å¸¸è§çš„å®‰å“æ‰‹æœºå’Œè·¯ç”±å™¨å¹³å°\n\n- æ˜“äºä½¿ç”¨\n    - åªéœ€è¦ä¸‹è½½è¿è¡Œï¼Œæ‰“å¼€æµè§ˆè®¾ç½®æœ¬åœ°ç›®å½•å’Œè¿œç¨‹ä¸»æœºï¼Œå…¶ä»–çš„ä¸éœ€è¦ç®¡\n    \n- å®‰å…¨\n    - ç®¡ç†é¡µå¯ä»¥è®¾ç½®å¯†ç ï¼Œå¯ä»¥è®¾ç½® httpsï¼Œè®¾ç½®å¤‡ä»½éœ€è¦ä¸¤è¾¹éƒ½ç¡®è®¤ï¼Œä½¿ç”¨å”¯ä¸€è®¾å¤‡æ ‡è¯†è¿›è¡Œç¡®è®¤\n\n## å®‰è£…\n\nSyncthing æœ‰å¤šç§å®‰è£…æ–¹å¼\n\næœ‰ä¸€å®š Linux åŸºç¡€çš„äººï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„é…ç½®æ¥è®¾ç½®å¯åŠ¨æœåŠ¡\n\n- https://github.com/syncthing/syncthing/tree/master/etc\n\nWindowsï¼ŒMacï¼ŒLinux å’Œå®‰å“æ‰‹æœºå¯ä»¥åœ¨è¿™é‡Œä¸‹è½½æœ‰ GUI ç•Œé¢çš„ç¨‹åºä½¿ç”¨\n\n- https://docs.syncthing.net/users/contrib.html#gui-wrappers\n\nå…¶ä»–æ–¹æ³•å¯ä»¥è‡ªå·±å†³å®šï¼Œæˆ‘æ˜¯ç›´æ¥ä¸‹è½½å®‰è£…åŒ…å‘½ä»¤è¡Œå¯åŠ¨çš„\n\n### åœ¨ macOS ä¸Šå®‰è£…\n\næˆ‘ç”¨çš„æ˜¯ macOSï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ homebrew å®‰è£…å¯åŠ¨ï¼Œå¹¶ä¸”å¯ä»¥å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼Œä½ ä¹Ÿå¯ä»¥åˆ°è¿™é‡Œ [QSyncthingTray](https://github.com/sieren/QSyncthingTray/releases) ä¸‹è½½ macOS çš„ GUI ç‰ˆ\n\n```bash\nbrew install syncthing\n```\n\nå¯åŠ¨æœåŠ¡ï¼ˆåŒæ—¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼‰\n\n```bash\nbrew services start syncthing \n```\n\nåœæ­¢æœåŠ¡ï¼ˆåŒæ—¶å…³é—­è‡ªå¯ï¼‰\n\n```bash\nbrew services stop syncthing \n```\n\næ‰‹åŠ¨å¯åŠ¨ï¼ˆä¸ä¼šå¼€æœºè‡ªå¯ï¼‰\n\n```bash\nsyncthing\n```\n\nå¯åŠ¨è¿›ç¨‹åï¼Œå¯ä»¥ç”¨æµè§ˆå™¨æ‰“å¼€ `http://localhost:8384/` æ¥æŸ¥çœ‹ web ç®¡ç†é¡µ \n\n### åœ¨ Windows ä¸Šå®‰è£…\n\nWindows ç›´æ¥åœ¨è¿™é‡Œ [SyncTrayzor](https://github.com/canton7/SyncTrayzor/releases) ä¸‹è½½è½¯ä»¶è¿è¡Œ\n\n### åœ¨ Linux VPS ä¸Šå®‰è£…\n\nå¤§å¤šæ•°å‘è¡Œç‰ˆå’Œä¸åŒ CPU å¹³å°çš„å®‰è£…åŒ…ï¼Œå¯ä»¥åœ¨è¿™é‡Œ [Syncthing](https://github.com/syncthing/syncthing/releases) æ‰¾åˆ°ï¼ŒæŠŠå®ƒä¸‹è½½åˆ°ä½ æƒ³è¦æ”¾åœ¨çš„ç›®å½•ç„¶åè®¾ç½®æƒé™ï¼Œä½¿ç”¨å‘½ä»¤è¿è¡Œ\n\næ–‡ç« å¼€å¤´æœ‰ GUI ç‰ˆæœ¬çš„é“¾æ¥ï¼Œä¸è¿‡æˆ‘è¦è£…åœ¨æ²¡æœ‰ GUI çš„ VPS ä¸Šï¼Œæ‰€ä»¥ç›´æ¥ç”¨å‘½ä»¤è¡Œè¿è¡Œï¼Œç³»ç»Ÿç”¨çš„æ˜¯ Debian 9ï¼Œç„¶åç”¨ supervisor è¿›ç¨‹å®ˆæŠ¤æ¥å¯åŠ¨çš„\n\nç¢°å·§å‰å‡ å¤©ä¹‹å‰çš„ä¸€ä¸ªå®¢æˆ·ï¼Œä»–çš„ VPS åšè¿ç§»ï¼Œé˜¿é‡Œäº‘é€äº†å¼ ä»£é‡‘åˆ¸ï¼Œç„¶åå®¢æˆ·å°±é€ç»™æˆ‘äº†\n\n![aff](https://pic.zhih.me/blog/posts/syncthing-the-best/aff.jpg)\n\nç„¶åç»­è´¹ 9 ä¸ªæœˆçš„é˜¿é‡Œäº‘å­¦ç”Ÿæœºï¼Œç¾æ»‹æ»‹ğŸ˜\n\nè™½ç„¶å¸¦å®½æ¯”è¾ƒä½ï¼Œä½†æ˜¯å¯¹äºè¿™ç§è¿ç»­åŒæ­¥çš„å¤‡ä»½æ¥è¯´ï¼Œåœ¨ç¬¬ä¸€æ¬¡å¤‡ä»½ä¹‹åï¼Œåé¢éƒ½æ˜¯å¢é‡å¤‡ä»½äº†ï¼Œé™¤éä½ éƒ½æ˜¯å¤‡ä»½å¤§æ–‡ä»¶ï¼Œè¦ä¸å¯¹å¸¦å®½çš„è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œå¦å¤– 40G çš„ç›˜ï¼Œå®Œå…¨å¤Ÿæˆ‘å¤‡ä»½ç”¨äº†ï¼Œé˜¿é‡Œäº‘æœ€ä¸»è¦å°±æ˜¯ç¨³å®šï¼Œå¾ˆé€‚åˆåšæˆ‘çš„å¤‡ä»½æœº\n\n#### ä¸‹è½½ Syncthing\n\nä¸‹è½½æœ€æ–°çš„åŒ…ï¼Œè§£å‹ï¼Œç§»åŠ¨åˆ° `/bin/` é‡Œï¼Œæ”¹æƒé™\n\n```bash\nwget https://github.com/syncthing/syncthing/releases/download/v0.14.49-rc.1/syncthing-linux-amd64-v0.14.49-rc.1.tar.gz\n\ntar xzvf ./syncthing-linux-amd64-v0.14.49-rc.1.tar.gz\n\nmv ./syncthing-linux-amd64-v0.14.49-rc.1/syncthing /bin/\n\nchmod +x /bin/syncthing\n```\n\n#### è¿›ç¨‹å®ˆæŠ¤\n\nå®‰è£… supervisor\n\n```bash\napt-get install supervisor\n```\n\né…ç½®å®ˆæŠ¤\n\n```bash\nvi /etc/supervisor/conf.d/syncthing.conf\n```\n\nå¡«å…¥ä»¥ä¸‹å†…å®¹\n\n```\n[program:syncthing]\ncommand = /bin/syncthing -no-browser -home=\"/root/.config/syncthing\"\ndirectory = /root\nautorestart = True\nuser = root\nenvironment = STNORESTART=\"1\", HOME=\"/root\"\n```\n\n**æ³¨æ„**ï¼Œæˆ‘ä¾‹å­é‡Œä½¿ç”¨çš„æ˜¯ root ç”¨æˆ·ï¼Œæ‰€ä»¥å“åº”çš„ç›®å½•æ˜¯ `/root`ï¼Œä½ è¦æ˜¯ä½¿ç”¨å…¶ä»–ç”¨æˆ·ï¼Œåº”è¯¥æ˜¯ `/home/ç”¨æˆ·å`ï¼Œå°±æ˜¯ä½ ç™»å½•æ—¶é»˜è®¤æ‰€åœ¨çš„ç›®å½•\n\nç°åœ¨å°±å¯ä»¥ä½¿ç”¨ `supervisorctl` å‘½ä»¤æ¥ç®¡ç†è¿›ç¨‹äº†\n\n- å¯åŠ¨\n\n```bash\nsupervisorctl start syncthing\n```\n\n- é‡å¯\n\n```bash\nsupervisorctl restart syncthing\n```\n\n- åœæ­¢\n\n```bash\nsupervisorctl stop syncthing\n```\n\nå¯åŠ¨è¿›ç¨‹åï¼Œå¯ä»¥ç”¨æµè§ˆå™¨æ‰“å¼€ `http://ä½ çš„IP:8384/` æ¥æŸ¥çœ‹ web ç®¡ç†é¡µ \n\nå¦‚æœæ— æ³•æ‰“å¼€é¡µé¢ï¼Œéœ€è¦ä¿®æ”¹ `/.config/syncthing/config.xml` é‡Œçš„ `127.0.0.1:8384` å­—æ®µä¸º `0.0.0.0:8384`ï¼Œæˆ–è€…ä½ å¯ä»¥å’Œæˆ‘ä¸€æ ·ä½¿ç”¨ nginx åšåå‘ä»£ç†ï¼Œå‰ææ˜¯ä½ çŸ¥é“æ€ä¹ˆåš\n\n### åœ¨è·¯ç”±å™¨ä¸Šå®‰è£…\n\nç›®å‰ [Entware](https://entware.net/) æºé‡Œå·²ç»æœ‰è¿™ä¸ªåŒ…äº†ï¼Œä½†æ˜¯æˆ‘å‘ç°å®ƒæ˜¯ä¸ªæ—§ç‰ˆæœ¬ï¼Œå¹¶ä¸”æœ‰é—®é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘é€‰æ‹©æ‰‹åŠ¨å®‰è£…\n\nè¿™é‡Œçš„ä¾‹å­æ˜¯ LEDE x64 ä½†æ˜¯ä¹Ÿé€‚åˆä¸€åˆ‡å®‰è£…äº† Entware çš„è·¯ç”±å™¨\n\nåœ¨è¿™é‡Œ [Syncthing](https://github.com/syncthing/syncthing/releases) ä¸‹è½½å¯¹åº” CPU å¹³å°çš„å®‰è£…åŒ…ï¼Œå¯ä»¥ç”¨ `uname -m` æŸ¥çœ‹ï¼Œæˆ‘è¿™é‡Œæ˜¯ x86_64 æ‰€ä»¥é€‰æ‹© amd64\n\n#### ä¸‹è½½ syncthing\n\nä¸‹è½½æœ€æ–°çš„åŒ…ï¼Œè§£å‹ï¼Œç§»åŠ¨åˆ° `/opt/bin/` é‡Œï¼Œæ”¹æƒé™\n\n```bash\nwget https://github.com/syncthing/syncthing/releases/download/v0.14.49-rc.1/syncthing-linux-amd64-v0.14.49-rc.1.tar.gz\n\ntar xzvf ./syncthing-linux-amd64-v0.14.49-rc.1.tar.gz\n\nmv ./syncthing-linux-amd64-v0.14.49-rc.1/syncthing /opt/bin/\n\nchmod +x /opt/bin/syncthing\n```\n\n#### æ·»åŠ å¯åŠ¨å‘½ä»¤\n\nåˆ›å»ºå¹¶ç¼–è¾‘ `/opt/etc/init.d/S92syncthing`\n\n```bash\nvi /opt/etc/init.d/S92syncthing\n```\n\nåœ¨é‡Œé¢å¡«ä¸Šä¸‹é¢æ‰€æœ‰å­—æ®µ\n\n```bash\n#!/bin/sh\nENABLED=yes\nPROCS=syncthing\nARGS=\"-home=/opt/etc/syncthing\"\nPREARGS=\"\"\nDESC=$PROCS\nPATH=/opt/sbin:/opt/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\nif [ ! -d /opt/etc/syncthing ]; then\n   /opt/bin/syncthing -generate=\"/opt/etc/syncthing\"\n   sed -i 's|127.0.0.1:8384|0.0.0.0:8384|' /opt/etc/syncthing/config.xml\nelif [[ -f /opt/etc/syncthing/config.xml -a \"127.0.0.1:8384\"==\"127.0.0.1:8384\" ]]; then\n   sed -i 's|127.0.0.1:8384|0.0.0.0:8384|' /opt/etc/syncthing/config.xml\nfi\n\n. /opt/etc/init.d/rc.func\n\n```\n\nç„¶åç»™æƒé™\n\n```bash\nchmod +x /opt/etc/init.d/S92syncthing\n```\n\nç”¨æ³•: /opt/etc/init.d/S92syncthing (start|stop|restart|check)\n\nå¯åŠ¨æœåŠ¡å°±èƒ½åœ¨æµè§ˆå™¨æ‰“å¼€ `è·¯ç”±å™¨IP:8384` ä¾‹å¦‚ `192.168.1.1:8384` æ‰“å¼€ç®¡ç†é¡µäº†\n\n## ä½¿ç”¨æ–¹æ³•\n\næ˜“äºä½¿ç”¨æ˜¯ Syncthing çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œæ‰“å¼€ç®¡ç†é¡µï¼Œä¸€ç›®äº†ç„¶\n\né¦–æ¬¡æ‰“å¼€ç®¡ç†é¡µï¼Œæ‰€æœ‰å¹³å°ä¸Šéƒ½æ˜¯ä¸€æ ·çš„\n\n![syncthing](https://pic.zhih.me/blog/posts/syncthing-the-best/syncthing.jpg)\n\nç„¶åä½ éœ€è¦åšçš„å°±æ˜¯\n\n### è®¾ç½®ç”¨æˆ·åã€å¯†ç \n\n![setpass](https://pic.zhih.me/blog/posts/syncthing-the-best/setpass.jpg)\n\n### è®¾ç½®æ–‡ä»¶å¤¹\n\nåˆ é™¤é»˜è®¤çš„åŒæ­¥æ–‡ä»¶å¤¹ï¼Œæ·»åŠ æ–°åŒæ­¥æ–‡ä»¶å¤¹\n\n![addlocal](https://pic.zhih.me/blog/posts/syncthing-the-best/addlocal.jpg)\n\n### æ·»åŠ è¿œç¨‹è®¾å¤‡\n\n![addremote](https://pic.zhih.me/blog/posts/syncthing-the-best/addremote.jpg)\n\nç„¶åç¨å¾®ç­‰ä¸€åˆ†é’Ÿï¼Œä¸¤è¾¹å°±èƒ½è¿æ¥ä¸Šäº†\n\næœ€ç»ˆæ•ˆæœ\n\n![end](https://pic.zhih.me/blog/posts/syncthing-the-best/end.jpg)\n\n## ç»“è¯­\n\nSyncthing ä½œä¸ºä¸€æ¬¾è·¨å¹³å°åŒæ­¥è½¯ä»¶ï¼Œå®ƒç®€å•æ˜“ç”¨ã€åŠŸèƒ½å®Œå–„å¼ºå¤§ï¼Œå…·æœ‰å¾ˆé«˜çš„ç¨³å®šæ€§ï¼Œå¾ˆå®¹æ˜“è®©äººæƒ³å‡ºå„ç§ä½¿ç”¨åœºæ™¯ï¼Œè€Œä¸”å®ƒè¿˜æ˜¯å¼€æºçš„ï¼Œæ„Ÿè°¢é‚£ä¸Šç™¾ä½è´¡çŒ®è€…\n\næœ¬æ–‡ç®€å•ä»‹ç»äº†åˆçº§ä½¿ç”¨æ–¹æ³•ï¼Œè¿˜æœªæåŠå…¶ä»–çš„è¯¸å¦‚ç‰ˆæœ¬æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½åº”ç”¨ï¼Œå¦‚æœä»¥åæˆ‘è§‰å¾—å€¼å¾—ä¸€è¯´ï¼Œå†æ›´æ–°äº†\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["macOS"],"categories":["æ•™ç¨‹"]},{"title":"macOSè¯»å†™NTFSï¼ŒåŠEXTåˆ†åŒºæ ¼å¼åŒ–å’ŒæŒ‚è½½","url":"/macos-mount-ntfs-ext/","content":"\n## å¼•è¨€\n\næœ‰æ—¶å€™éœ€è¦åœ¨ macOS è¯»å†™ NTFS åˆ†åŒºï¼Œä½†æ˜¯ç³»ç»Ÿé»˜è®¤åªèƒ½è¯»å–ä¸èƒ½å†™å…¥ï¼Œä¿®æ”¹ fstab å’Œä½¿ç”¨ Paragon NTFS è½¯ä»¶éƒ½å¯ä»¥å®ç°è¯»å†™ï¼Œè€Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ osxfuseï¼Œå› ä¸ºå®ƒä¸ä»…èƒ½æ”¯æŒ NTFS, è¿˜æ”¯æŒ Ext ç­‰å…¶ä»–æ–‡ä»¶ç³»ç»Ÿ\n\n![panes](https://pic.zhih.me/blog/posts/macos-mount-ntfs-ext/panes.jpg)\n\nä»¥ä¸‹æ“ä½œéœ€è¦å…³é—­ SIPï¼Œè¿›å…¥æ¢å¤æ¨¡å¼ï¼Œåœ¨ç»ˆç«¯é‡Œè¾“å…¥ `csrutil disable`ï¼Œå†é‡å¯å°±å…³é—­ SIP äº†ï¼Œé»‘è‹¹æœå¯ä»¥åœ¨ clover é‡Œè®¾ç½®\n\n## å®‰è£… osxfuse\n\n`FUSE for OS X` æ˜¯ç”¨åœ¨ macOS ä¸Šçš„ç¬¬ä¸‰æ–¹æ–‡ä»¶ç³»ç»Ÿæ‰©å±•ï¼Œåœ°å€ï¼šhttps://github.com/osxfuse/osxfuse/wiki\n\nä½¿ç”¨ [homebrew](https://brew.sh/) å®‰è£…\n\n```bash\nbrew cask install osxfuse\n```\n\n![osxfuse.jpg](https://pic.zhih.me/blog/posts/macos-mount-ntfs-ext/osxfuse.jpg)\n\näº‹å®ä¸Š FUSE æ˜¯æä¾›äº†æä¾›äº†æ¥å£ï¼Œè¦å®ç° NTFS å’Œ Ext æ–‡ä»¶ç³»ç»Ÿçš„æ”¯æŒï¼Œè¿˜éœ€è¦å®‰è£…æ¨¡å—\n\n## è¯»å†™ NTFS åˆ†åŒº\n\nè®© macOS è¯»å†™ NTFS éœ€è¦å®‰è£… ntfs-3g\n\n```bash\nbrew install ntfs-3g\n```\n\n### æ‰‹åŠ¨æŒ‚è½½\n\nä½¿ç”¨ `diskutil list` æŸ¥çœ‹åˆ†åŒºï¼Œä¾‹å¦‚æˆ‘çš„ U ç›˜æ˜¯ `disk4s1`\n\né‚£ä¹ˆå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æŒ‚è½½\n\n```bash\nmkdir ~/Desktop/UDISK\nsudo ntfs-3g /dev/disk4s1 ~/Desktop/UDISK -o allow_other\n```\n\nè¿™æ · U ç›˜å°±è¢«æŒ‚è½½åˆ°æ¡Œé¢äº†\n\nå¸è½½è¿™ä¸ªåˆ†åŒºçš„å‘½ä»¤å¼æ˜¯ `sudo umount /dev/disk4s1`\n\n**æ³¨æ„ï¼š**ä¸ç®¡æ˜¯ç”¨ä»€ä¹ˆæ–¹å¼æŒ‚è½½ NTFS åˆ†åŒºï¼Œéƒ½ä¸å»ºè®®æŒ‚è½½ win çš„ç³»ç»Ÿç›˜ï¼Œæœ‰ç¿»è½¦å«Œç–‘ï¼Œæ‰€ä»¥å½“ ntfs-3g å‘ç°ä½ æŒ‚è½½çš„åˆ†åŒºæœ‰ win ä¼‘çœ å’Œå¿«é€Ÿå¯åŠ¨é—ç•™çš„ç¼“å­˜æ—¶ï¼Œä¼šä»¥åªè¯»æ¨¡å¼æŒ‚è½½ï¼Œå¦‚æœå®åœ¨éœ€è¦ä¿®æ”¹ win ç³»ç»Ÿåˆ†åŒºï¼Œéœ€è¦åœ¨ win é‡Œå…³é—­å¿«é€Ÿå¯åŠ¨ \n\n### è‡ªåŠ¨æŒ‚è½½\n\næˆ‘ä»¬çŸ¥é“ï¼ŒmacOS å¼€æœºæ—¶ä¼šè‡ªåŠ¨æŒ‚è½½ NTFS åˆ†åŒºï¼Œä½†æ˜¯åªèƒ½è¯»å–\n\nå®‰è£… ntfs-3g åï¼Œæˆ‘ä»¬éœ€è¦è®©æ–°çš„ mount_ntfs æ›¿æ¢ç³»ç»Ÿè‡ªå¸¦çš„ç‰ˆæœ¬ï¼Œå®ç°å†™å…¥\n\nä¸ºäº†å‡å°‘å¯¹ç³»ç»Ÿçš„å½±å“ï¼Œæˆ‘ä»¬æŠŠæ—§ç‰ˆæœ¬å¤‡ä»½ï¼Œå¹¶æŠŠæ–°ç‰ˆæœ¬è½¯é“¾æ¥è¿‡å»\n\n```bash\nsudo mv /sbin/mount_ntfs /sbin/mount_ntfs.bak\nsudo ln -s /usr/local/sbin/mount_ntfs /sbin/mount_ntfs\n```\n\né‡å¯ç”Ÿæ•ˆï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡å‡çº§æˆ–é‡è£…ç³»ç»Ÿä¹‹åï¼Œéœ€è¦é‡æ–°åšè½¯é“¾æ¥\n\nç°åœ¨å¯ä»¥é‡æ–°æ‰“å¼€ SIPï¼Œåœ¨æ¢å¤æ¨¡å¼çš„ç»ˆç«¯é‡Œï¼Œè¾“å…¥ `csrutil enable` å†é‡å¯ï¼Œé»‘æœå¯ä»¥åœ¨ clover é‡Œè®¾ç½®\n\n## EXT æ ¼å¼åŒ–å’ŒæŒ‚è½½\n\next2ã€ext3ã€ext4 æ ¼å¼åŒ–éœ€è¦å®‰è£… e2fsprogsï¼ŒæŒ‚è½½éœ€è¦å®‰è£… [fuse-ext2](https://github.com/alperakcan/fuse-ext2)\n\nfuse-ext2 ä¹Ÿä¾èµ–äº e2fsprogsï¼Œæ‰€ä»¥å…ˆè£…å®ƒ\n\n```bash\nbrew install e2fsprogs\n```\n\nå†å®‰è£… fuse-ext2\n\n```bash\nbrew install https://raw.githubusercontent.com/yalp/homebrew-core/fuse-ext2/Formula/fuse-ext2.rb\n```\n\næ ¹æ®æç¤ºï¼Œè®¾ç½®é¢æ¿é‡Œçš„é€‰é¡¹éœ€è¦è¿™æ ·æ“ä½œæ‰èƒ½æ˜¾ç¤º\n\n```bash\nsudo cp -pR /usr/local/opt/fuse-ext2/System/Library/Filesystems/fuse-ext2.fs /Library/Filesystems/\n\nsudo chown -R root:wheel /Library/Filesystems/fuse-ext2.fs\n\nsudo cp -pR /usr/local/opt/fuse-ext2/System/Library/PreferencePanes/fuse-ext2.prefPane /Library/PreferencePanes/\n\nsudo chown -R root:wheel /Library/PreferencePanes/fuse-ext2.prefPane\n```\n\n![ext](https://pic.zhih.me/blog/posts/macos-mount-ntfs-ext/ext.jpg)\n\nè¿™æ ·å°±è£…å¥½äº†\n\n### EXT åˆ†åŒºæ ¼å¼åŒ–\n\nå‰é¢æˆ‘ä»¬å·²ç»å®‰è£…äº† e2fsprogsï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨å®ƒæä¾›çš„å‘½ä»¤æ¥æ ¼å¼åŒ–åˆ†åŒº\n\nå…ˆè®¾ç½®å˜é‡è®© e2fs åº“é‡Œçš„å‘½ä»¤æš´éœ²å‡ºæ¥ï¼Œå°†ä»¥ä¸‹å­—æ®µåŠ åœ¨ shell çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ç”¨çš„æ˜¯ zshï¼Œæ‰€ä»¥åŠ åœ¨ `~/.zshrc` é‡Œ\n\n```\nexport PATH=\"/usr/local/opt/e2fsprogs/bin:$PATH\"\nexport PATH=\"/usr/local/opt/e2fsprogs/sbin:$PATH\"\n```\n\né‡å¯ç»ˆç«¯æˆ–æ‰§è¡Œ `source ~/.zshrc` ç”Ÿæ•ˆ\n\nç°åœ¨å°±èƒ½æ‰§è¡Œ `mkfs.ext2` `mkfs.ext3` `mkfs.ext4` ç­‰å‘½ä»¤äº†\n\nç”¨æ³•ï¼š\n\n```bash\nmkfs.ext4 [-c|-l æ–‡ä»¶å] [-b å—å¤§å°] [-C ç°‡å¤§å°]\n    [-i æ¯inodeçš„å­—èŠ‚æ•°] [-I inodeå¤§å°] [-J æ—¥å¿—é€‰é¡¹]\n    [-G å¼¹æ€§ç»„å¤§å°] [-N inodeæ•°] [-d æ ¹ç›®å½•]\n    [-m ä¿ç•™å—æ‰€å ç™¾åˆ†æ¯”] [-o åˆ›å§‹ç³»ç»Ÿå]\n    [-g æ¯ç»„çš„å—æ•°] [-L å·æ ‡] [-M ä¸Šä¸€æ¬¡æŒ‚è½½ç‚¹]\n    [-O ç‰¹æ€§[,...]] [-r æ–‡ä»¶ç³»ç»Ÿç‰ˆæœ¬] [-E æ‰©å±•é€‰é¡¹[,...]]\n    [-t æ–‡ä»¶ç³»ç»Ÿç±»å‹] [-T ç”¨æ³•ç±»å‹] [-U UUID] [-e é”™è¯¯è¡Œä¸º][-z æ’¤é”€æ–‡ä»¶]\n    [-jnqvDFKSV] è®¾å¤‡ [å—æ•°]\n```\n\nä½¿ç”¨ `diskutil list` æŸ¥çœ‹åˆ†åŒºï¼Œä¾‹å¦‚æˆ‘æƒ³è¦æ ¼å¼åŒ–ä¸º ext4 çš„åˆ†åŒºæ˜¯ `disk3s1`\n\n```bash\nsudo mkfs.ext4 /dev/disk3s1\n```\n\n### æŒ‚è½½ EXT åˆ†åŒº\n\nä½¿ç”¨ `diskutil list` æŸ¥çœ‹åˆ†åŒºï¼Œä¾‹å¦‚æˆ‘æœ‰ä¸ª Ext4 åˆ†åŒºæ˜¯ `disk3s1`\n\né‚£ä¹ˆå‘½ä»¤æ˜¯è¿™æ ·çš„\n\n```bash\nmkdir ~/Desktop/DISK\nsudo mount -t fuse-ext2 /dev/disk3s1 ~/Desktop/DISK\n```\n\nè¿™æ ·å°±æŒ‚è½½ä¸Šäº†\n\nå¸è½½è¿™ä¸ªåˆ†åŒºçš„å‘½ä»¤å¼æ˜¯ `sudo umount /dev/disk3s1`\n\n## ç»“è¯­\n\nå¹³å¸¸è¿™äº›æŒ‚è½½å·¥å…·ç”¨çš„ç¡®å®ä¸æ˜¯å¾ˆå¤šï¼Œä½†æ˜¯éœ€è¦ç”¨çš„æ—¶å€™ï¼Œåˆå¾ˆæ— å¥ˆï¼Œæ‰€ä»¥ç›´æ¥å†™ä¸ªç¬”è®°è®°å½•ä¸€ä¸‹ï¼Œä»¥åè¦ç”¨çš„æ—¶å€™æ–¹ä¾¿äº›\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["macOS"],"categories":["æ•™ç¨‹"]},{"title":"WEBæ˜¯å¦‚ä½•å·¥ä½œçš„","url":"/how-the-web-works/","content":"\n## å¼•è¨€\n\næœ¬æ¥å¾ˆçŠ¹è±«æ˜¯å¦è¦å†™ä¸€ä¸‹è¿™ç¯‡æ–‡ç« çš„ï¼Œæ¯•ç«Ÿè‡ªå·±çŸ¥ä¹‹ç”šå°‘ï¼Œè¯´äº›æµ…çš„çŸ¥è¯†è¿˜è¡Œï¼Œä¸€æ—¦æ·±å…¥ï¼Œå°±ä¼šæ¼äº†é©¬è„šã€‚ä½†æ˜¯ï¼Œå¦ä¸€æ–¹é¢æƒ³ï¼Œæ—¢ç„¶çŸ¥é“è‡ªå·±æ‡‚çš„ä¸å¤Ÿï¼Œå°±æ›´åº”è¯¥æŠŠçŸ¥é“çš„ç»™æ¢³ç†å‡ºæ¥ï¼Œä¹Ÿå¥½è¿›è¡Œä¸‹ä¸€æ­¥çš„å­¦ä¹ ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« ä¹Ÿç®—æ˜¯å¯¹å½“å‰æ‰€å­¦æ‰€çŸ¥è¿›è¡Œä¸€ä¸ªæ€»ç»“å§ï¼Œé›ğŸ˜‚ã€‚\n\n## ç®€è§£\n\nå…ˆä¸Šä¸€ä¸ªå¤§æ¦‚çš„å›¾è§£\n\n![è¿‡ç¨‹å›¾è§£](https://pic.zhih.me/blog/posts/how-the-web-works/è¿‡ç¨‹å›¾è§£.jpg)\n\nä¸Šå›¾ç®€å•çš„è§£é‡Šäº†æ‰“å¼€ä¸€ä¸ªç½‘é¡µçš„è¿‡ç¨‹ï¼Œç¨å¾®è¯¦ç»†çš„è§£é‡Šå°±æ˜¯ï¼š\n\n1. æµè§ˆå™¨å¾—åˆ°ç½‘å€ï¼Œå¹¶æŠŠç½‘å€æ‹†è§£ä¸ºåŸŸåå’Œè·¯å¾„\n    ![URL](https://pic.zhih.me/blog/posts/how-the-web-works/ç®€è§£url.jpg)\n\n2. æµè§ˆå™¨å¯»æ‰¾åŸŸåå¯¹åº”çš„ IP\n    + å…ˆåœ¨æµè§ˆå™¨è‡ªå·±çš„ç¼“å­˜é‡Œæ‰¾ï¼Œå¦‚æœä¹‹å‰è®¿é—®è¿‡ï¼Œä¼šæœ‰ç¼“å­˜\n    + å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œåˆ™è®©æ‰‹æœºæˆ–ç”µè„‘å‘ DNS æœåŠ¡å™¨è¯·æ±‚è·å–\n\n3. æµè§ˆå™¨å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®\n\n4. æœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œå¾—åˆ°è¯·æ±‚çš„è·¯å¾„å‚æ•°ç­‰\n    + å¦‚æœæ˜¯é™æ€é¡µé¢ï¼Œç›´æ¥æ‰¾åˆ°å¯¹åº”çš„é™æ€æ–‡ä»¶\n    + å¦‚æœæ˜¯åŠ¨æ€é¡µé¢ï¼Œè°ƒç”¨åŠ¨æ€è¯­è¨€å¤„ç†æ•°æ®åˆæˆé¡µé¢ï¼Œå†äº¤ç»™ HTTP æœåŠ¡å™¨\n\n5. æœåŠ¡å™¨æŠŠé¡µé¢å‘å›æµè§ˆå™¨\n\n6. æµè§ˆå™¨å¾—åˆ°æ•°æ®ï¼Œè¿›è¡Œè§£æã€æ¸²æŸ“ã€è¾“å‡º\n\næœ€ç»ˆå°±çœ‹åˆ°äº†ç½‘é¡µã€‚\n\n---\n\nä»ä¸Šé¢çš„ç®€è§£æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè®¿é—®çš„è¿‡ç¨‹å¤§æ¦‚å¯åˆ†ä¸ºï¼šURLï¼ŒDNS æŸ¥è¯¢ï¼ŒHTTPï¼Œæµè§ˆå™¨ï¼Œè¿™å››ä¸ªéƒ¨åˆ†ã€‚\n\n## URL\n\n>URL æ˜¯ Uniform Resource Locator çš„ç®€å†™ï¼Œä¸­æ–‡ï¼šç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œåœ¨ web ä¸­å¾ˆå¤šæ—¶å€™è¢«å«åš â€˜ç½‘å€â€™ã€‚\n\nURL çš„æ ‡å‡†æ ¼å¼å¦‚ä¸‹ï¼š\n\n```\nåè®®:[//åœ°å€[:ç«¯å£]][/è·¯å¾„]æ–‡ä»¶[?æ•°æ®][#é”šç‚¹]\n\n- åè®®ï¼š åœ¨ web ä¸­é€šå¸¸ä½¿ç”¨ httpï¼Œhttps\n- åœ°å€ï¼š åŸŸåæˆ–è€… IP åœ°å€\n- ç«¯å£ï¼š é»˜è®¤æƒ…å†µä¸‹ï¼Œhttp ä½¿ç”¨ 80 ç«¯å£ã€https ä½¿ç”¨ 443 ç«¯å£çš„æ—¶å€™ï¼Œå¯ä»¥çœç•¥\n- è·¯å¾„ï¼š è¦è®¿é—®èµ„æºæ‰€åœ¨çš„ç›®å½•\n- æ–‡ä»¶ï¼š å½“è¯·æ±‚çš„æ˜¯å…·ä½“ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œæ¯”å¦‚ä¸€å¼ å›¾ç‰‡ï¼Œéœ€è¦å†™æ¸…æ¥šï¼Œå¦åˆ™ç”±æœåŠ¡å™¨å†³å®šè¿”å›è®¾ç½®çš„æ–‡ä»¶ï¼Œä¸€èˆ¬æ˜¯ `index.html`\n- æ•°æ®ï¼š ? åå†™ GET è¯·æ±‚çš„å‚æ•°ï¼Œæ¯ä¸ªå‚æ•°ä»¥ & éš”å¼€ï¼Œå†ä»¥ = åˆ†å¼€å‚æ•°åç§°ä¸æ•°æ®\n- é”šç‚¹ï¼š # åé¢çš„æ•°æ®ä¸ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ï¼Œå®ƒä»£è¡¨ç½‘é¡µä¸­çš„ä¸€ä¸ªä½ç½®\n```\n\n**å‘ç”Ÿäº†ä»€ä¹ˆ**\n\næµè§ˆå™¨è·å–åˆ°ç”¨æˆ·è¾“å…¥çš„ URLï¼Œå°±æŒ‰ç…§ä»¥ä¸Šæ ¼å¼è¿›è¡Œè§£æï¼Œå¦‚æœä¸ç¬¦åˆæ ‡å‡†æ ¼å¼ï¼Œåˆ™ä¼šåˆ¤æ–­ä¸ºç”¨æˆ·è¾“å…¥äº†å…³é”®å­—ï¼Œå¹¶è·³è½¬åˆ°æœç´¢å¼•æ“æœç´¢ï¼Œå½“ URL ä¸­å­˜åœ¨ä¸æ˜¯ ASCII çš„å­—ç¬¦ä¸²æ—¶ï¼Œä¼šæŠŠå­—ç¬¦ä¸²è½¬æˆ [punycode](https://en.wikipedia.org/wiki/Punycode) æ ‡å‡†ç¼–ç çš„å­—ç¬¦ä¸²ã€‚\n\nè·å–åˆ°åŸŸååï¼Œæµè§ˆå™¨é¦–å…ˆä¼šåœ¨æµè§ˆå™¨çš„ç¼“å­˜ä¸­æŸ¥æ‰¾ä¸å®ƒç›¸å…³çš„èµ„æºï¼Œæ¯”å¦‚ DNS ç¼“å­˜ã€é™æ€èµ„æºç¼“å­˜\n\næµè§ˆå™¨çš„ DNS ç¼“å­˜ä¼šæŠŠä¹‹å‰è®¿é—®è¿‡çš„åŸŸåå¯¹åº” IP ç¼“å­˜èµ·æ¥ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨ï¼Œä¸€èˆ¬ä¼šä¿å­˜ TTL(DNS æœåŠ¡å™¨ä¸Šç¼“å­˜æ—¶é—´)ã€Expires(æµè§ˆå™¨è®°å½•çš„åˆ°æœŸæ—¶é—´)\n\n**å¦‚æœæ²¡æœ‰ç¼“å­˜**ï¼Œåˆ™è¿›è¡Œä¸‹ä¸€æ­¥ï¼ŒDNS æŸ¥è¯¢\n\n## DNS æŸ¥è¯¢\n\n>DNS æŸ¥è¯¢å°±æ˜¯æŠŠç½‘å€ç¿»è¯‘æˆ IP åœ°å€ã€‚\n\næ¯”æ–¹è¯´ä½ çš„ç”µè„‘ä¸çŸ¥é“ www.zhih.me è¿™ä¸ªåŸŸåçš„ IP åœ°å€ï¼Œä»–å°±ä¼šå‘ DNS æœåŠ¡å™¨å‘é€ä¸ªè¯·æ±‚ï¼Œè®© DNS æœåŠ¡å™¨å¸®ä»–å¯»æ‰¾ï¼Œæ­¤æ—¶ä½ çš„ç”µè„‘å°±æ˜¯ä¸€ä¸ª DNS å®¢æˆ·ç«¯ï¼Œå®é™…ä¸Šæ•´ä¸ªå…·ä½“è¿‡ç¨‹ä¼šæœ‰ä¸åŒçš„æƒ…å†µã€‚\n\n### åŸŸåçš„ç»“æ„\n\næƒ³è¦ç†è§£ DNS æŸ¥è¯¢è¿‡ç¨‹ï¼Œè¿˜å¾—å…ˆçŸ¥é“åŸŸåçš„ç»“æ„ã€‚\n\nä»¥ www.zhih.me è¿™ä¸ªåŸŸåä¸ºä¾‹ï¼Œå®ƒæ˜¯ä¸ªå…¨ç§°åŸŸåï¼ˆFQDNï¼‰\n\nå½“ä½ çœ‹åˆ°å®ƒæ—¶ï¼Œåº”å½“ä»å³å¾€å·¦è¯»\n\n![domain1](https://pic.zhih.me/blog/posts/how-the-web-works/domain1.jpg)\n\nè€Œæ•´ä¸ªåŸŸåç³»ç»Ÿçš„ç»“æ„æ˜¯è¿™æ ·çš„\n\n![domain2](https://pic.zhih.me/blog/posts/how-the-web-works/domain2.jpg)\n\næ ¹åŸŸï¼šå‚¨å­˜äº†è´Ÿè´£æ¯ä¸ªåŸŸï¼ˆå¦‚comã€cnã€meç­‰ï¼‰çš„è§£æçš„åŸŸåæœåŠ¡å™¨çš„åœ°å€ä¿¡æ¯\n\né¡¶çº§åŸŸå(TLD)ï¼šåˆ†ä¸ºé€šç”¨ã€å›½å®¶ã€èµåŠ©å’Œåœ°ç†å‡ ç§ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæŸäº›ç»„ç»‡æˆ–ç”¨é€”\n\näºŒçº§åŸŸå(SLD)ï¼šè¡¨ç¤ºç»„ç»‡ã€ä¸ªäººã€ç‰¹å®šæ„ä¹‰çš„åç§°\n\nä¸‰çº§åŸŸåï¼šä¾‹å¦‚ï¼š`sina.com.cn`ï¼Œsina æ˜¯ä¸€ä¸ªä¸‰çº§åŸŸåï¼ŒåŒæ—¶åˆæ˜¯ `com.cn` çš„å­åŸŸå\n\nå­åŸŸåï¼šå­åŸŸåä¸ä¸‰çº§åŸŸåä¸åŒï¼Œä¾‹å¦‚ï¼š`www.zhih.me`ï¼Œwww æ˜¯ `zhih.me` çš„å­åŸŸåï¼Œä½†å´ä¸æ˜¯ä¸‰çº§åŸŸå\n\n### DNS æŸ¥è¯¢è¿‡ç¨‹\n\n**æœ¬åœ°è§£æ**\n\n1. æŸ¥çœ‹ HOSTS è®°å½•ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥è¿”å›ç»“æœ\n2. æŸ¥çœ‹ DNS ç¼“å­˜ï¼Œçœ‹çœ‹å®ƒé‡Œé¢æ˜¯ä¸æ˜¯æœ‰ä½ è®¾ç½®çš„åŸŸå IP åœ°å€ï¼Œç¼“å­˜ä¿¡æ¯æ˜¯é€šè¿‡ä»¥å‰çš„æŸ¥è¯¢è·å¾—çš„ï¼Œç”µè„‘å…³æœºæ—¶ç¼“å­˜å°†ä¼šè¢«æ¸…ç©º\n\n**ç›´æ¥è§£æ**\n\næœ¬åœ°æ‰¾ä¸åˆ°ï¼Œå°±å‘ä½ ç”µè„‘é‡Œè®¾ç½®çš„ DNS æœåŠ¡å™¨è¯·æ±‚ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®å…·ä½“çš„åœ°å€ï¼Œè€Œæ˜¯è‡ªåŠ¨è·å–ï¼Œå°±ä¼šä» ISP ä¸­è·å– DNS æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œæˆ‘è‡ªå·±ä½¿ç”¨çš„æ˜¯è…¾è®¯çš„ DNS æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¸€èˆ¬æŠŠå®ƒå«åšæœ¬åœ° DNS æœåŠ¡å™¨\n\n![dnsquery-1](https://pic.zhih.me/blog/posts/how-the-web-works/dnsquery-1.jpg)\n\nå½“æœ¬åœ° DNS æœåŠ¡å™¨æ‰¾ä¸åˆ°ç»“æœæ—¶ï¼Œå°±éœ€è¦è·Ÿå…¶ä»– DNS æœåŠ¡å™¨æŸ¥è¯¢è·å–\n\n**å®Œæ•´è§£æè¿‡ç¨‹**\n\n![dnsquery-2](https://pic.zhih.me/blog/posts/how-the-web-works/dnsquery-2.jpg)\n\nè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ä½¿ç”¨ dig å‘½ä»¤æŸ¥çœ‹\n\n```bash\ndig www.zhih.me +trace\n```\n\nè¿™æ ·ï¼Œç”µè„‘å°±æ‹¿åˆ°åŸŸåå¯¹åº”çš„ IP åœ°å€äº†\n\n## HTTP\n\nå…³äºæ˜¯ä»€ä¹ˆï¼Œåœ¨ç»´åŸºç™¾ç§‘å·²ç»å†™çš„å¾ˆè¯¦ç»†äº†ï¼Œè‡ªå·±çœ‹çœ‹å§\n\nhttps://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol\n\nå‰é¢æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº† IPï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å°±è¦å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”äº†\n\n### è¯·æ±‚æ–¹æ³•\n\n| æ–¹æ³• | æè¿° |\n| ---- | ---- |\n| GET | è¯·æ±‚æŒ‡å®šçš„é¡µé¢ä¿¡æ¯ï¼Œå¹¶è¿”å›å®ä½“ä¸»ä½“ |\n| HEAD | ç±»ä¼¼äºgetè¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›çš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºè·å–æŠ¥å¤´ |\n| POST | å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚ä½“ä¸­ã€‚POSTè¯·æ±‚å¯èƒ½ä¼šå¯¼è‡´æ–°çš„èµ„æºçš„å»ºç«‹å’Œ/æˆ–å·²æœ‰èµ„æºçš„ä¿®æ”¹ |\n| PUT | ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®å–ä»£æŒ‡å®šçš„æ–‡æ¡£çš„å†…å®¹ |\n| DELETE | è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šçš„é¡µé¢ |\n| CONNECT | HTTP/1.1åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ |\n| OPTIONS | å…è®¸å®¢æˆ·ç«¯æŸ¥çœ‹æœåŠ¡å™¨çš„æ€§èƒ½ã€‚ |\n| TRACE | å›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ |\n\n### HTTP çŠ¶æ€ç \n\n> HTTPçŠ¶æ€ç ï¼ˆHTTP Status Codeï¼‰æ˜¯ç”¨ä»¥è¡¨ç¤ºç½‘é¡µæœåŠ¡å™¨HTTPå“åº”çŠ¶æ€çš„3ä½æ•°å­—ä»£ç ã€‚å®ƒç”± RFC 2616 è§„èŒƒå®šä¹‰çš„ï¼Œå¹¶å¾—åˆ°RFC 2518ã€RFC 2817ã€RFC 2295ã€RFC 2774ã€RFC 4918ç­‰è§„èŒƒæ‰©å±•ã€‚\n\nåº”è¯¥æ¯ä¸ªç½‘æ°‘éƒ½ä¸é™Œç”Ÿï¼Œæˆ–å¤šæˆ–å°‘é‡åˆ°è¿‡ 404 not fount\n\nçŠ¶æ€ç æœ‰ç›¸å½“å¤šï¼Œåœ¨è¿™é‡Œæˆ‘å°±åˆ—å‡ºä»–ä»¬çš„åˆ†ç±»\n\n| ç±»å‹ | ç±»åˆ« | æè¿° |\n| --- | --- | --- |\n| 1xx | ä¿¡æ¯ | è¯·æ±‚å·²è¢«æ¥å—ï¼Œéœ€è¦ç»§ç»­å¤„ç† |\n| 2xx | æˆåŠŸ | æ“ä½œè¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç† |\n| 3xx | é‡å®šå‘ | éœ€è¦å®¢æˆ·ç«¯é‡‡å–è¿›ä¸€æ­¥çš„æ“ä½œæ‰èƒ½å®Œæˆè¯·æ±‚ |\n| 4xx | å®¢æˆ·ç«¯é”™è¯¯ | è¯·æ±‚çš„å‚æ•°é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚ |\n| 5xx | æœåŠ¡å™¨é”™è¯¯ | æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­æœ‰é”™è¯¯æˆ–è€…å¼‚å¸¸ |\n\n### HTTP æ¶ˆæ¯ç»“æ„\n\nåœ¨ shell ä¸­ä½¿ç”¨ `curl -v` å‘½ä»¤å°±å¯ä»¥çœ‹åˆ°è¯·æ±‚å’Œå“åº”çš„æ¶ˆæ¯äº†\n\nä»¥æœ€å¸¸ç”¨çš„ get è¯·æ±‚ä¸ºä¾‹ï¼š\n\n```bash\ncurl -v https://mov.zhih.me/weapp/list/1/2\n```\n\n![res_req.jpg](https://pic.zhih.me/blog/posts/how-the-web-works/res_req.jpg)\n\n### HTTP è¯·æ±‚\n\nè¯·æ±‚æŠ¥æ–‡çš„ä¸€èˆ¬åŒ…æ‹¬ä»¥ä¸‹æ ¼å¼ï¼šè¯·æ±‚è¡Œã€è¯·æ±‚å¤´éƒ¨ã€ç©ºè¡Œå’Œè¯·æ±‚æ•°æ®\n\n```\nGET /weapp/list/1/2 HTTP/2\n//è¯·æ±‚è¡Œ: è¯·æ±‚æ–¹æ³• è¯·æ±‚URI HTTPåè®®/åè®®ç‰ˆæœ¬\nHost: mov.zhih.me\n//æœåŠ¡ç«¯çš„ä¸»æœºå\nuser-agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36\n//æµè§ˆå™¨ UA\naccept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\n//å®¢æˆ·ç«¯èƒ½æ¥æ”¶çš„mine\naccept-encoding: gzip, deflate, br\n//æ˜¯å¦æ”¯æŒæµå‹ç¼©\n# ç©ºè¡Œ\n# è¯·æ±‚æ•°æ®\n```\n\nè¯·æ±‚å¤´éƒ¨å°±æ˜¯è¯·æ±‚è¡Œå’Œç©ºè¡Œä¹‹é—´çš„é”®å€¼å¯¹\n\n### HTTP å“åº”\n\nå“åº”æŠ¥æ–‡ä¹Ÿç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šçŠ¶æ€è¡Œã€æ¶ˆæ¯æŠ¥å¤´ã€ç©ºè¡Œå’Œå“åº”æ­£æ–‡\n\n```\nHTTP/2 200\n//çŠ¶æ€è¡Œï¼šHTTPåè®®ç‰ˆæœ¬å·ï¼Œ çŠ¶æ€ç ï¼Œ çŠ¶æ€æ¶ˆæ¯\nserver: nginx/1.14.0\n//web æœåŠ¡å™¨è½¯ä»¶ååŠç‰ˆæœ¬\ndate: Thu, 17 May 2018 14:46:50 GMT\n//å‘é€æ—¶é—´\ncontent-type: application/json; charset=utf-8\n//æœåŠ¡å™¨å‘é€ä¿¡æ¯çš„ç±»å‹\ncontent-length: 589\n//ä¸»ä½“å†…å®¹é•¿åº¦\n# ç©ºè¡Œ \n{\"code\":200,\"data\":[{\"rank\":1,\"movid\":1292052,\"rating\":9.6,\"title\":\"è‚–ç”³å…‹çš„æ•‘èµ\",\"genres\":[\"çŠ¯ç½ª\",\"å‰§æƒ…\"],\"year\":1994,\"directors\":[\"å¼—å…°å…‹Â·å¾·æ‹‰é‚¦ç‰¹\"],\"casts\":[\"è’‚å§†Â·ç½—å®¾æ–¯\",\"æ‘©æ ¹Â·å¼—é‡Œæ›¼\",\"é²å‹ƒÂ·å†ˆé¡¿\"],\"image\":\"https://img3.doubanio.com/view/photo/s_ratio_poster/public/p480747492.jpg\"},{\"rank\":2,\"movid\":1291546,\"rating\":9.5,\"title\":\"éœ¸ç‹åˆ«å§¬\",\"genres\":[\"å‰§æƒ…\",\"çˆ±æƒ…\",\"åŒæ€§\"],\"year\":1993,\"directors\":[\"é™ˆå‡¯æ­Œ\"],\"casts\":[\"å¼ å›½è£\",\"å¼ ä¸°æ¯…\",\"å·©ä¿\"],\"image\":\"https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1910813120.jpg\"}]}% \n//å“åº”æ­£æ–‡\n```\n\n## æœåŠ¡å™¨\n\nå‰é¢è¯´äº†æ•°æ®æ€ä¹ˆå‘é€åˆ°æœåŠ¡å™¨ï¼Œç°åœ¨è¯´è¯´æœåŠ¡å™¨å¦‚ä½•å¤„ç†æ”¶åˆ°çš„æ•°æ®\n\nå½“ç„¶ï¼Œè¿™éƒ¨åˆ†çš„æƒ…å†µç›¸å½“å¤æ‚ï¼Œä¸åŒåœºæ™¯æœ‰ä¸åŒçš„æ–¹æ¡ˆï¼Œæˆ‘è¿™é‡Œåªç®€å•çš„ä¸¾äºŒä¸‰çš„ä¾‹å­\n\n### é™æ€ç«™ç‚¹\n\næˆ‘çš„åšå®¢ zhih.me å°±æ˜¯ä¸ªé™æ€ç«™ç‚¹ï¼Œé€šè¿‡æ¨¡æ¿å¼•æ“æŠŠæ•°æ®æ¸²æŸ“æˆé™æ€ HTML æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å°±å­˜åœ¨æœåŠ¡å™¨ä¸Šç­‰å¾…ä¸‹è½½ï¼Œæµè§ˆå™¨è·å–é¡µé¢å°±æ˜¯ä¸ªæ–‡ä»¶ä¸‹è½½çš„è¿‡ç¨‹ã€‚\n\n1. æµè§ˆå™¨å‘é€ HTTP è¯·æ±‚ï¼Œè¯·æ±‚é‡ŒåŒ…å«äº†æ–‡ä»¶çš„è·¯å¾„ã€ä¸»æœºåç­‰ä¿¡æ¯\n2. æˆ‘çš„æœåŠ¡å™¨ç›‘å¬äº† 80 å’Œ 443 ç«¯å£ï¼Œå‘ç°æœ‰æ•°æ®ä¼ æ¥ï¼Œå°†è¯·æ±‚æŠ›ç»™è™šæ‹Ÿä¸»æœº\n3. è™šæ‹Ÿä¸»æœºå‘ç°è¯·æ±‚çš„è·¯å¾„æ˜¯ '/'ï¼Œå°±æŠŠç½‘ç«™æ ¹ç›®å½•ä¸‹çš„ `index.html` è¿”å›ç»™è¯·æ±‚è€… \n\n### åŠ¨æ€ç«™ç‚¹\n\nè¿™é‡Œè¯´çš„åŠ¨æ€ç«™ç‚¹ï¼ŒæŒ‡é¡µé¢æ˜¯ç”±åç«¯å¤„ç†æ•°æ®åˆæˆçš„\n\nå¸¸è§çš„ä¾‹å­å°±æ˜¯ WordPressï¼ŒWP åº”è¯¥æ˜¯ç°åœ¨è¢«ä½¿ç”¨å¾—æœ€å¤šçš„ CMS äº†ï¼Œå®ƒçš„å¤„ç†è¿‡ç¨‹åº”è¯¥æ˜¯è¿™æ ·çš„\n\n1. æµè§ˆå™¨å‘é€ HTTP è¯·æ±‚ï¼Œè¯·æ±‚é‡ŒåŒ…å«äº†æ–‡ä»¶çš„è·¯å¾„ã€ä¸»æœºåç­‰ä¿¡æ¯\n2. æˆ‘çš„æœåŠ¡å™¨ç›‘å¬äº† 80 å’Œ 443 ç«¯å£ï¼Œå‘ç°æœ‰æ•°æ®ä¼ æ¥ï¼Œå‘ç°æœ‰æ•°æ®ä¼ æ¥ï¼Œå°†è¯·æ±‚æŠ›ç»™è™šæ‹Ÿä¸»æœº\n3. è™šæ‹Ÿä¸»æœºå‘ç°è¯·æ±‚çš„è·¯å¾„æ˜¯ '/'ï¼Œè€Œ '/' è¿™ä¸ªè·¯å¾„å·²ç»æŒ‡å®šäº† PHP å¤„ç†ï¼Œäºæ˜¯æŠŠè¯·æ±‚æŠ›ç»™äº† `index.php` å¤„ç†\n4. WP è§£æè¯·æ±‚é‡Œçš„æ•°æ®ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆå‚æ•°ï¼Œä½ è®¿é—®çš„æ˜¯é¦–é¡µï¼Œä¹Ÿæ²¡å¸¦ä»€ä¹ˆå‚æ•°ï¼Œäºæ˜¯ WP å°±ä»æ•°æ®åº“é‡ŒæŠŠé¦–é¡µçš„æ–‡ç« è°ƒå‡ºæ¥ï¼Œç„¶ååœ¨ PHP é‡Œéå†åˆæˆ HTML æ–‡ä»¶ï¼Œå¹¶äº¤ç»™è™šæ‹Ÿä¸»æœº\n5. è™šæ‹Ÿä¸»æœºæŠŠ HTML é¡µé¢è¿”å›ç»™è¯·æ±‚è€…\n\n### å‰ååˆ†ç¦»ç«™ç‚¹\n\nå‰ååˆ†ç¦»æ˜¯ç°åœ¨å’Œæœªæ¥çš„è¶‹åŠ¿ï¼Œå¤§å¤šæ•° WebApp éƒ½æ˜¯è¿™ç§æ¶æ„ï¼Œç®€å•è¯´å°±æ˜¯ä½¿ç”¨ AJAX è·å–æ•°æ®åœ¨å®¢æˆ·ç«¯è¿›è¡Œæ¸²æŸ“ã€‚\n\n1. è·å–é™æ€èµ„æºï¼ˆé™æ€ç«™ç‚¹çš„æ•´ä¸ªè¿‡ç¨‹ï¼‰ï¼ŒJS è·‘èµ·æ¥åå¼€å§‹è¯·æ±‚æ•°æ®\n2. åç«¯ç¨‹åºè·å–è¯·æ±‚ï¼Œè§£æè¯·æ±‚æ•°æ®ï¼Œä»æ•°æ®åº“é‡Œæå–æ•°æ®ï¼Œè¿”å›æ•°æ®\n3. å‰ç«¯ç¨‹åºå¾—åˆ°æ•°æ®ï¼Œéå†æ•°æ®ï¼Œæ¸²æŸ“é¡µé¢\n\n## æµè§ˆå™¨\n\nå‰é¢æˆ‘ä»¬å°±æ˜¯ä»æµè§ˆå™¨å¼€å§‹çš„ï¼Œç°åœ¨åˆå›åˆ°äº†æµè§ˆå™¨ï¼Œæµè§ˆå™¨æ˜¯ä¸ªå¸¸ç”¨ä¸”çœ‹ä¼¼ç®€å•çš„è½¯ä»¶ï¼Œä½†æ˜¯è®²çœŸï¼ŒåŸç†çœŸçš„æŒºå¤æ‚çš„ï¼Œæˆ‘è¿™é‡Œåªèƒ½è¯´è¯´è§£æå’Œæ¸²æŸ“ç›¸å…³çš„ä¸€ç‚¹ç‚¹çš®æ¯›çŸ¥è¯†ï¼Œå¦‚æœ‰é”™è¯¯æ¬¢è¿æ–§æ­£ã€‚\n\næ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œè®¿é—®ä¸€ä¸ªç½‘é¡µï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯\n\n![chrome](https://pic.zhih.me/blog/posts/how-the-web-works/chrome.jpg)\n\nåŸºæœ¬è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š\n\n```\nåŠ è½½ HTML -> è§£æ HTML -> æ„å»º DOM æ ‘ -> æ„å»º CSSOM æ ‘ -> æ„å»ºæ¸²æŸ“æ ‘ -> å¸ƒå±€ã€ç»˜åˆ¶\n```\n**ä½†æ˜¯**ï¼Œç°ä»£æµè§ˆå™¨ä¸ºäº†æ›´å¿«çš„æ˜¾ç¤ºé¡µé¢ï¼Œå¾ˆå¤šä»»åŠ¡éƒ½æ˜¯åŒæ—¶è¿›è¡Œçš„ï¼Œä¼šä¸€è¾¹è§£æ HTMLï¼Œä¸€è¾¹ä¸‹è½½å¤–éƒ¨èµ„æºï¼Œè¿˜ä¸€è¾¹è¿›è¡Œæ¸²æŸ“ã€‚\n\n### è§£æ HTML å¹¶æ„å»º DOM æ ‘\n\næµè§ˆå™¨è‡ªä¸Šè€Œä¸‹çš„è§£æ HTML æ–‡æ¡£ï¼Œå¹¶åœ¨è§£æçš„åŒæ—¶æ„å»º DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰ æ ‘ï¼ŒDOM æ ‘é‡Œæœ‰å„ä¸ªæ ‡ç­¾çš„å±æ€§å’Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»\n\n```\n<!DOCTYPE html>\n<html>\n<head>\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    <link href=\"style.css\" rel=\"stylesheet\">\n    <title>Critical Path</title>\n</head>\n<body>\n    <p>Hello <span>web performance</span> students!</p>\n    <div><img src=\"awesome-photo.jpg\"></div>\n</body>\n</html>\n```\nè§£é‡Šå™¨æ·±åº¦éå† HTML æ–‡æ¡£ï¼ŒæŠŠ  `<html>` `<head>` `<body>` è¿™äº›æ ‡ç­¾æŒ‰ç…§ W3C æ ‡å‡†ï¼Œè½¬æ¢æˆ â€œå®šä¹‰å®ƒå±æ€§å’Œè§„åˆ™çš„å¯¹è±¡â€™â€ï¼Œç„¶åå°†è¿™äº› â€œå¯¹è±¡â€ é“¾æ¥åœ¨æ ‘å½¢ç»“æ„é‡Œï¼Œè¿™å°±æ˜¯ DOM æ ‘\n\n![dom-tree](https://pic.zhih.me/blog/posts/how-the-web-works/dom-tree.png)\n\nåœ¨ä»¥ä¸Š HTML ç»“æ„ä¾‹å­ä¸­ï¼Œ`<p>` å’Œ `<div>` æ˜¯å…„å¼ŸèŠ‚ç‚¹ï¼Œåœ¨ DOM æ ‘çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå½“å‰èŠ‚ç‚¹æ‰€æœ‰çš„å­èŠ‚ç‚¹å…¨éƒ½æ„å»ºå®Œæˆåæ‰ä¼šæ„å»ºä¸‹ä¸€å…„å¼ŸèŠ‚ç‚¹\n\n### æ„å»º CSSOM æ ‘\n\nåœ¨ä¸Šé¢çš„ HTML ä¸­ï¼Œ`<head>` é‡Œæœ‰ä¸ªå¤–éƒ¨æ ·å¼è¡¨ `style.css`ï¼ŒHTML è§£æåˆ°è¿™é‡Œæ—¶ä¼šå‘æœåŠ¡å™¨è¯·æ±‚èµ„æºï¼Œå¾—åˆ°è¿™æ ·çš„èµ„æºï¼š\n\n```\nbody {\n    font-size: 16px\n}\n\np {\n    font-weight: bold \n}\n\nspan {\n    color: red \n}\n\np span {\n    display: none \n}\n\nimg {\n    float: right \n}\n```\nå’Œå¤„ç† HTML ç±»ä¼¼ï¼Œæµè§ˆå™¨å¤„ç† CSS æ„å»ºäº† CSSOM\n\n![cssom-tree](https://pic.zhih.me/blog/posts/how-the-web-works/cssom-tree.png)\n\n### æ„å»ºæ¸²æŸ“æ ‘\n\nå‰é¢å·²ç»æ„å»ºäº† DOM æ ‘å’Œ CSSOM æ ‘ï¼Œç°åœ¨æµè§ˆå™¨å°±æŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ªæ¸²æŸ“æ ‘\n\n![render-tree-construction](https://pic.zhih.me/blog/posts/how-the-web-works/render-tree-construction.png)\n\nåœ¨æ¸²æŸ“æ ‘çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨éå† DOM æ ‘ï¼Œç„¶åå¯¹åº” CSSOM æ ‘ç»™æ¯ä¸ªèŠ‚ç‚¹è®¾ç½®è®¡ç®—æ ·å¼ï¼ˆæœ€ç»ˆæ ·å¼ï¼‰ï¼Œè®¾ç½®äº† `display: none` çš„èŠ‚ç‚¹ï¼Œå°†ä¼šåœ¨æ¸²æŸ“æ ‘ä¸­ç§»é™¤\n\nè¿™æ ·ï¼Œæ¸²æŸ“æ ‘å°±åŒ…å«äº†é¡µé¢ä¸Šæ‰€æœ‰å¯è§çš„å†…å®¹å’Œå®ƒä»¬çš„è®¡ç®—æ ·å¼\n\n### å¸ƒå±€ã€ç»˜åˆ¶\n\næ¸²æŸ“æ ‘åªåŒ…å«äº†å†…å®¹å’Œæ ·å¼ï¼Œè¦æ”¾åˆ°æµè§ˆå™¨çª—å£ä¸­ï¼Œè¿˜éœ€è¦è®¡ç®—å®ƒä»¬åœ¨çª—å£é‡Œçš„ç¡®åˆ‡çš„ä½ç½®å’Œå¤§å°ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšå¸ƒå±€ï¼Œä¹Ÿç§°ä¸ºâ€œè‡ªåŠ¨é‡æ’â€\n\næµè§ˆå™¨ä»æ¸²æŸ“æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸ºæœ‰å¤–å‘é‡Œçš„è¿‡ç¨‹ï¼Œå…ˆç¡®å®šå¤–å±‚çš„ä½ç½®å¤§å°ï¼Œåœ¨å‘é‡Œå±‚è®¡ç®—\n\n>å¸ƒå±€æµç¨‹çš„è¾“å‡ºæ˜¯ä¸€ä¸ªâ€œç›’æ¨¡å‹â€ï¼Œå®ƒä¼šç²¾ç¡®åœ°æ•è·æ¯ä¸ªå…ƒç´ åœ¨è§†å£å†…çš„ç¡®åˆ‡ä½ç½®å’Œå°ºå¯¸ï¼šæ‰€æœ‰ç›¸å¯¹æµ‹é‡å€¼éƒ½è½¬æ¢ä¸ºå±å¹•ä¸Šçš„ç»å¯¹åƒç´ \n\nå¸ƒå±€å®Œæˆåï¼Œæµè§ˆå™¨ä¼šç«‹å³å‘å‡ºâ€œPaint Setupâ€å’Œâ€œPaintâ€äº‹ä»¶ï¼Œå°†æ¸²æŸ“æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è½¬æ¢æˆå±å¹•ä¸Šçš„å®é™…åƒç´ ï¼Œè¿™ä¸€æ­¥é€šå¸¸ç§°ä¸ºâ€œç»˜åˆ¶â€æˆ–â€œæ …æ ¼åŒ–â€\n\n### é‡æ’å’Œé‡ç»˜ \n\nå½“ DOM æˆ– CSSOM è¢«ä¿®æ”¹æ—¶ï¼Œä¼šå‘ç”Ÿé‡æ’ï¼ˆReflowï¼‰ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸Šé¢çš„æ­¥éª¤é‡æ–°æ¥ä¸€éï¼Œè¿™æ ·æ‰èƒ½ç¡®å®šå“ªäº›åƒç´ éœ€è¦åœ¨å±å¹•ä¸Šè¿›è¡Œé‡æ–°æ¸²æŸ“ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¢«å«åšå›æµ\n\nå¦‚æœæ”¹å˜çš„å±æ€§ä¸å…ƒç´ çš„ä½ç½®å¤§å°æ— å…³ï¼Œæ¯”å¦‚èƒŒæ™¯é¢œè‰²ï¼Œé‚£ä¹ˆæµè§ˆå™¨åªä¼šé‡æ–°ç»˜åˆ¶é‚£ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªè¿‡ç¨‹å«é‡ç»˜ï¼ˆRepaintï¼‰\n\n>é‡æ’å¿…ç„¶ä¼šå¼•èµ·é‡ç»˜ï¼Œé‡ç»˜åˆ™ä¸ä¸€å®šä¼šé‡æ’\n\n### CSSã€JS é˜»å¡\n\né»˜è®¤æƒ…å†µä¸‹ï¼ŒCSS æ˜¯é˜»å¡æ¸²æŸ“çš„èµ„æºï¼Œæµè§ˆå™¨éœ€è¦ç­‰ DOM å’Œ CSSDOM éƒ½å‡†å¤‡å¥½ä¹‹åæ‰ä¼šæ¸²æŸ“ï¼Œæ³¨æ„ï¼Œè¿™é‡Œè¯´çš„æ˜¯é˜»å¡æ¸²æŸ“ï¼Œè€Œä¸æ˜¯é˜»å¡ DOM çš„æ„å»ºï¼Œäº‹å®ä¸Š DOM å’Œ CSSDOM çš„æ„å»ºæ˜¯å¯ä»¥åŒæ—¶è¿›è¡Œçš„\n\næ„å»º CSSOM ä¼šé˜»å¡å®ƒåé¢ JavaScript è¯­å¥çš„æ‰§è¡Œï¼Œè€Œ JavaScript è¯­å¥çš„æ‰§è¡Œåˆä¼šé˜»æ­¢ CSSOM çš„æ„å»ºï¼ŒåŸå› å¾ˆç®€å•ï¼Œå› ä¸º JavaScript æ‰§è¡Œæ—¶å¯èƒ½ä¼šæ”¹å˜ CSSOMï¼ŒåŒæ—¶è¿›è¡Œä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ \n\né™¤éå°† JavaScript æ˜¾å¼å£°æ˜ä¸ºå¼‚æ­¥ï¼Œå¦åˆ™å®ƒä¼šé˜»æ­¢æ„å»º DOMï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨é‡åˆ° `<script>` æ ‡ç­¾æ—¶ä¼šç›´æ¥æ‰§è¡Œ\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å°½é‡æŠŠ CSS æ”¾åœ¨ç½‘é¡µå¤´éƒ¨ï¼Œé¿å…å¤ªæ™šæ‰æ„å»º CSSOMï¼Œå½±å“æ¸²æŸ“ï¼›å°½é‡æŠŠ JavaScript æ”¾åœ¨ç½‘é¡µåº•éƒ¨ï¼Œå¹¶ä¸”è®¾ç½® asyncã€defer å±æ€§ï¼Œé¿å…é˜»å¡ DOM çš„æ„å»ºã€‚defer æ˜¯â€œæ¸²æŸ“å®Œå†æ‰§è¡Œâ€ï¼Œasync æ˜¯â€œä¸‹è½½å®Œå°±æ‰§è¡Œâ€ï¼Œdefer å¦‚æœæœ‰å¤šä¸ªè„šæœ¬ï¼Œä¼šæŒ‰ç…§åœ¨é¡µé¢ä¸­å‡ºç°çš„é¡ºåºåŠ è½½ï¼Œå¤šä¸ªasync è„šæœ¬ä¸èƒ½ä¿è¯åŠ è½½é¡ºåºã€‚\n\n## å‚è€ƒ\n\nhttps://developers.google.com/web/fundamentals/performance/critical-rendering-path/\n\nhttps://astaxie.gitbooks.io/build-web-application-with-golang/content/zh/03.1.html\n\nhttps://github.com/alex/what-happens-when\n\n## æ€»ç»“\n\nå…¶å®å°±æ˜¯ä¸ªæµè§ˆå™¨å·¥ä½œè¿‡ç¨‹çš„æ‹†æï¼Œç„¶åæ¶‰åŠåˆ°ç›¸å½“å¤šçš„çŸ¥è¯†ç‚¹ï¼Œå¹¶ä¸”è¿™äº›éƒ½æ˜¯æ WEB çš„å¿…çŸ¥çš„ï¼Œå†™å®Œè¿™ä¹ˆå¤šä¹Ÿç®—æ˜¯æ¶ˆåŒ–äº†ï¼Œä¸‹ä¸€æ­¥å¯èƒ½å†™å†™ WEB æ€§èƒ½ä¼˜åŒ–ç›¸å…³çš„å§ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå€¼å¾—å†™çš„ç‚¹\n\nçŸ¥è¯†å°±æ˜¯åŠ›é‡ -- åŸ¹æ ¹\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["web"],"categories":["WEB"]},{"title":"åšäº†ä¸ªç”µå½±æ’è¡Œåˆ—è¡¨å°ç¨‹åº","url":"/my-weapp-topmov/","content":"\n## å¼•è¨€\n\nå°ç¨‹åºå«ï¼šTOP ç”µå½±çœ‹ä¸å®Œ\n\n![æˆªå›¾](https://pic.zhih.me/blog/posts/my-weapp-topmov/screenshot.jpg)\n\næœ€è¿‘æŠŠè¿™ä¸ªå°ç¨‹åºç»™åŸºæœ¬å®Œæˆäº†ï¼Œè¿™ä¸ªâ€˜å®Œæˆâ€™ï¼Œæ˜¯æŒ‡æœ€åˆæˆ‘è®¾æƒ³çš„åŠŸèƒ½éƒ½å®ç°äº†ã€‚å…¶å®åŠå¹´å‰å°±å¼€å§‹ç€æ‰‹äº†ï¼Œä¸è¿‡æ–­æ–­ç»­ç»­çš„ï¼Œåæ¥è¿˜å›å®¶å­¦è½¦ã€è¿‡å¹´ç­‰ç­‰ï¼Œä¸€ç›´æ²¡æœ‰æŠŠå®ƒå®Œæˆã€‚æœ€è¿‘åˆæŠŠå®ƒæ¡èµ·æ¥ï¼Œä¸»è¦æ˜¯æŠŠåç«¯ç»™å®Œæˆäº†ã€‚\n\næˆ‘çˆ±æ‹¿ä¸¤ä¸ªä¸œè¥¿æ¥åšç»ƒæ‰‹çš„é¡¹ç›®ğŸ¤ªğŸ¤ªï¼Œä¸€æ˜¯å¤©æ°”ï¼ŒäºŒæ˜¯ç”µå½±åˆ—è¡¨ã€‚ä¸»è¦åŸå› è¿˜æ˜¯å› ä¸ºæœ‰å…è´¹çš„ APIï¼Œç„¶åæ˜¯åŠŸèƒ½æ˜ç¡®ã€‚\n\n## è®¾è®¡\n\n### åŠŸèƒ½ï¼š\n\n* æœç´¢\n    - å…ˆåˆæ­¥å»ºç«‹ top250 çš„åˆ—è¡¨ï¼Œç„¶åæœç´¢\n    - æœç´¢å†…å®¹åŒ…æ‹¬ç‰‡åã€ç±»å‹ã€æ—¶é—´ã€ä¸»æ¼”ã€è¯„åˆ†ã€æ’å\n* å·²çœ‹\n    - æ ‡è®°çœ‹è¿‡çš„ç”µå½±ï¼Œçœ‹è¿‡å°±çœ‹è¿‡äº†ï¼Œæ²¡æœ‰æ’¤é”€é€‰é¡¹ğŸ˜\n* æ”¶è—\n    - ç‚¹å‡»æ”¶è—ï¼ŒåŠ å…¥æ”¶è—åˆ—è¡¨\n* è¯„è®º\n    - å‘è¡¨è¯„è®º\n\n### å‰ç«¯\n\n* å°ç¨‹åºæœ¬èº«å°±æ˜¯ MVVM æ¶æ„çš„\n* ä¸åç«¯é…åˆç™»å½•ï¼šwafer2-client-sdk\n* è§†å›¾\n    - è±†ç“£ top250 åˆ—è¡¨\n        + æŒ‰æ’åæ’åˆ—åˆ—è¡¨ï¼Œæ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯\n        + ä¸Šæ‹‰åŠ è½½ 25 æ¡æ•°æ®ï¼Œé˜²æ­¢æ•°æ®è¿‡å¤šé€ æˆåŠ è½½ç¼“æ…¢\n    - æœç´¢\n        + æœç´¢ç»“æœæŒ‰æ’åæ’åˆ—ï¼Œè§†å›¾åŒé¦–é¡µ\n    - ç”µå½±è¯¦æƒ…\n        + æ˜¾ç¤ºç”µå½±è¯¦ç»†ä¿¡æ¯ï¼Œæ€»çœ‹è¿‡æ•°ã€æ”¶è—æ•°ã€è¯„è®ºæ•°\n        + ç”¨æˆ·å¯è¿›è¡Œè¯„è®º\n    - ä¸ªäººä¸­å¿ƒ\n        + å¤´åƒã€å§“åã€ç­‰çº§ã€çœ‹è¿‡æ•°ã€æ”¶è—æ•°ã€è¯„è®º\n        + ç­‰çº§æ•°æ®ç»¼åˆçœ‹è¿‡ç”µå½±æ•°æ®å’Œè¯„è®ºå¾—å‡º\n    - çœ‹è¿‡ã€æ”¶è—åˆ—è¡¨\n        + åŒé¦–é¡µè§†å›¾\n\nå‰ç«¯ç›®å½•ç»“æ„\n\n![å‰ç«¯ç›®å½•ç»“æ„](https://pic.zhih.me/blog/posts/my-weapp-topmov/app.jpg)\n\n### åç«¯\n\n* é‡‡ç”¨ MVC æ¶æ„\n* é‡‡ç”¨ nodejsï¼Œä½¿ç”¨ wafer-node-sdk\n* Web æ¡†æ¶ï¼šKoa2\n* è¯·æ±‚ä½“è§£æï¼škoa-better-body\n* æ•°æ®åº“ï¼ˆç”µå½±æ•°æ®æ¥è‡ªè±†ç“£ï¼‰ï¼š\n    - toplistï¼štop250 éƒ¨åˆ†æ•°æ®\n        + ç”µå½± idã€å½±åã€æ’åã€è¯„åˆ†ã€ç±»å‹ã€æ—¶é—´ã€å¯¼æ¼”ã€ä¸»æ¼”ã€å°é¢\n    - userï¼šç”¨æˆ·ä¿¡æ¯\n        + openidã€sessionã€å·²çœ‹ã€æ”¶è—\n    - movï¼šç”µå½±è¯¦æƒ… \n        + ç”µå½± idã€è¯¦ç»†æè¿°ã€åœ°åŒºã€åŸåã€åˆåã€å·²çœ‹æ•°ã€æ”¶è—æ•°ã€è¯„è®ºæ•°\n    - commentï¼šè¯„è®º\n        + ç”µå½± idã€openidã€è¯„è®ºå†…å®¹ã€è¯„è®ºæ—¶é—´ã€ç‰‡å\n\nåç«¯ç›®å½•ç»“æ„\n\n![åç«¯ç›®å½•ç»“æ„](https://pic.zhih.me/blog/posts/my-weapp-topmov/server.jpg)\n\n### æŠ€æœ¯æ ˆ\n\nHTML\nCSS\nJavaScript\nNode.js\nMySQL\nNginx\n\n## åŠ¨æ‰‹åš\n\n### æœ¬åœ°éƒ¨ç½²\n\næœ¬åœ°æ­ä¸€ä¸ª https æœåŠ¡å™¨ï¼Œå› ä¸ºå°ç¨‹åºåªæ”¯æŒ httpsï¼Œåœ¨å¾®ä¿¡å…¬ä¼—å¹³å°è®¾ç½®åŸŸåç­‰åŸºç¡€è®¾ç½®ã€‚\n\næ³¨æ„ï¼Œè¦æƒ³æ‰«ç è°ƒè¯•ã€é¢„è§ˆï¼Œéœ€è¦åœ¨è·¯ç”±å™¨è®¾ç½® hostsï¼ŒæŠŠåŸŸåæŒ‡å‘ç”µè„‘çš„ IPã€‚\n\n### æ•²ä»£ç \n\nå…¶å®å°±æ˜¯æ­£å¸¸çš„ web ç¼–ç¨‹ï¼Œå°ç¨‹åºå°±æ˜¯ä¸€ä¸ªå’Œ vue å¾ˆåƒçš„æ¡†æ¶ï¼Œæ•°æ®æ˜¯åŒå‘ç»‘å®šçš„ã€‚å› ä¸ºæ¥è§¦è¿‡ vue æ‰€ä»¥ä¸Šæ‰‹å¾ˆç®€å•ã€‚æƒ³æƒ³ä¹‹å‰ä»èŠ‚ç‚¹é©±åŠ¨è·³å‡ºï¼Œåˆæ¬¡æ¥è§¦æ•°æ®é©±åŠ¨ï¼Œè®©æˆ‘æ„Ÿè§‰å¾ˆæ–°å¥‡ä¹Ÿå¾ˆçˆ½ã€‚\n\né¦–å…ˆæ˜¯ï¼Œå¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼Œä¹‹å‰ç¬¬ä¸€æ¬¡ç”¨çš„æ—¶å€™ï¼ŒçœŸä»–å¦ˆéš¾ç”¨ï¼Œç°åœ¨æ›´æ–°è¶Šæ¥è¶Šå¥½äº†ï¼Œä¸è¿‡ç¼–è¾‘å™¨è¿˜æ˜¯åŒæ ·åƒåœ¾ï¼Œæ•²ä»£ç è¿˜å¾—ç”¨ VS code æˆ–å…¶ä»–ç†Ÿæ‚‰çš„ç¼–è¾‘å™¨ï¼Œæˆ‘ç”¨çš„æ˜¯ sublime å› ä¸ºå„ç§æ’ä»¶å•¥çš„æˆ‘éƒ½è£…å¥½äº†ï¼Œå¿«æ·é”®ä»€ä¹ˆçš„éƒ½è°ƒçš„å¾ˆèˆ’æœã€‚å¼€å‘è€…å·¥å…·å°±æ‹¿æ¥åšè°ƒè¯•å§ã€‚\n\né¡ºä¾¿æä¸€ä¸‹ï¼Œå› ä¸ºå¼€å‘è€…å·¥å…·é‡Œç”¨çš„æ˜¯ chrome åšè°ƒè¯•å·¥å…·ï¼Œå¦‚æœåç«¯ä½¿ç”¨çš„æ˜¯ nodejsï¼Œå¯ä»¥ä½¿ç”¨ node --inspectï¼Œé…åˆè°ƒè¯•ã€‚\n\nç„¶åï¼Œè®²çœŸï¼Œå¼€å‘çœŸçš„æ²¡ä»€ä¹ˆå¯è¯´çš„ï¼Œå®˜æ–¹çš„å¼€å‘æ–‡æ¡£å¾ˆè¯¦ç»†ï¼ŒAPI éƒ½å¾ˆä¸°å¯Œï¼Œåšä¸€ä¸ªç”µå½±åˆ—è¡¨æ²¡ä»€ä¹ˆéš¾åº¦ã€‚\n\nåç«¯æ–¹é¢ç®€å•è¯´ä¸€ä¸‹ï¼Œå› ä¸ºè±†ç“£çš„ API æœ‰è¯·æ±‚æ•°é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘å†’æ˜§çš„ä½¿ç”¨äº†è‡ªå·±çš„ VPS åšä¸­è½¬ï¼Œåšæ•°æ®ç¼“å­˜ã€‚\n\nå¦å¤–ï¼Œå®ç°ç™»å½•åŠŸèƒ½å’Œç™»å½•æ€å‚¨å­˜ï¼Œä½¿ç”¨çš„æ˜¯ wafer-node-sdkï¼Œè¿™ä¸ªéœ€è¦ä»”ç»†çœ‹å®˜æ–¹çš„è¯´æ˜ã€‚\n\n## å‘å¸ƒ\n\n1. å¼€å‘è€…å·¥å…·ç‚¹å‡»ä¸Šä¼ \n2. å¾®ä¿¡å…¬ä¼—å¹³å°æäº¤å®¡æ ¸\n3. ç­‰ä¸ªä¸€ä¸¤å¤©å°±èƒ½å®¡æ ¸å®Œæˆ\n\næ³¨æ„ï¼Œæœ‰äº›åŠŸèƒ½åœ¨ä¸ªäººè®¤çœŸçš„å°ç¨‹åºæ˜¯ä¸èƒ½è¢«å®¡æ ¸é€šè¿‡çš„ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œè¾¹çš„è¯„è®ºï¼Œæˆ‘æ˜¯é€šè¿‡å…ˆå…³é—­è¯„è®ºåŠŸèƒ½ï¼Œé€šè¿‡å®¡æ ¸åå†è¿œç¨‹æ‰“å¼€çš„ğŸ˜ï¼Œæœºæ™ºå¦‚æˆ‘ã€‚\n\n## ç»“è¯­\n\næœ¬æ¥è¿˜æ‰“ç®—å†™ç‚¹ä»€ä¹ˆçš„ï¼Œåæ¥å‘ç°ï¼Œæ²¡å•¥å¯å†™ï¼Œç»ˆç©¶æ˜¯è‚šå­é‡Œå¢¨æ°´ä¸å¤Ÿï¼ŒæŠ€æœ¯ç§¯ç´¯è¿˜ä¸è¡Œï¼Œå¾—åŠ æ²¹å•Šã€‚\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n\n\n\n\n","tags":["å°ç¨‹åº","å…¨æ ˆ"],"categories":["WEB"]},{"title":"Nginxé…ç½®HTTPSä»¥åŠä½¿ç”¨HTTP2æœåŠ¡å™¨æ¨é€","url":"/nginx-http2-https/","content":"\n## å¼•è¨€\n\næˆ‘çš„å°åšå®¢åœ¨SSL Labs çš„ [SSL Server Test](https://www.ssllabs.com/ssltest/index.html) ä¸­å¾—åˆ°äº† A+ çš„å¥½æˆç»©\n\n![SSL Server Test](https://pic.zhih.me/blog/posts/nginx-http2-https/cover.jpg)\n\nè™½ç„¶æ²¡æ­å»ºè¿‡ä»€ä¹ˆå¤§ç«™ï¼Œä½†æ˜¯è¿™å‡ å¹´ä¹Ÿç§¯ç´¯äº†ä¸å°‘ç»éªŒï¼Œä»Šå¤©å°±è¯´è¯´åœ¨ Nginx ä¸Šé…ç½® HTTPSã€HTTP/2ï¼Œå¹¶å¼€å¯æœåŠ¡å™¨æ¨é€ã€‚\n\nå¾ˆå¤šäººè¯´åšäº§å“è¦è¿½æ±‚ç”¨æˆ·ä½“éªŒï¼Œä½œä¸ºä¸€ä¸ªç”¨æˆ·ï¼Œæˆ‘è®¤ä¸ºä¸€ä¸ªç½‘ç«™æœ€é‡è¦çš„å°±æ˜¯æ‰“å¼€çš„é€Ÿåº¦ã€‚æ‰€ä»¥åœ¨è‡ªå·±æ­ç½‘ç«™çš„æ—¶å€™ï¼Œä¸€ç›´ç—´å¿ƒäºæé«˜ç½‘ç«™çš„é€Ÿåº¦ã€‚\n\nä»¥æˆ‘è¿™ä¸ªåšå®¢ä¸ºä¾‹ï¼Œè‡ªå·±ç§»æ¤å¹¶æ”¹å†™äº†ä¸»é¢˜ï¼Œèµ„æºéƒ½è¿›è¡Œäº†å‹ç¼©ï¼Œå…¬å…±é™æ€èµ„æºéƒ½ç”¨äº†å…¬å…± CDNï¼Œå› ä¸º VPS çš„å¸¦å®½åªæœ‰å¯æ€œçš„ 1Mï¼Œæ‰€ä»¥å›¾ç‰‡èµ„æºéƒ½è¿›è¡Œäº†å‹ç¼©å¹¶å­˜åˆ°äº†è…¾è®¯äº‘ COSï¼Œä½¿ç”¨ CDN è¿›è¡ŒåŠ é€Ÿã€‚è¿™æ ·çš„ä¸€å †åŠ æˆä¹‹åï¼Œå³ä½¿ VPS æ¯ç§’åªèƒ½è·‘ 128kb çš„èµ„æºï¼Œä¹Ÿèƒ½å¿«é€Ÿçš„æ‰“å¼€ç½‘ç«™ã€‚\n\n## ä¼˜åŒ–ä»€ä¹ˆ\n\nweb æ€§èƒ½ä¼˜åŒ–çš„é—¨è·¯å¾ˆå¤šï¼Œæœ‰ç©ºæˆ‘å†å¦å¼€ä¸€ç¯‡æˆ‘å¯¹ä¼˜åŒ–çš„è§è§£è¯´è¯´ï¼Œä½†æ˜¯ä¸€èˆ¬å¯¹äºæˆ‘åšå®¢è¿™ç§é™æ€ç«™æ¥è¯´ï¼ŒçœŸæ­£å½±å“é€Ÿåº¦çš„æ˜¯ï¼Œå¸¦å®½ã€å»¶è¿Ÿã€è¯·æ±‚æ•°ã€èµ„æºå¤§å°ã€‚å¸¦å®½å¤§ã€å»¶è¿Ÿä½çš„ vps è´µï¼Œä¸ºå‡å°‘æœåŠ¡å™¨ç›¸å…³çš„å¼€é”€ï¼Œåªèƒ½é å‹ç¼©èµ„æºå’Œå‡å°‘è¯·æ±‚äº†ã€‚\n\nç½‘é€Ÿæ…¢çš„æ—¶å€™ä¸‹è½½å¤§æ–‡ä»¶ç‰¹åˆ«æ“è›‹ï¼Œè¿™å¤§å®¶éƒ½çŸ¥é“ï¼Œé‚£æ‰“å¼€ç½‘é¡µäº¦æ˜¯å¦‚æ­¤ï¼Œä½†é€Ÿåº¦ä¸ä»…å–å†³äºå®¢æˆ·ç«¯çš„ç½‘é€Ÿï¼Œè¿˜æœ‰æœåŠ¡ç«¯çš„ã€‚æ—¢ç„¶æä¸æ¥ç½‘é€Ÿå¿«çš„æœåŠ¡å™¨ï¼Œé‚£åªèƒ½æŠŠæ–‡ä»¶å‡å°å’¯ï¼ŒæŠŠä»€ä¹ˆ JSã€CSSã€å›¾ç‰‡éƒ½ç»™å‹ç¼©å’¯ï¼Œè¿™ä¸‹æ€»å¯ä»¥äº†å§ã€‚\n\n**ä½†æ˜¯ï¼Œå‹ç¼©å°±è¶³å¤Ÿäº†å—ï¼Ÿ**\n\nä¸å¤Ÿï¼Œå› ä¸ºæµè§ˆå™¨æœ‰ä¸ªå¹¶å‘è¿æ¥æ•°é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæµè§ˆå™¨å¯¹æ¯ä¸ªåŸŸåçš„å¹¶å‘è¯·æ±‚æ˜¯æœ‰é™çš„ï¼ŒåŒä¸€æ—¶é—´åªèƒ½åšå‡ ä¸ªè¯·æ±‚ï¼Œç„¶åå†ç­‰ä¸‹ä¸€è½®è¯·æ±‚ã€‚å…·ä½“åˆ°å®é™…ä½“éªŒå°±æ˜¯ï¼Œå½“ä½ çš„ä¸€ä¸ªç½‘é¡µå†…éœ€è¦åŠ è½½çš„èµ„æºæ•°é‡è¾ƒå¤šçš„æ—¶å€™ï¼Œæµè§ˆå™¨åˆ†å‡ æ¬¡æ‰èƒ½æŠŠèµ„æºä¸‹è½½ä¸‹æ¥ï¼Œè¿™å°±å½±å“åˆ°ç½‘é¡µåŠ è½½é€Ÿåº¦äº†ã€‚\n\n**æ‰€ä»¥ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ**\n\nå‡å°‘è¯·æ±‚æ•°å‘—ï¼Œå¾ˆå¤šæ—¶å€™éƒ½è¿™æ ·è¯´ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œå‡å°‘è¯·æ±‚æ•°æ„å‘³ç€å¯¹å„ç§èµ„æºæœ€å†…è”å¤„ç†ï¼Œè€Œç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œå†…è” CSS/JS ä¸å¥½ç»´æŠ¤ã€å†…è”å›¾ç‰‡ä¸ä¼šæœ‰æµè§ˆå™¨ç¼“å­˜ã€å¢å¤§å•ä¸ªç½‘é¡µçš„ä½“ç§¯ï¼Œå½“ç„¶è¿™äº›ä¹Ÿä¸æ˜¯ç»å¯¹ï¼Œè‡³å°‘ä»¥æˆ‘è¿™ä¸ªé™æ€åšå®¢æ¥è¯´ï¼Œéƒ½æ˜¯å¼Šç«¯ã€‚\n\n**è‰¹ï¼Œä¸€ä¸å°å¿ƒéƒ½åç¦»é‡ç‚¹äº†**\n\nå¥½å§ï¼Œå¼€å§‹è¯´è¯´ä¸»é¢˜å§ã€‚\n\n## HTTP2.0\n\nå…³äºæ˜¯ä»€ä¹ˆï¼Œå¹²ä»€ä¹ˆçš„ï¼Œæ€ä¹ˆæ¥çš„ï¼Œè¿™äº›é—®é¢˜ï¼Œè‡ªå·±å»çœ‹[ç»´åŸºç™¾ç§‘](https://zh.wikipedia.org/wiki/HTTP/2)å»ï¼Œè¿˜æœ‰è¿™ä¸€ç¯‡è°·æ­Œé«˜æ€§èƒ½ web å·¥ç¨‹å¸ˆå†™çš„æ–‡ç« ï¼šhttps://hpbn.co/http2\n\næˆ‘è¿™é‡Œå°±ç®€å•è¯´ä¸€ä¸‹\n\nä¸€å¥è¯è¯´å°±æ˜¯ï¼Œ**è§£å†³äº†ä¸Šé¢é—ç•™ä¸‹æ¥é—®é¢˜**\n\nå¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œæå‡ä½“éªŒçš„æ˜¯å®ƒçš„è¿™ 3 ä¸ªç‰¹æ€§\n\n- å¤´å‹ç¼©\n    + å‹ç¼©è¯·æ±‚å¤´å¤§å°ï¼Œå‡å°‘è¯·æ±‚æ—¶é—´\n\n- è¯·æ±‚å’Œå“åº”å¤ç”¨\n    + å¹¶è¡Œäº¤é”™å¤šä¸ªè¯·æ±‚ï¼Œä¸ä¼šé˜»å¡ä»»ä½•è¯·æ±‚\n    + å¹¶è¡Œä¼ è¾“å¤šä¸ªå“åº”ï¼Œè€Œä¸ä¼šå¯¹ä»»ä½•ä¸€ä¸ªè¿›è¡Œé˜»å¡\n    + ä½¿ç”¨å•ä¸ªè¿æ¥å¹¶è¡Œä¼ é€å¤šä¸ªè¯·æ±‚å’Œå“åº”\n    + æ¶ˆé™¤ä¸å¿…è¦çš„å»¶è¿Ÿå¹¶æé«˜å¯ç”¨å¸¦å®½çš„åˆ©ç”¨ç‡\n\n![è¯·æ±‚å’Œå“åº”å¤ç”¨](https://pic.zhih.me/blog/posts/nginx-http2-https/multiplexing.jpg)\n\n- æœåŠ¡å™¨æ¨é€\n    + é™¤äº†å¯¹åŸå§‹è¯·æ±‚çš„å“åº”ä¹‹å¤–ï¼ŒæœåŠ¡å™¨è¿˜å¯ä»¥ å‘å®¢æˆ·ç«¯æ¨é€é¢å¤–çš„èµ„æº\n\n![æœåŠ¡å™¨æ¨é€](https://pic.zhih.me/blog/posts/nginx-http2-https/server-push.jpg)\n\n*ä»¥ä¸Šå›¾ç‰‡æ¥è‡ªhttps://hpbn.co/http2*\n\nå¦‚æœæŠŠæµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šä¿¡æ¯”ä½œä½ å’Œæœ‹å‹èŠå¤©ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œä¼šæ˜¯è¿™æ ·çš„\n\n- HTTP1.1ï¼ˆç›®å‰ä¸»æµåè®®ï¼‰\n    + ä½ å‘ä¸€å¥æ¶ˆæ¯ç»™æœ‹å‹ï¼Œéœ€è¦ç­‰æœ‹å‹å›å¤ä½ äº†æ‰èƒ½å‘ç¬¬äºŒå¥\n    + ä½ ä¸ä¸»åŠ¨é—®å€™æœ‹å‹ï¼Œæœ‹å‹ä¸ä¼šç†ä½ \n\n- HTTP2.0 \n    + ä½ å¯ä»¥ä¸€æ¬¡å‘å¤šæ¡æ¶ˆæ¯äº†ï¼Œæœ‹å‹ä¹Ÿä¼šä¸€æ¬¡æ€§å›å¤ä½ \n    + ä½ çš„æœ‹å‹ä¼šä¸»åŠ¨é—®å€™ä½ \n\næ˜¯ä¸æ˜¯ç¾æ»‹æ»‹\n\n## é…ç½® HTTPS\n\næˆ‘çš„æ–°æ–‡ç« ï¼Œæ›´è¯¦ç»†çš„ HTTPS é…ç½®ï¼Œå¯ä»¥åˆ°è¿™é‡ŒæŸ¥çœ‹\n\nhttps://zhih.me/make-your-website-support-tls1-3/\n\næœ¬æ¥è¿™ç¯‡æ–‡ç« å°±æ˜¯è¦å†™å†™ï¼Œå¦‚ä½•é…ç½® HTTPS çš„ï¼Œæƒ³ä¸åˆ°æ‰¯å‡ºè¿™ä¹ˆå¤š\n\nå…³äºä¸ºä»€ä¹ˆè¦é…ç½® HTTPSï¼Œé—®ä½ è‡ªå·±å§\n\n### ç”³è¯· SSL è¯ä¹¦\n\néšç€ HTTPS çš„æ™®åŠï¼Œå‡ºç°äº†å¾ˆå¤šçš„å…è´¹è¯ä¹¦ï¼Œæ¯”å¦‚ Letâ€™s Encryptï¼Œä½†æˆ‘æ‰“ç®—ä¹‹åå†å†™ä¸€ç¯‡æ–‡ç« è¯¦ç»†å†™å†™ã€‚\n\næˆ–è€…æ›´æ–¹ä¾¿çš„æ˜¯åˆ°é˜¿é‡Œäº‘ã€è…¾è®¯äº‘çš„åå°ç”³è¯·å…è´¹çš„è¯ä¹¦ï¼Œä¹Ÿå¾ˆç®€å•ã€‚\n\n### å®‰è£… Nginx\n\nç‰ˆæœ¬è£…æœ€æ–°çš„å°±å¥½ï¼Œå¦‚æœæœåŠ¡å™¨è‡ªå¸¦çš„æºä¸å¤Ÿæ–°ï¼Œå¯ä»¥ç”¨ Nginx çš„å®˜æ–¹æºï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼åœ¨ä»–ä»¬çš„å®˜ç½‘å·²ç»ç»™å‡ºï¼Œä¸åœ¨è¯¦ç»†è¯´æ˜ã€‚\n\nhttp://nginx.org/en/linux_packages.html\n\n### å®‰è£… OpenSSL\n\nå¼€å¯ HTTPS éœ€è¦ OpenSSL ç‰ˆæœ¬ >= 1.0.1ï¼Œæˆ‘ç”¨çš„ Debian9 è‡ªå¸¦ 1.1.0\n\nä½ å¯ä»¥ä½¿ç”¨ `openssl version` è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹ï¼Œä¸å¤Ÿæ–°çš„è‡ªè¡Œå‡çº§\n\n### Nginx é…ç½®\n\n#### HTTP 301 è·³è½¬ HTTPS\n\nå¤§å¤šæµè§ˆå™¨é»˜è®¤è®¿é—® HTTPï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©å®ƒè·³è½¬åˆ° HTTPS ä¸Š\n\nä»¥æˆ‘çš„åšå®¢ä¸ºä¾‹\n\n```\nserver {\n    listen      80;\n    server_name zhih.me www.zhih.me;\n    return 301 https://zhih.me$request_uri;\n}\n```\n\n### HTTP2 å’Œ HTTPS\n\nç›®å‰æ‰€æœ‰æ”¯æŒ HTTP/2 çš„æµè§ˆå™¨éƒ½æ˜¯åŸºäº TLS 1.2 åè®®ä¹‹ä¸Šæ„å»º HTTP/2 çš„ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ HTTP/2 å¿…é¡»å¼€å¯ HTTPS\n\nä»¥ä¸‹æ˜¯æˆ‘åšå®¢æœåŠ¡å™¨ HTTPS éƒ¨åˆ†çš„å®Œæ•´é…ç½®ï¼Œgzip å‹ç¼©ç­‰å…¶ä»–è®¾ç½®æˆ‘æ”¾åˆ°äº† nginx.conf é‡Œ\n\næˆ‘çš„é…ç½®å¯èƒ½ä¼šæ›´æ–°ï¼Œå¯ä»¥å» [ç¼–è¯‘Nginxæ”¯æŒTLS1.3](https://zhih.me/make-your-website-support-tls1-3/) é‚£ç¯‡å¸–å­é‡Œçœ‹ï¼Œä¸€åˆ‡ä»¥é‚£é‡Œçš„ä¸ºæœ€æ–°\n\n```\nserver {\n    listen 443 ssl http2;\n    server_name zhih.me www.zhih.me;\n\n    if ($host != zhih.me) {\n        return 301 https://zhih.me$request_uri;\n    }\n    root  /ç«™ç‚¹ç›®å½•;\n\n    ssl_certificate       /ssl/zhih.me.crt;\n    ssl_certificate_key   /ssl/zhih.me.key;\n\n    ssl_protocols TLSv1.2;\n    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';\n    ssl_prefer_server_ciphers on;\n\n    ssl_session_cache shared:SSL:50m;\n    ssl_session_timeout 1d;\n    ssl_session_tickets on;\n    \n    ssl_stapling on;\n    ssl_stapling_verify on;\n    \n    resolver 119.29.29.29 8.8.8.8 valid=300s;\n    resolver_timeout 10s;\n\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\";\n\n    location / {\n        index  index.html;\n        http2_push /css/allinone.min.css;\n    }\n}\n```\n\n### è¯¦ç»†è¯´æ˜\n\n#### å¼€å¯ HTTP2\n\n```\nlisten 443 ssl http2;\n```\n\nç›‘å¬ 443 ç«¯å£ï¼ŒHTTPS åè®®èµ°è¿™ä¸ªç«¯å£ï¼ŒHTTP èµ°çš„æ˜¯ 80\n\nåªéœ€è¦åœ¨ SSL åé¢åŠ ä¸Šå°±èƒ½å¼€å¯ HTTP2 \n\n>æ³¨æ„ï¼šæˆ‘è¿™é…ç½®é‡Œè¾¹çš„ 301 è·³è½¬æ˜¯ä» www.zhih.me è·³è½¬åˆ° zhih.meï¼Œå¦‚æœä½ ä¸éœ€è¦ï¼Œå¯ä»¥ä¸åƒè¿™æ ·è®¾ç½®\n\n#### å¼€å¯æœåŠ¡å™¨æ¨é€\n\n```\nlocation / {\n        index  index.html;\n        http2_push /css/allinone.min.css;\n    }\n```\n\næˆ‘è¿™é‡ŒæŠŠ `/css` ç›®å½•ä¸‹çš„ `allinone.min.css` æ–‡ä»¶æ·»åŠ äº†æœåŠ¡å™¨æ¨é€\n\nä¹‹ååœ¨æµè§ˆå™¨å¼€å‘è€…æ§åˆ¶å°é‡Œçš„æ•ˆæœå°±æ˜¯è¿™æ ·çš„\n\n![æœåŠ¡å™¨æ¨é€](https://pic.zhih.me/blog/posts/nginx-http2-https/push.jpg)\n\n#### å…¶ä»–é…ç½®\n\n`ssl_certificate` æ˜¯å…¬é’¥ï¼Œ`ssl_certificate_key` æ˜¯ç§é’¥ï¼Œåé¢å†™æ–‡ä»¶è·¯å¾„\n\n`ssl_protocols` åŠ å¯†åè®®ï¼ŒNginx é»˜è®¤æ˜¯ SSLv3 TLSv1 TLSv1.1 TLSv1.2ï¼Œä½†æ˜¯ SSLv3 ç›®å‰è¿˜å­˜åœ¨æ¼æ´ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œè€Œæˆ‘åšçš„æ¯”è¾ƒæ¿€è¿›ï¼Œåªä¿ç•™äº† TLSv1.2ï¼Œå› ä¸ºæˆ‘ç›¸ä¿¡ï¼Œèƒ½è®¿é—®è¿™ä¸ªåšå®¢çš„äººï¼Œç”¨çš„æµè§ˆå™¨éƒ½ä¸ä¼šå¾ˆä½çº§ã€‚\n\n`ssl_ciphers` åŠ å¯†ç®—æ³•ï¼Œå› ä¸ºä¸åŒæµè§ˆå™¨ä¼˜å…ˆä½¿ç”¨çš„ç®—æ³•ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡ç«¯è®¾ç½®ä¼˜å…ˆçº§å’Œç¦æ­¢ä½¿ç”¨çš„ç®—æ³•ï¼Œå¹¶ç»“åˆ `ssl_prefer_server_ciphers on` æ¥è®©æµè§ˆå™¨ä¼˜å…ˆé€‰æ‹©æˆ‘ä»¬è®¾ç½®å¥½çš„ã€‚\n\n`ssl_session_cache` SSL ä¼šè¯ç¼“å­˜\n\n`ssl_session_timeout` SSL ä¼šè¯ç¼“å­˜è¿‡æœŸæ—¶é—´\n\n`add_header Strict-Transport-Security max-age=15768000` å¼€å¯ HSTSï¼Œåé¢æ˜¯ç¼“å­˜æ—¶é—´\n\n#### é‡å¯ Nginx\n\nä¿å­˜é…ç½®ï¼Œé‡å¯ Nginx ç”Ÿæ•ˆ\n\n```bash\nnginx -s reload\n```\n\n#### æŸ¥çœ‹æ•ˆæœ\n\nHTTPS ç”Ÿæ•ˆç»“æœæŸ¥çœ‹å¾ˆç®€å•ï¼Œç›´æ¥æ‰“å¼€ä½ çš„ç½‘ç«™ï¼Œçœ‹åˆ°æµè§ˆå™¨å‰é¢æœ‰ä¸ªé”å¤´å°±è¡Œäº†\n\næˆ‘ä»¬ä¸»è¦çœ‹ HTTP2 æ˜¯å¦ç”Ÿæ•ˆï¼Œä½¿ç”¨ curl å‘½ä»¤ï¼Œcurl éœ€è¦æ”¯æŒ HTTPS HTTP2\n\n```bash\ncurl --http2 -I https://zhih.me\n```\n\n![æ•ˆæœ](https://pic.zhih.me/blog/posts/nginx-http2-https/end.jpg)\n\næ•™ç¨‹å†™åˆ°è¿™é‡Œå°±å‘Šä¸€æ®µè½äº†ï¼Œä½ å¯èƒ½å°±è¦é—®äº†ï¼ŒHTTP/2 åŠ é€Ÿäº†ä½ çš„åšå®¢äº†å—ï¼Ÿ\n\nä¸€å®šç¨‹åº¦ä¸Šæ˜¯çš„ï¼Œä½†ç”±äºæˆ‘ç”¨äº† CDNï¼Œåœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šè¯·æ±‚çš„èµ„æºå¹¶ä¸ä¼šå¾ˆæ˜æ˜¾ï¼Œåšå®¢ä¸Šåªæœ‰ä¸€ä¸ªè‡ªå®šä¹‰æ ·å¼è¡¨å’ŒåŸºç¡€çš„é™æ€ç½‘é¡µéœ€è¦ä»æˆ‘è‡ªå·±æœåŠ¡å™¨ä¸Šè·å–ï¼Œå…¶ä»–çš„å„ç§ç±»åº“æˆ‘éƒ½ä½¿ç”¨äº† CDNï¼Œæ–‡ç« é‡Œçš„å›¾ç‰‡æ”¾åˆ°äº†è…¾è®¯äº‘ COS æ­é… CDN ä½¿ç”¨\n\næ¯æ¬¡æœ‰äººè®¿é—®æ—¶ï¼Œè¯·æ±‚äº†é™æ€é¡µé¢ï¼ŒHTTP2 çš„æœåŠ¡å™¨æ¨é€ä¼šæŠŠè‡ªå®šä¹‰æ ·å¼è¡¨æ¨é€è¿‡å»ï¼Œå°±å‡å°‘äº†ä¸€æ¬¡è¯·æ±‚ï¼Œç”¨çš„ CDN ä¹Ÿå¯ç”¨äº† HTTP2ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æˆ‘è¿™ 1Mbps å°æ°´ç®¡ä¸Šå®ç° 0.9s æ‰“å¼€ 13 ä¸ªè¯·æ±‚ã€è¿‘ 500kb å¤§å°çš„é¡µé¢\n\n![åšå®¢é€Ÿåº¦æµ‹è¯•](https://pic.zhih.me/blog/posts/nginx-http2-https/blogspeed.jpg)\n\n## å…¶ä»–å·¥å…·\n\nMoz æ¨èçš„ HTTPS é…ç½®ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰ï¼šhttps://mozilla.github.io/server-side-tls/ssl-config-generator/\n\nSSL Server Testï¼šhttps://www.ssllabs.com/ssltest/index.html\n\nä¸æœè·‘ä¸ªåˆ†\n\n## ç»“è¯­\n\næŠ€æœ¯çš„å‡çº§è¿­ä»£æ½œç§»é»˜åŒ–çš„å½±å“ç€å¤§å®¶çš„ç”Ÿæ´»ï¼Œä» 1960 å¹´ Ted Nelson æ„æ€ HTTP åè®®ï¼Œåˆ° 1996 å¹´ HTTP/1.0 è¢«æ­£å¼ä½œä¸ºæ ‡å‡†ï¼Œå†åˆ° 1997 å¹´å…¬å¸ƒå¹¶ä¸€ç›´æ²¿ç”¨è‡³ä»Šçš„ HTTP/1.1ï¼Œå¯ä»¥è¯´å®ƒæ˜¯äººç±»äº’è”ç½‘çš„åŸºçŸ³ï¼Œ2015 å¹´å‘å¸ƒäº† HTTP2ï¼Œå®ƒä¸ºç½‘é¡µæ€§èƒ½è€Œç”Ÿï¼Œä»–ä»¥æ›´å¿«ï¼Œæ›´å¼ºï¼Œæ›´å®‰å…¨çš„ç‰¹æ€§ï¼Œé€æ¸è¢«çš„è¢«å„å¤§å…¬å¸ä½¿ç”¨ï¼Œç›¸ä¿¡å…¨é¢æ™®åŠ HTTPS/HTTP2 ä¸ä¼šæœ‰å¤ªé•¿çš„æ—¶é—´ã€‚\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n\n\n\n\n","tags":["nginx","https","web"],"categories":["æ•™ç¨‹"]},{"title":"ä½¿ç”¨Pyenv ç®¡ç†PYçš„ç‰ˆæœ¬","url":"/pyenv-usage/","content":"\n## å¼•è¨€\n\nå‰å‡ å¤©ä½¿ç”¨ pip å®‰è£…è…¾è®¯äº‘ COS çš„å‘½ä»¤è¡Œå·¥å…· [coscmd](https://github.com/tencentyun/coscmd) çš„æ—¶å€™ï¼ŒmacOS è‡ªå¸¦çš„ Python å’Œ pip è®©æˆ‘è§‰å¾—ä¸çˆ½ã€‚\n\né¡ºä¾¿è£…ä¸€ä¸‹é€¼ï¼Œä¸Šé¢æåˆ°çš„ [coscmd](https://github.com/tencentyun/coscmd) æˆ‘æäº¤äº†å‡ è¡Œä»£ç ï¼Œå¾—åˆ°äº† merge ï¼ŒğŸ˜ğŸ˜**æˆ‘ç‰¹ä¹ˆä¹Ÿæ˜¯ç»™è…¾è®¯æäº¤è¿‡ä»£ç çš„äºº**ğŸ˜ğŸ˜ã€‚\n\né¦–å…ˆæ˜¯ pip ï¼Œæˆ‘ç›´æ¥ç”¨ `easy_install` å®‰è£…çš„ï¼Œåœ¨ä½¿ç”¨å®ƒå®‰è£… coscmd æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨ sudo ï¼Œç„¶åå„ç§ç»„ä»¶å¾ˆéš¾æƒ³æˆ‘é¢„æƒ³çš„é‚£æ ·é¡ºåˆ©è£…ä¸Šï¼Œæ€»æ˜¯éœ€è¦åŠ  sudoï¼Œåº”è¯¥æ˜¯ç›®å½•æƒé™çš„åŸå› ã€‚å½“ç„¶ï¼Œè¿™å¯èƒ½æ˜¯æˆ‘çš„é”…ï¼Œä½†æ˜¯å¯¹äºæˆ‘æ¥è¯´ï¼Œä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ç¯å¢ƒæ˜¯ä¸å¥½çš„ï¼Œå¤©çŸ¥é“å“ªå¤©å‡ºé”™äº†ä¼šå½±å“åˆ°ä»€ä¹ˆï¼Œæˆ‘æ›´å€¾å‘äºåŒ…ç®¡ç†å™¨çš„é‚£ç§å®‰è£…æ–¹å¼ï¼Œå‡ºé—®é¢˜å°±å¸è½½ä»æ¥ã€‚\n\nç„¶åæ˜¯è‡ªå¸¦çš„ Python ï¼Œå½“ç„¶æˆ‘å¹¶ä¸æ˜¯åš PY å¼€å‘çš„ï¼Œä½†æ˜¯æ¥è§¦ä¸€ä¸‹æ€»å¥½ï¼Œæ¯•ç«Ÿä½¿ç”¨è¿‡å¤ªå¤šçš„å·¥å…·éƒ½æ˜¯ç”¨ PY ç¼–çš„ï¼Œåœ¨ä¹‹å‰ä½¿ç”¨çš„æ—¶å€™ä¹Ÿé‡åˆ°ä¸€äº›å…³äºç‰ˆæœ¬çš„é—®é¢˜ï¼Œæˆ‘ä¹‹å‰è¿˜è§‰å¾—è‡ªå¸¦äº† Python å°±ç¾æ»‹æ»‹ã€‚ç„¶åæƒ³ç”¨ homebrew ç›´æ¥è‡ªå·±è£…ç®—äº†ï¼Œä½†æ˜¯æœ‰å‘ç°ï¼Œè¿™æ ·ä¹Ÿä¸çµæ´»å•Šï¼Œæœ‰äº›æ—¶å€™è¦ py2.7ã€æœ‰çš„è¦ py3 ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œpy æœ‰æ²¡æœ‰å’Œ nvm ä¸€æ ·çš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Ÿ\n\n**åºŸè¯ï¼Œå¿…é¡»æœ‰çš„å•Šï¼**\n\nè¿™å°±æ˜¯ [Pyenv](https://github.com/pyenv/pyenv) äº†ã€‚\n\n>pyenv lets you easily switch between multiple versions of Python. It's simple, unobtrusive, and follows the UNIX tradition of single-purpose tools that do one thing well.\n\nä¸Šé¢å¼•ç”¨ä»–ä»¬ github ä¸Šçš„è¯ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šè£…ï¼Œå°±å¯¹äº†ã€‚\n\n## å®‰è£…\n\nè¿˜æ˜¯ä½¿ç”¨ homebrew å®‰è£…ï¼Œå…³äº homebrew ï¼Œå»æˆ‘ [ä¸Šä¸€ç¯‡æ–‡ç« ](https://zhih.me/make-macos-better/) çœ‹çœ‹ã€‚\n\n```bash\nbrew install pyenv\n```\n\nå®‰è£…å¥½ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨æ‰“å¼€ shell çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œ pyenv çš„åˆå§‹åŒ–\n\n```bash\necho 'eval \"$(pyenv init -)\"' >> ~/.zshrc\n```\n\né‡å¯ä½ çš„ shell å°±ç”Ÿæ•ˆäº†\n\n## ä½¿ç”¨\n\næˆ‘è¿™é‡Œåªè¯´è¯´åŸºæœ¬çš„ä½¿ç”¨æ–¹æ³•ï¼Œæ¯•ç«Ÿæˆ‘åªç®—æ˜¯ä¸ªæ¨èäººï¼Œå…·ä½“çš„é«˜çº§ç”¨æ³•ï¼Œæ‰¾ä»–ä»¬çš„ Wiki çœ‹å»\n\n### å®‰è£…å¤šä¸ª Python ç‰ˆæœ¬\n\né¦–å…ˆæ˜¯æ‰¾åˆ°éœ€è¦è£…çš„ Python ç‰ˆæœ¬å·\n\n```bash\npyenv install --list\n```\n\nåˆ—å‡ºä¸€å †å„ç§çš„ç‰ˆæœ¬ Python ï¼Œè¦è£…å“ªä¸ªå°±è®°ä½ç‰ˆæœ¬å·\n\næ¯”å¦‚è¯´æˆ‘è¿™é‡Œè¦è£…ä¸ª 2.7.14 å’Œ 3.6.5\n\n```bash\npyenv install 2.7.14\npyenv install 3.6.5\n```\n\nè¿™æ ·å°±è£…ä¸Šäº†ï¼Œä½ å°±è¦é—®äº†ï¼Œè¿™ä¸å°±å’Œæˆ‘ç”¨ homebrew å®‰è£…ä¸€æ ·å˜›ï¼Œç”šè‡³å®ƒå®‰è£…éƒ½è°ƒç”¨äº† homebrew ï¼Ÿ\n\né‚£ä¸‹é¢å°±æ˜¯ pyenv çœŸæ­£èµ·ä½œç”¨çš„æ—¶å€™äº†\n\n### ç‰ˆæœ¬ç®¡ç†\n\nå®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¸åŒçš„é¡¹ç›®éœ€è¦ä¸åŒçš„ç‰ˆæœ¬ï¼Œpyenv å¯ä»¥ç»™å…¨å±€åˆ‡æ¢ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥åœ¨ç»™ä¸åŒçš„ç›®å½•è®¾ç½®ä¸åŒçš„ç‰ˆæœ¬\n\n#### å…¨å±€\n\n```bash\npyenv global 3.6.5\npyenv rehash\n```\n\nè¿™ä¸‹ï¼Œä½¿ç”¨ `python -V` å°±èƒ½çœ‹åˆ°è‡ªå·±ç‰ˆæœ¬å˜æˆäº† 3.6.5\n\n#### å½“å‰ç›®å½•\n\nè¦ç»™é¡¹ç›®å•ç‹¬è®¾ç½® Python ç‰ˆæœ¬ï¼Œéœ€è¦ cd è¿›å…¥ç›®å½•\n\nä¾‹å¦‚æˆ‘è¦ç»™å½“å‰ç›®å½•è®¾ç½®ä¸º miniconda3-4.3.30\n\n```bash\npyenv local miniconda3-4.3.30\npyenv rehash\n```\n\nè¿™æ ·å°±å¯ä»¥äº†\n\n#### æŸ¥çœ‹ç¯å¢ƒè®¾ç½®\n\n```bash\npyenv versions\n```\n\nè¿™ä¸ªå‘½ä»¤å¯ä»¥çœ‹è‡ªå·±è£…äº†å“ªå‡ ä¸ªç‰ˆæœ¬ï¼Œå¹¶ä¸”å“ªä¸ªç›®å½•ç»™äº†å“ªä¸ªç‰ˆæœ¬ï¼Œå†™çš„æ¸…æ¸…æ¥šæ¥š\n\n## ç»“è¯­\n\näººç”Ÿè‹¦çŸ­ï¼Œæˆ‘é€‰ Python\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["macOS","Python"],"categories":["æ•™ç¨‹"]},{"title":"macOSè¿™æ ·æ›´å¥½ç”¨","url":"/make-macos-better/","content":"\n## å¼•è¨€\n\næˆ‘ä¹‹æ‰€ä»¥é€‰æ‹©ä½¿ç”¨ macOSï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯ç®€æ´é«˜æ•ˆçš„ç±» Unix ç³»ç»Ÿï¼Œå¯¹å„ç§å¼€å‘ç¯å¢ƒå‹å¥½ï¼Œå¹¶ä¸”è¿‘å¹´æ¥éšç€å›½å†… Mac çš„æ™®åŠï¼Œå„ç§åº”ç”¨è½¯ä»¶ä¹Ÿåœ¨ macOS ä¸Šé€‚é…äº†ï¼Œè½¯ä»¶ä¸°å¯Œåº¦æ–¹é¢å®Œå…¨ä¸ç”¨æ‹…å¿ƒï¼Œå¹¶ä¸” macOS ä¸‹çš„è½¯ä»¶æ›´åŠ çš„çº¯å‡€ç®€æ´ï¼Œä¸ä¼šåƒ Windows ä¸‹é‚£æ ·å‡ºç° â€œå…¨å®¶æ¡¶â€ æ•ˆåº”ã€‚\n\nä¿—è¯è¯´å¾—å¥½ï¼šå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨\n\né‚£ä¹ˆï¼Œåˆšè£…ä¸Šä¸€ä¸ªæ–°çš„ç³»ç»Ÿï¼Œåº”è¯¥æ€æ ·å»è®¾ç½®ï¼Œè®©å®ƒæ›´å¥½ç”¨å‘¢ï¼Ÿ\n\n## 0. è½¯ä»¶\n\næˆ‘æ”¶é›†äº†ä¸€äº›å…è´¹çš„ macOS APPï¼Œå¯ä»¥å»çœ‹çœ‹ï¼Œå¦‚æœä½ æœ‰æ¨èçš„ï¼Œä¹Ÿå¯ä»¥å›å¤æˆ‘\n\nhttps://zhih.me/hackintosh/#/freeapp\n\n## 1. ç³»ç»Ÿè®¾ç½®\n\n### dockæ ï¼ˆç¨‹åºåï¼‰\n\nç³»ç»Ÿé»˜è®¤çš„ dock æ æ˜¯åœ¨åº•éƒ¨çš„ï¼Œåœ¨æ‰“å¼€åº”ç”¨æ—¶ä¼šå‡å°‘ä¿¡æ¯æµå¯è§†é¢ç§¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¾ç½®\n\n- æŠŠå®ƒæ”¾åˆ°å±å¹•å·¦è¾¹\n- è°ƒå°å›¾æ ‡\n- è®¾ç½®é¼ æ ‡æ”¾åœ¨å›¾æ ‡ä¸Šæ—¶å˜å¤§\n\nè¿™æ ·å°±å¯ä»¥çœå‡ºæ›´å¤šçš„ç©ºé—´ï¼Œå¹¶ä¸”æŒ‰ç…§ä»å·¦åˆ°å³çš„é˜…è¯»ä¹ æƒ¯ï¼Œæ”¾åœ¨å³è¾¹æ¯”è¾ƒåˆé€‚ã€‚\n\n![ç¨‹åºå](https://pic.zhih.me/blog/posts/make-macos-better/ç¨‹åºå.jpg)\n\n### finderï¼ˆè®¿è¾¾ï¼‰\n\nfinder ä½œä¸ºä¸€ä¸ªæ–‡ä»¶èµ„æºç®¡ç†ä¸­å¿ƒï¼Œä¸€äº›å°è®¾ç½®å¯ä»¥è®©ä½ ç”¨çš„å¾—å¿ƒåº”æ‰‹\n\n- æ–‡ä»¶å¤¹\n    - åœ¨ç”¨æˆ·ç›®å½•é‡Œæ–°å»º `home`ã€`code` ç›®å½•\n- å·¥å…·æ \n    - å»æ‰ `æ’åˆ—`ï¼Œå› ä¸ºå¯ä»¥åœ¨æ–‡ä»¶å¤¹é‡Œå³é”®è®¾ç½®æ’åˆ—\n    - æ·»åŠ  `åˆ é™¤`ã€`æ–°å»ºæ–‡ä»¶å¤¹`\n- æ˜¾ç¤º\n    - æ˜¾ç¤ºè·¯å¾„æ \n    - æ˜¾ç¤ºçŠ¶æ€æ \n- ä¾§è¾¹æ \n    - æ·»åŠ  `home` ç›®å½•\n    - æ·»åŠ  `code` ç›®å½•\n\n![è®¿è¾¾.png](https://pic.zhih.me/blog/posts/make-macos-better/è®¿è¾¾.jpg)\n\n## 2. Xcode\n\nXcode æ˜¯ macOS ä¸‹é‡è¦çš„ IDEï¼Œä½ è¦æ˜¯å¼€å‘è‹¹æœç³»çš„åŸç”Ÿ Appï¼Œéœ€è¦å®ƒï¼Œè€Œæˆ‘ä»¬æ›´å¤šæ˜¯éœ€è¦ä»–çš„å‘½ä»¤è¡Œå·¥å…·\n\né¦–å…ˆï¼Œåœ¨[App Store](https://itunes.apple.com/cn/app/xcode/id497799835?mt=12)å®‰è£…Xcodeã€‚\n\nXcode æä¾›äº†ç¼–è¯‘è½¯ä»¶å¿…å¤‡çš„ `Xcode Command Line Tools`ï¼Œå®ƒåŒ…å«äº† GCC ç¼–è¯‘å™¨ï¼Œåœ¨è£…å®Œ Xcode ä¹‹åæˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€ä¸‹å‘½ä»¤å®‰è£…å®ƒ\n\n```bash\nxcode-select --install\n```\n\nä»–ä¼šæç¤ºå®‰è£…ï¼ŒæŒ‰ç…§è¯´æ˜æ“ä½œå°±å¯ä»¥äº†ã€‚\n\n## 3. Homebrew\n\nç”¨è¿‡ Linux çš„éƒ½çŸ¥é“åŒ…ç®¡ç†å™¨ï¼ŒDebian ç³»ç”¨çš„ dpkgã€çº¢å¸½ç³»ç”¨çš„ rpmï¼Œè€Œ macOS ä¸‹æœ€å—è¿½æ§çš„å°±æ˜¯ [Homebrew](https://brew.sh/) äº†ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬å®‰è£…å’Œæ›´æ–°åº”ç”¨ç¨‹åºæˆ–åº“ï¼Œæ˜¯ä¸ªå¤§æ€å™¨ã€‚\n\n### å®‰è£…\n\nå®‰è£… Homebrew éœ€è¦å‰é¢æåˆ°çš„ `Xcode Command Line Tools`ï¼Œä¹‹å Homebrew æ‰€æ‰§è¡Œçš„ç¼–è¯‘åŒ…çš„ä»»åŠ¡å…¨éƒ½ä¾é å®ƒã€‚\n\nåœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤ä»¥ä¸‹å›è½¦å°±èƒ½è¿›è¡Œå®‰è£…äº†\n\n```bash\n/usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n```\n\nåœ¨å®‰è£…å®Œæˆåæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¯Šæ–­ä¸€ä¸‹æœ‰æ²¡æœ‰ä»€ä¹ˆé”™è¯¯ï¼Œæˆ–è€… Homebrew éœ€è¦ä½ åšä»€ä¹ˆæ ·çš„è®¾ç½®\n\n```bash\nbrew doctor\n```\n\nbrew å°±æ˜¯ Homebrew çš„åŒ…ç®¡ç†å‘½ä»¤äº†ï¼Œç”¨æ³•ç±»ä¼¼ debian çš„ apt-get\n\n### æ¢æº\n\nHomebrew é»˜è®¤çš„æºæœåŠ¡å™¨åœ¨å›½å¤–ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨å›½å†…ä½¿ç”¨çš„æ—¶å€™é€Ÿåº¦å¯èƒ½æ¯”è¾ƒæ…¢ï¼Œé˜¿é‡Œäº‘æä¾›äº†é•œåƒæºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é˜¿é‡Œå¼€æºé•œåƒç«™æ‰¾åˆ°\n\nhttps://opsx.alibaba.com/mirror\n\næ‰¾åˆ° homebrewï¼Œç‚¹å‡»åé¢çš„**å¸®åŠ©**å¯ä»¥æŸ¥çœ‹å®‰è£…å’Œå¸è½½æ•™ç¨‹\n\n>å¦‚æœä½ åœ¨ä½¿ç”¨ homebrew çš„æ—¶å€™æ— æ³•ä¸‹è½½ç¨‹åºåŒ…ï¼Œå¯ä»¥å°è¯•æ¢æºï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ–è€…æœ‰ä»£ç†çš„ç¯å¢ƒä¸‹ä¸å»ºè®®æ¢æº \n\n### ç”¨æ³•\n\nhomebrew çš„ç”¨æ³•å’Œå…¶å®ƒåŒ…ç®¡ç†å™¨ä¸€æ ·ï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡ï¼Œé‚£ä¹ˆè¿™æ­¥ä½ å¯ä»¥ä¸çœ‹\n\n```bash\n# å®‰è£…è½¯ä»¶åŒ…\nbrew insatll åŒ…å\n\n# æœç´¢\nbrew search åŒ…å\n\n# å¸è½½\nbrew uninstall åŒ…å\n\n# æŸ¥çœ‹å·²å®‰è£…åˆ—è¡¨\nbrew list\n\n# è·å–æ–°åˆ—è¡¨\nbrew update\n\n# å‡çº§è½¯ä»¶åŒ…\nbrew upgrade\n```\n\n## 4. å¿«é€ŸæŸ¥çœ‹\n\nQuickLook æ˜¯ macOS ä¸­ç›¸å½“é«˜æ•ˆçš„åŠŸèƒ½ï¼ŒæŒ‰ä¸€ä¸‹ç©ºæ ¼é”®å°±å¯ä»¥é¢„è§ˆæ–‡ä»¶ï¼Œä¸æ¯”æ‰“å¼€æ–‡ä»¶æµè§ˆï¼Œå¾ˆæ–¹ä¾¿å¿«æ·ï¼Œå®ƒè‡ªå¸¦çš„åŠŸèƒ½å¯èƒ½æ²¡æœ‰å¾ˆå…¨ï¼Œæœ‰äº›æ–‡ä»¶æ— æ³•é¢„è§ˆï¼Œé‚£ä¹ˆå°±éœ€è¦ç»™å®ƒè£…ä¸Šæ’ä»¶ã€‚\n\nè¿™é‡Œæ˜¯ä¸€äº›å¸¸ç”¨çš„æ’ä»¶ï¼š https://github.com/sindresorhus/quick-look-plugins#manually\n\nå¯ä»¥ç›´æ¥ä½¿ç”¨ homebrew è¿›è¡Œå®‰è£…\n\n```bash\nbrew cask install qlcolorcode qlstephen qlmarkdown quicklook-json qlimagesize webpquicklook suspicious-package quicklookase qlvideo\n```\n\n## 5. ç»ˆç«¯\n\nç»ˆç«¯ç»å¯¹æ˜¯ macOS ç§’æ€ Windows çš„ç¬¬ä¸€å¤§æ€å™¨äº†ï¼Œå½“ç„¶ï¼Œæœ‰å¾ˆå¤šäººä¼šæ¨èä½¿ç”¨ iTerm2 ä¹‹ç±»çš„ç¬¬ä¸‰æ–¹ç»ˆç«¯ï¼Œå°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œç³»ç»Ÿè‡ªå¸¦çš„å°±è¶³å¤Ÿï¼Œä¸ç”¨å†å»è£…é‚£äº›åŠŸèƒ½ä¸°å¯Œçš„ç»ˆç«¯ï¼Œé€‚åˆè‡ªå·±çš„æ‰æ˜¯ç¬¬ä¸€ç”Ÿäº§åŠ›ï¼Œå­¦ä¹ æ€ä¹ˆå»ç”¨çš„æ—¶é—´ï¼Œå¯ä»¥å†™ä¸€ä¸ª [onmp](https://zhih.me/onmp-installation/) äº†ã€‚\n\n### å­—ä½“\n\nç»ˆç«¯çš„åå¥½è®¾ç½®ä½ éšä¾¿è®¾ç½®ï¼Œæ€ä¹ˆé€‚åˆæ€ä¹ˆæ¥ï¼Œæˆ‘åœ¨è¿™é‡Œåªæ¨èä¸€ä¸ªå¿…é¡»è®¾ç½®çš„é¡¹ï¼Œ[FiraCodeå­—ä½“](https://github.com/tonsky/FiraCode)ï¼Œä½ å¯ä»¥å»ä»–ä»¬çš„ github é¡µçœ‹çœ‹ï¼Œç›¸ä¿¡ä½ ä¸€å®šä¼šçˆ±ä¸Šå®ƒã€‚\n\n### Zsh\n\nå®ƒæ˜¯ä¸ªä»¤äººæ„Ÿåˆ°æƒŠè‰³çš„ shellï¼Œå…³äºå®ƒï¼Œè‡ªè¡Œæœç´¢çœ‹çœ‹å§ã€‚\n\nä½¿ç”¨ homebrew å®‰è£…\n\n```bash\nbrew install zsh\n```\n\nä¸å‡ºæ„å¤–ï¼Œç°åœ¨å°±å®‰è£…ä¸Šäº†\n\nå‰é¢finderè®¾ç½®é‡Œæ–°å»º `home` ç›®å½•çš„ç›®çš„æ˜¯é˜²æ­¢æ¯æ¬¡è¿›ç»ˆç«¯è¿›è¡Œæ–‡ä»¶ä¸‹è½½ï¼Œæˆ–è€…è¿›è¡Œå…¶ä»–æ“ä½œæ—¶ï¼ŒæŠŠç”¨æˆ·ç›®å½•æå¾—ä¸€å›¢ç³Ÿ\n\næ‰€ä»¥ç°åœ¨è¿˜è¦è®¾ç½®æ‰“å¼€ç»ˆç«¯è‡ªåŠ¨è¿›å…¥ `home` ç›®å½•\n\n```bash\nvi ~/.zshrc\n```\n\nåœ¨æœ€åæ·»åŠ  `cd ~/home`\n\n### Oh My Zsh\n\n[Oh My Zsh](http://ohmyz.sh) æ˜¯ zsh çš„ä¸€ä¸ªæ‰©å±•å·¥å…·é›†ï¼Œæä¾›äº†ä¸°å¯Œçš„æ‰©å±•åŠŸèƒ½ï¼Œæ²¡æœ‰ä»–ï¼Œzsh å°†ä¸å†å®Œæ•´\n\n#### å®‰è£…\n\n```bash\nsh -c \"$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)\"\n```\n\n#### æ’ä»¶\n\nOh My Zsh æœ‰ä¸°å¯Œçš„æ’ä»¶\n\nå†…ç½®çš„å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ° https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins\n\nè¯´å‡ ä¸ªæˆ‘è§‰å¾—æ¯”è¾ƒå¥½ç”¨çš„\n\n1. [osx](https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/osx) å¿«æ·å‘½ä»¤\n\n2. [brew](https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/brew) å¿«æ·å‘½ä»¤\n\n3. [git](https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/git)  å¿«æ·å‘½ä»¤\n\n4. [colored-man-pages](https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/colored-man-pages) man é¡µé¢ä¸Šè‰²\n\n5. [colorize](https://github.com/robbyrussell/oh-my-zsh/tree/master/plugins/colorize) ç»™è¾“å‡ºä»£ç ä¸Šè‰²\n    \n    è¦å…ˆå®‰è£… Pygments\n\n    ```bash\n    pip install pygments\n    ```\n\n    å°±å¯ä»¥ç”¨ `ccat` å‘½ä»¤è¾“å‡ºé«˜äº®ä»£ç \n\n6. [autojump](https://github.com/wting/autojump) ä¸€ç§æ›´å¿«æ·çš„æ–‡ä»¶ç³»ç»Ÿå¯¼èˆªæ–¹å¼\n    \n    ```bash\n    brew install autojump\n    ```\n\n7. [syntax-highlighting](https://github.com/zsh-users/zsh-syntax-highlighting) è¯­æ³•é«˜äº®\n    \n    ```bash\n    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\n    ```\n\n8. [autosuggestions](https://github.com/zsh-users/zsh-autosuggestions) å‘½ä»¤è‡ªåŠ¨æç¤º\n    \n    ```bash\n    git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions\n    ```\n\n9. [history-substring-search](https://github.com/zsh-users/zsh-history-substring-search) å†å²æœç´¢\n\n    è¾“å…¥å†å²è®°å½•ä¸­ä»»ä½•å‘½ä»¤çš„ä»»ä½•éƒ¨åˆ†ï¼Œç„¶åæŒ‰ä¸Šä¸‹é”®ç­›é€‰\n    \n    ```bash\n    git clone https://github.com/zsh-users/zsh-history-substring-search ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-history-substring-search\n    ```\n\nåœ¨ zsh é…ç½®æ–‡ä»¶ä¸­çš„ `plugins` å­—æ®µé‡Œæ·»åŠ æ’ä»¶\n\n```bash\nvi ~/.zshrc\n```\n\nåƒè¿™æ ·\n\n```\nplugins=(osx brew git colorize colored-man-pages autojump zsh-syntax-highlighting zsh-autosuggestions)\n```\n\nä»¥ä¸Šæ’ä»¶æŒ‰éœ€æ·»åŠ ï¼Œä¸æƒ³è¦çš„åˆ æ‰æ‹¬å·é‡Œçš„æ’ä»¶åå­—å°±è¡Œ\n\né‡å¯ç»ˆç«¯ï¼Œå¼€å§‹ç©çˆ½å§\n\n## 6. Git\n\næˆ‘ä¸æ˜¯é’ˆå¯¹è°ï¼Œæˆ‘åªæƒ³è¯´ï¼Œä¸ç”¨ git çš„ç¨‹åºå‘˜éƒ½æ˜¯è¾£é¸¡\n\n### å®‰è£…\n\n```bash\nbrew install git\n```\n\nå®‰è£…æˆåŠŸåå¯ä»¥ä½¿ç”¨ `git --version` çœ‹åˆ°gitç‰ˆæœ¬å·\n\n### è¿æ¥ GitHub\n\n[GitHubå®˜æ–¹è®¾ç½®æ•™ç¨‹](https://help.github.com/articles/set-up-git/)\n\næˆ‘è¿™é‡Œå°±æŠŠå®ƒçš„ç®€åŒ–ä¸€ä¸‹\n\ngithub å¯ä»¥é€šè¿‡ https å’Œ ssh è¿æ¥ï¼Œæˆ‘è¿™é‡Œæ¨èä½¿ç”¨ https è¿æ¥ï¼ŒåŸå› æ˜¯è®¾ç½®ç®€å•ã€ä¸æ˜“è¢«é˜²ç«å¢™æŒ¡\n\n```bash\ngit config --global user.name \"githubç”¨æˆ·å\"\ngit config --global user.email \"githubæ³¨å†Œé‚®ç®±\"\n```\n\nè¿™äº›é…ç½®ä¿¡æ¯ä¼šå­˜åˆ° `~/.gitconfig` é‡Œ\n\nåªæ˜¯è¿™æ ·è®¾ç½®ï¼Œæ¯æ¬¡ä½¿ç”¨éƒ½ä¼šæç¤ºè¾“å…¥å¯†ç ï¼Œæ‰€ä»¥è¦å‘Šè¯‰ Git ä½¿ç”¨ osxkeychain helper å…¨å±€ credential.helper é…ç½®\n\n```bash\ngit config --global credential.helper osxkeychain \n```\n\nä¸‹ä¸€æ¬¡å…‹éš†éœ€è¦å¯†ç çš„ HTTPS URL æ—¶ï¼Œç³»ç»Ÿä¼šæç¤ºæ‚¨è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶æˆäºˆè®¿é—® OSX é’¥åŒ™ä¸²çš„æƒé™ã€‚å®Œæˆæ­¤æ“ä½œåï¼Œç”¨æˆ·åå’Œå¯†ç å°†å­˜å‚¨åœ¨æ‚¨çš„é’¥åŒ™ä¸²ä¸­ï¼Œå¹¶ä¸”ä¸éœ€è¦å†æ¬¡å°†å®ƒä»¬è¾“å…¥åˆ° Git ä¸­ã€‚\n\nè‡³æ­¤ï¼Œå¤§åŠŸå‘Šæˆ\n\n## 7. ç»“è¯­\n\nmacOS ä½œä¸ºä¸€ä¸ªå¯¹å¼€å‘è€…å‹å¥½çš„ç³»ç»Ÿï¼Œè¿˜æœ‰å¾ˆå¯¹æŠ€å·§ç­‰ç€å¤§å®¶å‘æ˜ï¼Œå¹¶ä¸”æ¯ä¸ªäººçš„ä¹ æƒ¯éƒ½æ˜¯ä¸åŒçš„ï¼Œè€Œ macOS ä¹Ÿå®¹çº³äº†å¤§å®¶çš„ä¸åŒï¼Œæä¾›äº†å¤§å®¶ä¸ªæ€§åŒ–è®¾ç½®çš„åŸºç¡€ï¼Œç›¸ä¿¡åœ¨ä½ çš„è°ƒæ•™ä¸‹ï¼Œå®ƒä¼šæˆä¸ºä½ æ‰‹ä¸­çš„å¤§æ€å™¨ã€‚\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n\n\n\n\n\n\n\n\n","tags":["macOS"],"categories":["å¿ƒå¾—"]},{"title":"ä¸€é”®å¼€å¯macOS HiDPI","url":"/one-key-hidpi/","content":"\n## å¼•è¨€\n\nä½œä¸ºä¸€ä¸ªé»‘è‹¹æœç”¨æˆ·ï¼Œè¿½æ±‚é»‘æœçš„ä½“éªŒæ˜¯å½“ç„¶çš„ï¼Œå½“å„ä¸ªç¡¬ä»¶éƒ½é©±åŠ¨å®Œå–„åï¼Œè¦åšçš„å°±æ˜¯ç»†èŠ‚çš„ä¼˜åŒ–äº†ï¼Œæ¯•ç«Ÿè£…ä¸Šæ˜¯æ‹¿æ¥ç”¨çš„ï¼Œå¯ä¸èƒ½å› ä¸ºä½“éªŒå·®è‹¦äº†è‡ªå·±å•ŠğŸ˜‚ã€‚æœºå™¨æ¯•ç«Ÿä¾¿å®œï¼Œä»ç¬¬ä¸€è§†è§‰ä¸Šæœ€é‡è¦çš„å°±æ˜¯å±å¹•äº†ï¼Œå½“ç„¶è‡ªå¸¦çš„å±å¹•ç´ è´¨æ²¡æ³•æ”¹å˜ï¼Œé™¤éæ¢å±äº†ï¼Œç„¶è€Œæ¢å±åˆè¿èƒŒäº†çœé’±çš„åˆè¡·ï¼Œäºæ˜¯åªèƒ½é€šè¿‡ UI ä¸Šçš„æ”¹å˜æ¥æå‡ä½“éªŒäº†ã€‚\n\n## è¯´æ˜\n\né¡¹ç›®åœ°å€ï¼šhttps://github.com/xzhih/one-key-hidpi\n\nï£¿ æ­¤è„šæœ¬çš„ç›®çš„æ˜¯ä¸ºä¸­ä½åˆ†è¾¨ç‡çš„å±å¹•å¼€å¯ HiDPI é€‰é¡¹ï¼Œå¹¶ä¸”å…·æœ‰åŸç”Ÿçš„ HiDPI è®¾ç½®ï¼Œä¸éœ€è¦ RDM è½¯ä»¶å³å¯åœ¨ç³»ç»Ÿæ˜¾ç¤ºå™¨è®¾ç½®ä¸­è®¾ç½®\n\nmacOS çš„ dpi æœºåˆ¶å’Œ win ä¸‹ä¸ä¸€æ ·ï¼Œæ¯”å¦‚ 1080p çš„å±å¹•åœ¨ win ä¸‹æœ‰ 125%ã€150% è¿™æ ·çš„ç¼©æ”¾é€‰é¡¹ï¼Œè€ŒåŒæ ·çš„å±å¹•åœ¨ macOS ä¸‹ï¼Œç¼©æ”¾é€‰é¡¹é‡Œåªæ˜¯å•çº¯çš„è°ƒèŠ‚åˆ†è¾¨ç‡ï¼Œè¿™å°±ä½¿å¾—åœ¨é»˜è®¤åˆ†è¾¨ç‡ä¸‹å­—ä½“å’Œ UI çœ‹èµ·æ¥å¾ˆå°ï¼Œé™ä½åˆ†è¾¨ç‡åˆæ˜¾å¾—æ¨¡ç³Šã€‚\n\nåŒæ—¶ï¼Œæ­¤è„šæœ¬ä¹Ÿå¯ä»¥é€šè¿‡æ³¨å…¥ä¿®è¡¥åçš„ EDID ä¿®å¤é—ªå±ï¼Œæˆ–è€…ç¡çœ å”¤é†’åçš„é—ªå±é—®é¢˜ï¼Œå½“ç„¶è¿™ä¸ªä¿®å¤å› äººè€Œå¼‚\n\nå¼€æœºçš„ç¬¬äºŒé˜¶æ®µ logo æ€»æ˜¯ä¼šç¨å¾®æ”¾å¤§ï¼Œå› ä¸ºåˆ†è¾¨ç‡æ˜¯ä»¿å†’çš„\n\nè®¾ç½®ï¼š\n\n![HiDPIæ•ˆæœ.png](https://pic.zhih.me/blog/posts/one-key-hidpi/hidpi-setting.jpg)\n\n![HiDPIè®¾ç½®](https://pic.zhih.me/blog/posts/one-key-hidpi/hidpi.gif)\n\n## ä½¿ç”¨æ–¹æ³•\n\nåœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤å›è½¦å³å¯\n\n```bash\nbash -c \"$(curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/master/hidpi.sh)\"\n```\n\n![è¿è¡Œ](https://pic.zhih.me/blog/posts/one-key-hidpi/run.jpg)\n\n## æ¢å¤\n\n### å‘½ä»¤æ¢å¤\n\nå¦‚æœè¿˜èƒ½è¿›ç³»ç»Ÿï¼Œå°±å†æ¬¡è¿è¡Œå‘½ä»¤é€‰æ‹©é€‰é¡¹ 3 å…³é—­ HIDPIã€‚\n\n### æ¢å¤æ¨¡å¼\n\nå¦‚æœä½¿ç”¨æ­¤è„šæœ¬åï¼Œå¼€æœºæ— æ³•è¿›å…¥ç³»ç»Ÿï¼Œè¯·åˆ° macos æ¢å¤æ¨¡å¼ä¸­æˆ–ä½¿ç”¨ clover `-x` å®‰å…¨æ¨¡å¼è¿›å…¥ç³»ç»Ÿï¼Œæ‰“å¼€ç»ˆç«¯\n\nè¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼è¿›è¡Œå…³é—­ï¼Œå»ºè®®é€‰ç¬¬ä¸€ç§\n\n1. å¿«æ·æ¢å¤\n    \n```bash\nls /Volumes/\ncd /Volumes/ä½ çš„ç³»ç»Ÿç›˜/System/Library/Displays/Contents/Resources/Overrides/HIDPI\n\n./disable\n```\n\n2. æ‰‹åŠ¨æ¢å¤\n\nä½¿ç”¨ç»ˆç«¯åˆ é™¤ `/System/Library/Displays/Contents/Resources/Overrides` ä¸‹åˆ é™¤æ˜¾ç¤ºå™¨ VendorID å¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œå¹¶æŠŠ `HIDPI/backup` æ–‡ä»¶å¤¹ä¸­çš„å¤‡ä»½å¤åˆ¶å‡ºæ¥ã€‚\n\nè¯·ä½¿ç”¨å•ä¸ªæ˜¾ç¤ºå™¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç¬”è®°æœ¬å…³é—­å¤–æ¥æ˜¾ç¤ºå™¨çš„ HIDPI æ—¶è¯·å…³é—­å†…ç½®æ˜¾ç¤ºå™¨\n\nå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š\n\n```bash\nls /Volumes/\ncd /Volumes/ä½ çš„ç³»ç»Ÿç›˜/System/Library/Displays/Contents/Resources/Overrides\nEDID=($(ioreg -lw0 | grep -i \"IODisplayEDID\" | sed -e \"/[^<]*</s///\" -e \"s/\\>//\"))\nVid=($(echo $EDID | cut -c18-20))\nrm -rf ./DisplayVendorID-$Vid\ncp -r ./HIDPI/backup/* ./\n```\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n","tags":["macOS","shell"],"categories":["æ•™ç¨‹"]},{"title":"é»‘è‹¹æœå®‰è£…æ•™ç¨‹","url":"/hackintosh-install-guide/","content":"\n## å¼•è¨€\n\nåœ¨ç‡ƒ7000 çš„ç¾¤é‡Œå‘ç°è¿˜æœ‰å¾ˆå¤šå°ä¼™ä¼´è¿›ç¾¤ï¼ŒæŒºéœ‡æƒŠçš„ï¼Œæ¯•ç«Ÿè¿™æœ¬å­è¿™ä¹ˆä¹…äº†è¿˜èƒ½ä¿æŒä¸€å®šçš„çƒ­åº¦ï¼Œä½†æ˜¯ç¾¤é‡Œçš„æ•™ç¨‹æ¯”è¾ƒè€æ—§ï¼Œå¾ˆå¤šå†…å®¹å·²ç»ä¸é€‚åˆç°åœ¨çš„æ–°ç³»ç»Ÿï¼Œäºæ˜¯å°±æœ‰äº†è¿™ä¸ªæ•™ç¨‹ã€‚\n\né»‘æœå®‰è£…çš„æ•™ç¨‹å¤§åŒå°å¼‚ï¼Œå°±æ˜¯å„ä¸ªæœºå‹çš„é…ç½®ä¸ä¸€æ ·ï¼Œä»è€Œå¯¼è‡´EFIä¸ä¸€æ ·ï¼Œç†è®ºä¸Šè®²ï¼Œé…ç½®å’Œç‡ƒ7000ç›¸åŒæˆ–ç›¸è¿‘çš„æœºå™¨éƒ½èƒ½æŒ‰ç…§è¿™ä¸ªæ•™ç¨‹å®‰è£…å¥½ã€‚\n\n>å…¶ä»–æœºå‹çš„å°ä¼™ä¼´å¯ä»¥åˆ°æˆ‘çš„é»‘è‹¹æœåˆé›†é‡Œæ‰¾æ‰¾ï¼Œå¯èƒ½ä¼šæœ‰åˆé€‚ä½ çš„ EFI \n>https://zhih.me/hackintosh/\n\n## è§†é¢‘ç‰ˆ\n\nBç«™ï¼šhttps://www.bilibili.com/video/av21503652\n\nYouTubeï¼šhttps://youtu.be/IZCF3E_oQB8\n\n## 1. å‡†å¤‡\n\nè‡³å°‘ 8G å®¹é‡çš„Uç›˜\n\nåˆ†åŒºç²¾çµ http://www.diskgenius.cn\n\né»‘æœå°å…µçš„ [macOS é•œåƒ](https://zhih.me/hackintosh/#/OS-images)\n\né•œåƒå†™å…¥å·¥å…·ï¼š[Etcher](https://www.balena.io/etcher/)\n\n~~transmac é“¾æ¥: https://pan.baidu.com/s/15QmZZLtRU1ZwMi7uCYKC-g å¯†ç : 8dpe~~\n\n## 2. åˆ†é…ç¡¬ç›˜ESPåˆ†åŒº\n\nç¡¬ç›˜åˆ†åŒºè¡¨ç±»å‹å¿…é¡»ä¸º GUIDï¼ŒESP åˆ†åŒºå¿…é¡»å¤§äº 200Mï¼Œæˆ‘å»ºè®®ç»™ä¸ª 220M\n\n![ESPåˆ†åŒº](https://pic.zhih.me/blog/posts/hackintosh-install-guide/ESPåˆ†åŒº.jpg)\n\nåˆ†å‡ºä½ æƒ³è¦è£… macOS çš„åˆ†åŒºï¼Œå¤§å°ä½ è‡ªå·±å®šï¼Œæ ¼å¼éšä¾¿ï¼Œå› ä¸ºå®‰è£…æ—¶è¦æŠ¹ç›˜\n\n## 3. å†™å…¥é•œåƒ\n\nå†™å…¥é•œåƒç°åœ¨å¯ä»¥ä½¿ç”¨æ›´å¥½çš„å·¥å…· [Etcher](https://www.balena.io/etcher/)ï¼Œå½“ç„¶ transmac ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„\n\n### ç¬¬ä¸€ç§æ–¹æ³• Etcher\n\n1. å®‰è£…åæ‰“å¼€ Etcher\n2. é€‰æ‹©é•œåƒ\n3. é€‰æ‹© U ç›˜\n4. ç­‰å¾…å†™å…¥å®Œæˆ\n\n**è¿™æ ·å°±å¯ä»¥äº†**ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•\n\n### ç¬¬äºŒç§æ–¹æ³• transmac \n\n**æ ¼å¼åŒ–**\n\nä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ transmacï¼Œ<kbd>å³é”®</kbd>ç‚¹å‡»ä½ çš„Uç›˜ï¼Œé€‰æ‹© `Format Disk for Mac`ï¼Œå…¨é€‰æ‹©ç¡®è®¤ç„¶åç­‰å®ƒæ ¼å¼åŒ–å®Œï¼Œwin10 å¯èƒ½ä¼šæç¤ºè¦æƒ³ä½¿ç”¨Uç›˜å¿…é¡»å¯¹å…¶æ ¼å¼åŒ–ï¼Œç‚¹å–æ¶ˆã€‚\n\n![æ ¼å¼åŒ–](https://pic.zhih.me/blog/posts/hackintosh-install-guide/æ ¼å¼åŒ–.jpg)\n\n**å†™å…¥**\n\nå†æ¬¡<kbd>å³é”®</kbd>ç‚¹å‡» U ç›˜ï¼Œé€‰æ‹© `Restore with Disk Image`ï¼Œé€‰æ‹©é•œåƒç‚¹å‡» OKï¼Œé™é™ç­‰å¾…å†™å…¥å®Œæˆ\n\n![å†™å…¥é•œåƒ](https://pic.zhih.me/blog/posts/hackintosh-install-guide/å†™å…¥é•œåƒ.jpg)\n\nå†™å…¥å®Œæˆï¼Œwin å¯èƒ½è¿˜ä¼šæç¤ºä¸€äº›æ ¼å¼åŒ–ä¹‹ç±»çš„ï¼Œä¸ç”¨ç†ä¼š\n\n## 4. å…¶ä»–è®¾ç½®\n\n### BIOS è®¾ç½®\n\né‡å¯è¿›å…¥ BIOSï¼Œè®¾ç½®ç¡¬ç›˜ AHCIã€å…³é—­å®‰å…¨å¯åŠ¨ï¼Œä¿å­˜é€€å‡º\n\n![BIOSè®¾ç½®](https://pic.zhih.me/blog/posts/hackintosh-install-guide/BIOSè®¾ç½®1.jpg)\n\n![BIOSè®¾ç½®](https://pic.zhih.me/blog/posts/hackintosh-install-guide/BIOSè®¾ç½®2.jpg)\n\n### Uç›˜å¯åŠ¨\n\nå†æ¬¡é‡å¯ï¼Œè¿›å…¥å¯åŠ¨é¡¹é€‰æ‹©ï¼ˆ dell æ˜¯åœ¨æ˜¾ç¤º logo æ—¶æŒ‰ <kbd>F12</kbd>ï¼‰\n\né€‰æ‹©ä½ çš„Uç›˜\n\n![Uç›˜å¯åŠ¨](https://pic.zhih.me/blog/posts/hackintosh-install-guide/Uç›˜å¯åŠ¨1.jpg)\n\nå¦‚æœä½ çš„æ²¡æ˜¾ç¤ºï¼Œå¯ä»¥åœ¨ BIOS é‡Œæ·»åŠ \n\n![Uç›˜å¯åŠ¨](https://pic.zhih.me/blog/posts/hackintosh-install-guide/Uç›˜å¯åŠ¨2.jpg)\n\n## 5. å®‰è£…\n\nåœ¨ clover è®¾ç½®é‡Œé€‰æ‹© config ä¸º `config_HD615_620_630_640_650.plist`\n\n![cloverå¯åŠ¨è®¾ç½®](https://pic.zhih.me/blog/posts/hackintosh-install-guide/cloverå¯åŠ¨è®¾ç½®.jpg)\n\nè¿”å›é€‰æ‹© macOS å®‰è£…å¼•å¯¼é¡¹\n\n### æŠ¹ç›˜\n\nä»¥ä¸Šä¸å‡ºæ„å¤–ï¼Œå°±èƒ½çœ‹åˆ° macOS çš„æ¢å¤æ¨¡å¼äº†\n\nè¿›å…¥ç£ç›˜å·¥å…·\n\né€‰æ‹©ä½ è¦å®‰è£…åˆ°çš„åˆ†åŒºï¼Œç‚¹å‡»æŠ¹æ‰ï¼Œé€‰æ‹©æ ¼å¼ä¸º `macOSæ‰©å±•ï¼ˆæ—¥å¿—å¼ï¼‰`ï¼ŒæŠ¹æ‰\n\n![æŠ¹ç›˜](https://pic.zhih.me/blog/posts/hackintosh-install-guide/æŠ¹ç›˜.jpg)\n\næŠ¹ç›˜å‡ºç°é”™è¯¯çš„ï¼Œä¸€èˆ¬æ˜¯åˆ†åŒºæ‰€åœ¨ç¡¬ç›˜çš„ ESP åˆ†åŒºä¸è¶³ 200M å¯¼è‡´çš„\n\n### å®‰è£… macOS\n\né€€å‡ºç£ç›˜å·¥å…·ï¼Œé€‰æ‹©å®‰è£… macOS\n\nä¹‹åå°±èƒ½æ­£å¸¸å®‰è£…äº†ï¼Œå…·ä½“çš„æˆ‘å°±ä¸ä¸Šå›¾äº†ï¼Œæƒ³çœ‹è¿‡ç¨‹å°±å»çœ‹è§†é¢‘ç‰ˆçš„å§\n\nå®‰è£…ä¼šæœ‰ 3 ä¸ªé˜¶æ®µ\n\n- ç¬¬ä¸€é˜¶æ®µï¼Œç¨‹åºæŠŠæ–‡ä»¶å†™å…¥ç¡¬ç›˜ï¼Œç„¶åä¼šè‡ªåŠ¨é‡å¯ï¼Œé€‰æ‹©Uç›˜å¼•å¯¼è¿›å…¥ cloverï¼Œå†æ¬¡è®¾ç½® configï¼Œé€€å‡ºé€‰æ‹©æ–°å‡ºç°çš„å¼•å¯¼é¡¹\n\n- ç¬¬äºŒé˜¶æ®µï¼Œç¨‹åºç»§ç»­è¿›è¡Œç³»ç»Ÿå®‰è£…ï¼Œå®Œæˆåä¼šè‡ªåŠ¨é‡å¯ï¼ŒåŒæ ·éœ€è¦é€‰æ‹©Uç›˜å¼•å¯¼å’Œ config è®¾ç½®\n\n- ç¬¬ä¸‰é˜¶æ®µï¼Œç³»ç»Ÿå®‰è£…å®Œæˆï¼Œè¿›è¡Œä¸€äº›è‡ªå®šä¹‰è®¾ç½®ï¼Œè¿›å…¥ç³»ç»Ÿ\n\n## 6. æ›´æ¢EFIï¼Œå®ç°ç¡¬ç›˜å¼•å¯¼å’Œå…¶ä»–é©±åŠ¨\n\nå®‰è£…å¥½ç³»ç»Ÿåï¼Œä¸€äº›ç¡¬ä»¶æ˜¯æ²¡æœ‰é©±åŠ¨çš„ï¼Œè¿™æ˜¯å°±éœ€è¦ç”¨æ›¿æ¢ EFI äº†ï¼Œè€Œä¸”ä¹‹å‰çš„ EFI æ˜¯é•œåƒè‡ªå¸¦çš„ï¼Œå¹¶ä¸”åœ¨Uç›˜é‡Œï¼Œç°åœ¨æˆ‘ä»¬è¦ç”¨ç¡¬ç›˜å¼•å¯¼\n\n### å·¥å…·\n\nä¸‹è½½ [Clover Configurator](https://mackie100projects.altervista.org/download-clover-configurator/)\n\n![Clover Configurator](https://pic.zhih.me/blog/posts/hackintosh-install-guide/ä¸‹è½½CloverConfigurator.jpg)\n\nä¸‹è½½ [å†°æ°´çš„EFI](https://zhih.me/dell-7460-7560-hackintosh)\n\n![å†°æ°´çš„EFI](https://pic.zhih.me/blog/posts/hackintosh-install-guide/å†°æ°´çš„EFI.jpg)\n\n### æ›¿æ¢\n\næ‰“å¼€ Clover Configuratorï¼Œç‚¹å‡» `Mount EFI` ï¼ŒæŒ‚è½½å®‰è£…ç£ç›˜ä¸Š ESP åˆ†åŒº\n\næ‰“å¼€åˆ†åŒºï¼ŒæŠŠä½ çš„æœºå‹æ‰€å¯¹åº”çš„ EFI æ–‡ä»¶å¤¹æ‰”åˆ°åˆ†åŒºé‡Œ\n\n![æ›¿æ¢](https://pic.zhih.me/blog/posts/hackintosh-install-guide/æ›¿æ¢.jpg)\n\nå¯ä»¥æ‹”æ‰Uç›˜é‡å¯äº†\n\n## 7. åç»­\n\nå¯åŠ¨é»˜è®¤è¿› win çš„ï¼Œå¯ä»¥åœ¨ BIOS é‡Œè®¾ç½® clover å¯åŠ¨é¡¹ä¸ºç¬¬ä¸€ä½\n\näº®åº¦æ— æ³•è°ƒèŠ‚çš„ï¼Œå¯ä»¥ä½¿ç”¨ kext utility é‡å»ºç¼“å­˜ï¼Œé‡å¯ç”Ÿæ•ˆ\n\nå­—ä½“å¤ªå°ï¼Ÿå¯ä»¥ä½¿ç”¨æˆ‘çš„ HIDPI è„šæœ¬å¼€å¯ç¼©æ”¾\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["hackintosh","macOS"],"categories":["æ•™ç¨‹"]},{"title":"æˆ‘æ˜¯å¦‚ä½•åœ¨128Må†…å­˜çš„vpsä¸Šå®‰è£…lnmpçš„","url":"/lnmp-on-128m-ram-vps/","content":"\n## å¼•è¨€\n\nå°é¢é‚£å¼ å›¾å’Œè¿™ç¯‡æ–‡ç« æ— å…³ğŸ˜‚ï¼Œé‚£æ˜¯ä¹‹å‰åœ¨å­¦æ ¡çš„æ—¶å€™æ‹çš„ï¼Œä¸€å° 64M å¤è‘£å¤§è„‘å£³è£… win meï¼Œç„¶åç©ä¸‰ç»´å¼¹çƒğŸ¤ª 2333\n\n![ä¸‰ç»´å¼¹çƒ](https://pic.zhih.me/blog/posts/lnmp-on-128m-ram-vps/winme.jpg)\n\nä½œä¸ºä¸€ä¸ªæ•´å¤©æŠ˜è…¾ VPS çš„åšä¸»ï¼Œæ‰‹é‡Œå°‘ä¸äº†å„ç§ä¾¿å®œçš„ä½é…å°é¸¡ï¼Œä»Šå¤©æˆ‘è¦ç¥­å‡ºæˆ‘é‚£ç»å¸¸è¢« BAN ğŸ˜’çš„ 128M å†…å­˜å°é¸¡ï¼Œä¸ºå¤§å®¶å†™ä¸€ç¯‡å°å†…å­˜ VPS å®‰è£… lnmp çš„æ•™ç¨‹ï¼Œå¹¶ä¸”ï¼Œæˆ‘è¦è®©å®ƒæŠŠ WordPress è·‘èµ·æ¥ã€‚\n\nå…ˆä¸Šé…ç½®ï¼š\nCPUï¼šIntel(R) Xeon(R) CPU X5560 @ 2.80GHz å•æ ¸\nå†…å­˜ï¼š128M\nç¡¬ç›˜ï¼š2GB\nç³»ç»Ÿï¼šdebian-8.0-x86_64\nè™šæ‹ŸåŒ–ï¼šopenVZ\n\nå¯ä»¥è¯´è¿™å°é¸¡æ˜¯ç›¸å½“æé™äº†ï¼Œå½“ç„¶æˆ‘è¿˜æœ‰ä¸€å°ä¼ å®¶å® 64M å†…å­˜çš„ï¼Œä½†æ˜¯åœ¨ä¸Šé¢è£… lnmp é‡åˆ°äº†ä¸€äº›éº»çƒ¦ï¼Œå°±æ”¾å¼ƒäº†ğŸ˜‚\n\n## ä¸€ã€è½¯ä»¶æº\n\nç”±äºé…ç½®å¤ªä½ï¼Œlnmp æ‰€éœ€çš„ Nginx MySQL PHP è¦æ˜¯ç”¨ç¼–è¯‘çš„æ–¹å¼å®‰è£…ï¼Œåœ¨è¿‡ç¨‹ä¸­åŸºæœ¬å°±å®•æœºäº†ï¼Œæ‰€ä»¥è¿™é‡Œæ‰ç”¨çš„æ˜¯ apt çš„æ–¹å¼è¿›è¡Œå®‰è£…ã€‚\n\nåœ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œå‰ï¼Œå»ºè®®å…ˆè¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œæ›´æ–°å’Œå®‰è£…ä¸€äº›åŒ…ï¼Œä»¥é˜²å‡ºé”™\n\n```bash\napt-get update && apt-get upgrade\napt-get install curl wget\n```\n\n### 1. æ·»åŠ è½¯ä»¶æº\n\nç³»ç»Ÿæ˜¯ debian8ï¼Œè‡ªå¸¦æºå†…æ²¡æœ‰ PHP7ï¼Œæ‰€ä»¥æ·»åŠ ä¸€ä¸ª [dotdeb](http://www.dotdeb.org) æºï¼Œå®ƒé‡Œé¢æœ‰ debian7ã€debian8 çš„å„ç§è½¯ä»¶åŒ…ï¼ŒåŒæ—¶ä»–ä»¬ä¹Ÿæä¾›ä¸–ç•Œå„åœ°çš„[é•œåƒ](https://www.dotdeb.org/mirrors/)ã€‚\n\n```bash\nvi /etc/apt/sources.list\n# åœ¨ sources.list é‡Œæ·»åŠ ä¸¤è¡Œ (deb å’Œ deb-src)\n```\n\næˆ‘çš„ vps åœ¨ç¾å¸ï¼Œæ‰€ä»¥æ·»åŠ äº†ä»–ä»¬çš„ç¾å›½é•œåƒ\n\n```\ndeb http://mirrors.asnet.am/dotdeb/ jessie all\ndeb-src http://mirrors.asnet.am/dotdeb/ jessie all\n```\n\nå¦‚æœä½ ç›´æ¥ä»å®˜ç½‘å¤åˆ¶è¿‡æ¥ï¼Œæˆ–è€…æ˜¯ä½ çš„ç³»ç»Ÿæ˜¯ debian7ï¼Œè®°å¾—ä¿®æ”¹ç½‘å€åé¢çš„ç‰ˆæœ¬åã€‚\n\n### 2. å®‰è£… GnuPG å¯†åŒ™\n\nGPGä¸»è¦æ˜¯å®ç°å®˜æ–¹å‘å¸ƒçš„åŒ…çš„ç­¾åã€‚\n\n```\nwget https://www.dotdeb.org/dotdeb.gpg\nsudo apt-key add dotdeb.gpg\n```\n\n### 3. æºæ·»åŠ å®Œæ¯•\n\nè¿è¡Œ `apt-get update && apt-get upgrade`ï¼Œç°åœ¨ä½ åº”è¯¥èƒ½ä» dotdeb ä¸Šè·å–è½¯ä»¶äº†ã€‚\n\n## äºŒã€è½¯ä»¶åŒ…\n\n### 1. Nginx\n\n```bash\napt-get install nginx -y\n```\n\næ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ä½ çš„ IPï¼Œèƒ½æ˜¾ç¤º `Welcome to nginx!`ï¼Œå°±è¯´æ˜å®‰è£…æˆåŠŸäº†ã€‚\n\n### 2. PHP7\n\n```bash\napt-get install php7.0 php7.0-cgi php7.0-cli php7.0-fpm php7.0-mysql php7.0-odbc php7.0-opcache -y\n```\n\nä»¥ä¸Šæˆ‘åªå®‰è£…äº†å‡ ä¸ª moduleï¼Œå¦‚æœ‰éœ€è¦ï¼Œè‡ªå·±å®‰è£…å…¶ä»–çš„ã€‚\n\nå®‰è£…æˆåŠŸåï¼Œè¿è¡Œ `php -v` å¯ä»¥çœ‹åˆ° PHP çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚\n\n### 3. MySQL\n\n```bash\napt-get install mysql-client mysql-server -y\n```\n\nè¾“å…¥å‘½ä»¤åï¼Œä¼šè¿›è¡Œå®‰è£…ï¼Œè¿‡ç¨‹ä¸­ä¼šæœ‰è¾“å…¥å¯†ç çš„æç¤ºæ¡†ï¼ŒæŒ‰æç¤ºæ“ä½œå³å¯ã€‚\n\nè¿è¡Œ `mysql -u root -p`ï¼Œè¾“å…¥å¯†ç ï¼Œèƒ½è¿›å…¥ MySQL å°±è¯´æ˜è£…ä¸Šäº†ã€‚\n\n## ä¸‰ã€å®‰è£… WordPress\n\nè‡³æ­¤ lnmp å·²ç»å®‰è£…å®Œæ¯•äº†ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ç›¸å…³çš„ç®¡ç†å‘½ä»¤å†å®‰è£… WordPressã€‚\n\n```bash\n# å¯åŠ¨|åœæ­¢|é‡å¯\n/etc/init.d/nginx start|stop|restart\n/etc/init.d/php7.0-fpm start|stop|restart\n/etc/init.d/mysql start|stop|restart\n```\n\nå¥½äº†ï¼Œå’±ä»¬å¼€å§‹å®‰è£… WordPress \n\nè¿™éƒ¨åˆ†æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œé…ç½®æ•™ç¨‹ä¹‹ç±»çš„å¾ˆå¤šï¼ŒWPå®˜ç½‘çš„å®‰è£…æ–‡æ¡£ä¹Ÿç›¸å½“æ¸…æ™°ã€‚\n\nå…¶å®å°±æ˜¯ä»¥ä¸‹æ­¥éª¤ï¼š\n\n1. åˆ›å»º Nginx é…ç½®æ–‡ä»¶\n2. åœ¨ MySQL é‡Œåˆ›å»ºæ•°æ®åº“\n3. ä¸‹è½½ã€è§£å‹ WordPress ç¨‹åºåŒ…\n4. è¿›å…¥ç½‘é¡µå®‰è£…\n\nè·‘å¾—åŠ¨æ²¡å•¥ï¼Œå°±æ˜¯çœ‹çœ‹è¿™å°é¸¡çš„æ‰¿è½½èƒ½åŠ›ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ ab å‘½ä»¤å¯¹é¦–é¡µè¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œå¹¶ä¸”é¦–é¡µä¹Ÿå°±ä¸€ç¯‡æ–‡ç« åˆ—è¡¨ï¼Œæƒ…å†µå¦‚ä¸‹å›¾ï¼š\n\n![å‹åŠ›æµ‹è¯•](https://pic.zhih.me/blog/posts/lnmp-on-128m-ram-vps/å‹åŠ›æµ‹è¯•.jpg)\n\nåœ¨åš100ä¸ªå¹¶å‘ï¼Œè®¿é—®10000æ¬¡çš„æµ‹è¯•ä¸­ï¼Œåœ¨è¿›è¡Œåˆ°ç¬¬7143ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œå°é¸¡çˆ†äº†ï¼Œå®Œå…¨æ— æ³•è®¿é—®ï¼Œè¿‡äº†ä¸€ä¼šæ‰æ¢å¤è¿‡æ¥ï¼Œçœ‹æ¥å¯¹å®ƒçš„è¦æ±‚ä¸èƒ½å¤ªé«˜å•ŠğŸ˜‚ã€‚\n\nå½“ç„¶ï¼Œä½¿ç”¨WPä¹Ÿè¦ä½¿ç”¨é™æ€åŒ–æ’ä»¶æ‰èƒ½æé«˜æ‰¿è½½èƒ½åŠ›ï¼Œæˆ‘å°±æ‡’å¾—è¯•äº†\n\n## æœ€å\n\nå…¶å®è¿™ç¯‡æ–‡ç« å°±æ˜¯ç»™å°é¸¡è·‘ä¸ª lnmpï¼Œç»™å®ƒç‚¹å‹åŠ›ï¼Œæˆ‘è¿‡è¿‡æ‰‹ç˜¾ï¼Œä¹Ÿè¯å®ä¸€ä¸‹ 128M çš„å°å†…å­˜vpsæ˜¯æœ‰èƒ½åŠ›æ­å»ºè®¿é—®é‡å°‘çš„ WP åšå®¢çš„ã€‚\n\nä½†æ˜¯ï¼Œæ—¢ç„¶å†…å­˜è¿™ä¹ˆå°ï¼Œä½•ä¸ç”¨ hexo é‚£ç§é™æ€åšå®¢å‘¢ã€‚\n\nè¿™ç¯‡æ–‡ç« ä»…ä½œä¸ºæ–°æ‰‹å®‰è£… lnmp æ•™ç¨‹ï¼Œç…§é¡¾é‚£äº›ä½ä»·ä¹°äº†ä½é…ç½® vps çš„åŒå­¦ï¼Œç¥ä½ ä»¬æŠ˜è…¾æ„‰å¿«ã€‚\n\nå¦‚æœä½ æƒ³è´­ä¹° vpsï¼Œå¯ä»¥çœ‹çœ‹ [DigitalOcean](https://m.do.co/c/5ddae9064d7f)\n\nè¿™é‡Œæ˜¯æˆ‘çš„ä¼˜æƒ é“¾æ¥ï¼š[https://m.do.co/c/5ddae9064d7f](https://m.do.co/c/5ddae9064d7f)ï¼Œé€šè¿‡è¿™ä¸ªé“¾æ¥æ³¨å†Œï¼Œä½ å¯ä»¥å¾—åˆ°10ç¾å…ƒç”¨æ¥è´­ä¹°vpsã€‚\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["Linux","lnmp"],"categories":["æ•™ç¨‹"]},{"title":"æˆ´å°”ç‡ƒ7000é»‘è‹¹æœEFI","url":"/dell-7460-7560-hackintosh/","content":"\n## å¼•è¨€\n\nç®€å•è¯´ä¸‹æˆ‘çš„ç”µè„‘é…ç½®ï¼š\n\n| é…ç½® | è¯¦æƒ… |\n| --- | --- |\n| CPU | Intel Core i5-7200U |\n| æ˜¾å¡ | Intel HD Graphics 620 / Nvidia GeForce 940MX |\n| RAM | 4G + 8G DDR4 2400MHz |\n| ç¡¬ç›˜ | SATA3 500g SSD / M.2 SATA3 128g SSD |\n| å£°å¡ | Realtek Audio ALC 3246 (ALC256) |\n| ç½‘å¡ | BCM94360cs2ã€DW1830ã€DW1560 (ä¸‰å¼ å¡æˆ‘éƒ½æœ‰) |\n\nåœ¨ä¹°è¿™å°ç”µè„‘ä¹‹å‰å°±å¬è¯´è¿‡ hackintoshï¼Œä¹Ÿå°±æ˜¯é»‘è‹¹æœã€‚ä½†æ˜¯éƒ½æ²¡æœ‰å°è¯•è¿‡ï¼Œå› ä¸ºä¸€èˆ¬çš„ç¬”è®°æœ¬é»‘èµ·æ¥éº»çƒ¦å¤šå¤šï¼Œå¾ˆéš¾åšåˆ°â€œå¯ç”¨â€çŠ¶æ€ï¼Œè€Œè¿™å°ç”µè„‘ä¸ä»…æœ‰ä¸¤ä¸ªå†…å­˜æ’æ§½ã€ä¸€ä¸ª M.2 æ¥å£ï¼ˆä¸æ”¯æŒ nvmeï¼‰ã€ä¸€ä¸ª SATA3 æ¥å£ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯æ›´æ¢çš„ç½‘å¡ï¼Œå¾ˆé€‚åˆç”¨æ¥é»‘ã€‚\n\nç»è¿‡ä¸€å¹´å¤šçš„æŒç»­æ›´æ–°ï¼Œå·²ç»è¶‹äºå®Œç¾ï¼Œå½“åšä¸»åŠ›ç³»ç»Ÿä¸€ç‚¹é—®é¢˜éƒ½æ²¡æœ‰ã€‚\n\nè¿™æ˜¯æˆ‘åœ¨ç»è¿‡å¤§é‡å°è¯•å’Œæ›´æ–°åå¾—å‡ºçš„é€‚ç”¨äºç‡ƒ7000çš„EFIï¼Œå…¶ä»–æœºå‹ï¼Œé…ç½®ç›¸åŒæˆ–è€…å¤§è‡´ç›¸åŒçš„åŒå­¦å¯ä»¥å°è¯•ä½¿ç”¨ã€‚\n\n>å…¶ä»–æœºå‹çš„å°ä¼™ä¼´å¯ä»¥åˆ°æˆ‘çš„é»‘è‹¹æœåˆé›†é‡Œæ‰¾æ‰¾ï¼Œå¯èƒ½ä¼šæœ‰åˆé€‚ä½ çš„ EFI\n>https://zhih.me/hackintosh/\n\n## è¯´æ˜\n\næ­¤åˆé›†é€‚ç”¨äºæˆ´å°”ç‡ƒ 7000 ç³»åˆ—ç¬¬ä¸€ç¬¬äºŒä»£å‹å·ä¸º 7460/7560/7472/7572 çš„ç¬”è®°æœ¬ç”µè„‘\nEFI å¯ç›´æ¥ç”¨äºå®‰è£…å’Œæ—¥å¸¸ä½¿ç”¨\n\né¡¹ç›®åœ°å€ï¼š[https://github.com/xzhih/dell-7460-7560-hackintosh](https://github.com/xzhih/dell-7460-7560-hackintosh)\n\nSSDT hotpatch æ¥è‡ª[RehabMan](https://github.com/RehabMan/OS-X-Clover-Laptop-Config) \n\næ–‡ä»¶åˆ—è¡¨ï¼š\n\n1. EFI (å¿…é¡»)\n2. [HIDPI å·²è½¬ç§»åˆ°å•ç‹¬çš„ä»“åº“](https://github.com/xzhih/one-key-hidpi) (å¯é€‰)\n3. ç½‘å¡é©±åŠ¨ (å¯é€‰)\n4. é»‘æœå°å…µçš„ ALCPlugFix (è¯¦ç»†è¯´æ˜[æ¥æºä¼ é€é—¨](https://github.com/daliansky/ALCPlugFix/blob/master/README.md))\n\n## ä½¿ç”¨æ–¹æ³•\n\n### 1. EFI\n\nå®‰è£…æ—¶ï¼ˆä¸ä¿è¯èƒ½é¡ºåˆ©å®‰è£…ï¼‰ï¼šä½¿ç”¨ transmac å†™å…¥é•œåƒè‡³ U ç›˜åï¼Œæ‹·è´ EFI åˆ° U ç›˜ ESP åˆ†åŒºä¸­ï¼Œé‡å¯æŒ‰ <kbd>F12</kbd> é€‰æ‹© U ç›˜å¯åŠ¨å³å¯å¼€å§‹å®‰è£…\n\nå…·ä½“å®‰è£…æ•™ç¨‹è¯·çœ‹[æˆ‘çš„æ•™ç¨‹](https://zhih.me/hackintosh-install-guide/)\n\næ—¥å¸¸ä½¿ç”¨ï¼šå®‰è£…å¥½ç³»ç»Ÿåï¼Œä½¿ç”¨ `clover configurator` æŒ‚è½½ macOS æ‰€åœ¨ç¡¬ç›˜çš„ ESP åˆ†åŒºï¼ŒæŠŠ EFI æ‹·è´è¿›å»ï¼Œé‡å¯æŒ‰ <kbd>F2</kbd> è¿›å…¥ BIOS è®¾ç½®æ­¤å¼•å¯¼ä¸ºé¦–é€‰ï¼Œä¿å­˜é‡å¯å³å¯\n\n### 2. å£°å¡ã€è€³æœº\n\nå£°å¡é©±åŠ¨éƒ½å·²ç»æœ‰äº†ï¼Œåªéœ€è¦è¿›å…¥ `é»‘æœå°å…µçš„ALCPlugFix` è¿™ä¸ªæ–‡ä»¶å¤¹ï¼ŒåŒå‡» `install...` è¿è¡Œå³å¯ï¼Œå¯ä»¥è§£å†³å”¤é†’æ— å£°ã€è€³æœºæ— å£°ã€è€³æœºæ‚éŸ³ç­‰é—®é¢˜\n\n### 3. ä¸€é”®å¼€å¯HIDPIå¹¶æ³¨å…¥EDID\n\næ­¤ä¸€é”®å‘½ä»¤å¯å¼€å¯æ¥è¿‘åŸç”Ÿçš„ HIDPI è®¾ç½®ï¼Œä¸éœ€è¦RDMè½¯ä»¶å³å¯åœ¨ç³»ç»Ÿæ˜¾ç¤ºå™¨è®¾ç½®ä¸­è®¾ç½®\n\nä»“åº“åœ°å€ï¼š[ä¸€é”®å¼€å¯ HIDPI](https://github.com/xzhih/one-key-hidpi)\n\næ•ˆæœï¼š\n\n![è®¾ç½®.png](https://pic.zhih.me/blog/posts/one-key-hidpi/hidpi-setting.jpg)\n\n### 4. ç½‘å¡é©±åŠ¨\n\næœºå™¨è‡ªå¸¦çš„æ— çº¿ç½‘å¡æ— æ³•é©±åŠ¨ï¼Œåªèƒ½è´­ä¹°å¯é©±åŠ¨çš„ç½‘å¡æ›´æ¢ï¼Œæ±‚æ–¹ä¾¿çš„æœ‹å‹å¯ä»¥è´­ä¹° `dw1560/dw1830` è¿™ä¸¤æ¬¾ç½‘å¡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç‡ƒç³»åˆ—æœ‰ä¸ªè¶…ç‡ƒç‰ˆä¹Ÿå°±æ˜¯æ²¡æœ‰ç‹¬æ˜¾çš„ç‰ˆæœ¬ï¼Œå®ƒå› ä¸ºä¸»æ¿ç»“æ„ä¸åŒä¸èƒ½å®‰è£… dw1830ï¼Œå¦å¤– dw1830 æ˜¯ 3 å¤©çº¿ç½‘å¡ï¼Œåœ¨è´­ä¹°æ—¶å¯å‘å•†å®¶ç´¢è¦ä¸€æ ¹ `7~15cm` çš„å¤©çº¿ï¼Œå®‰è£…æ—¶å°†ç¬¬ä¸‰æ ¹å¤©çº¿æ”¾ç½®åœ¨ HDD ä¸‹çš„å¼€æ§½å¤„é˜²æ­¢é‡‘å±å±è”½ä¿¡å·\n\næ–‡ä»¶å¤¹å†…æœ‰ä¸¤ä¸ªç½‘å¡çš„é©±åŠ¨ï¼Œè‡ªè¡Œå°†é‡Œé¢çš„é©±åŠ¨æ‹·è´åˆ° `EFI/clover/kext/other` ä¸­\n\nç°åœ¨ `1560/1830` è¿™ä¸¤å¼ å¡åŸºæœ¬åœäº§äº†ï¼Œæ‰€ä»¥ä»·æ ¼å¾ˆé«˜ï¼Œå¾ˆç¦»è°±ï¼Œæ²¡å¿…è¦ä¹°äº†\n\nç™½è‹¹æœæ‹†æœºç½‘å¡ `bcm94360cs2`ï¼Œå…é©±çš„ï¼Œä¸éœ€è¦æ”¾ä»»ä½•é©±åŠ¨ï¼Œéš”ç©ºæŠ•é€’å’Œæ¥åŠ›ï¼ˆhandoffï¼‰éƒ½èƒ½ç›´æ¥ä½¿ç”¨\n\n### 5. è§¦æ‘¸æ¿æ‰‹åŠ¿\n\nè§¦æ‘¸æ¿å·²æ”¯æŒåŸç”Ÿæ‰‹åŠ¿ï¼Œè‡ªè¡Œåœ¨ç³»ç»Ÿåå¥½è®¾ç½®->è§¦æ§æ¿é‡Œæ‰“å¼€\n\n## å…¶ä»–è¯´æ˜\n\nmacOS10.14 ä¸­ä¼šå­˜åœ¨æ¨¡ç³Šè¿‡æ¸¡ä¸è‡ªç„¶çš„é—®é¢˜ï¼Œåªéœ€è¦æŠŠ clover é‡Œçš„ `config-Spoof.plist` é‡å‘½åä¸º `config.plist` å³å¯è§£å†³ï¼ŒåŸæ¥çš„`config.plist` æ¢ä¸ªä½ å–œæ¬¢çš„åå­—\n\næ¯æ¬¡ç³»ç»Ÿå‡çº§æˆ–æ›¿æ¢æ–°çš„EFIåï¼Œéƒ½è¦æ‰“å¼€ `Kext Utility.app` è‡ªåŠ¨é‡å»ºç¼“å­˜ï¼Œæœ€å¥½è¿˜åœ¨ç»ˆç«¯ç”¨ `sudo nvram -c` å‘½ä»¤æ¸…ç©ºä¸€æ¬¡NVRAM\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["hackintosh","macOS"],"categories":["æ•™ç¨‹"]},{"title":"Hexoä¸»é¢˜casperä½¿ç”¨æ•™ç¨‹","url":"/hexo-casper-usage/","content":"\n## ç®€è¿°\n\nè¿™æ˜¯æœ¬äººç§»æ¤è‡ª [Ghost's Casper theme](https://github.com/TryGhost/Casper) çš„ä¸€ä¸ª [Hexo](https://hexo.io) ä¸»é¢˜ã€‚\n\né¡¹ç›®åœ°å€ [https://github.com/xzhih/hexo-theme-casper](https://github.com/xzhih/hexo-theme-casper)\n\nDEMO [https://xzhih.github.io/hexo-theme-casper/](https://xzhih.github.io/hexo-theme-casper/)\n\n## é¡¹ç›®æ¥ç”±\n\næœ€è¿‘æäº†ä¸ªåšå®¢ï¼Œç”¨çš„æ˜¯ [Hexo](https://hexo.io) ï¼Œå‘ç°äº†å¾ˆå¤šä¸é”™çš„ä¸»é¢˜ï¼Œåœ¨å¯»æ‰¾ä¸»é¢˜çš„è¿‡ç¨‹ä¸­å‘ç°äº†å¦ä¸€ä¸ªåšå®¢ç¨‹åº [Ghost](https://ghost.org) ã€‚å®ƒçš„æ–°ç‰ˆé»˜è®¤ä¸»é¢˜å¾ˆå’Œæˆ‘çš„èƒƒå£ï¼Œä½†æ˜¯åœ¨githubä¸Šæœç´¢ä¸€é€šåï¼Œå‘ç°åªæœ‰è€ç‰ˆæœ¬çš„è¢«ç§»æ¤åˆ°äº† hexoï¼Œäºæ˜¯æƒ³è‡ªå·±åŠ¨æ‰‹æŠŠå®ƒç§»æ¤è¿‡æ¥ï¼Œçœ‹äº†å®˜æ–¹æ–‡æ¡£åå‘ç°hexoçš„ä¸»é¢˜è¿˜æ˜¯ç›¸å½“å¥½åˆ¶ä½œçš„ï¼Œç”¨äº†å‡ å¤©å¼„å¥½äº†ã€‚å½“ç„¶ï¼ŒåŠŸèƒ½è¿˜ä¸æ˜¯å¾ˆå®Œå–„ã€‚\n\nç»è¿‡å‡ æ¬¡çš„ä¿®æ”¹æ›´æ–°ï¼Œç°åœ¨å·²ç»æ¯”è¾ƒå®Œå–„äº†ï¼Œå¤§å¤šåŠŸèƒ½éƒ½æ˜¯ä¸»é¢˜é›†æˆçš„ï¼Œä¸éœ€è¦å†å®‰è£…æ’ä»¶\n\nä¸‹é¢æˆ‘å°±è¯´ä¸€ä¸‹ä¸»é¢˜çš„ä½¿ç”¨æ–¹æ³•ã€‚\n\n## ç‰¹æ€§\n\n- æ–‡ç« å°é¢å›¾ï¼ˆåœ¨é¦–é¡µæ–‡ç« æ‘˜è¦ä¸Šæ˜¾ç¤ºï¼‰\n- æ–‡ç« ç‰¹è‰²å›¾ï¼ˆåœ¨æ–‡ç« è¯¦ç»†é¡µé¢ä¸Šç½®é¡¶ï¼‰\n- è‡ªå®šä¹‰èœå• \n- è‡ªå®šä¹‰ favicon, logo, å¤´éƒ¨èƒŒæ™¯, ä½œè€…å¤´åƒ\n- ç¤¾äº¤é“¾æ¥ ( ç°åœ¨æ”¯æŒ githubã€å“”å“©å“”å“©ã€YouTubeã€å¾®åšã€æ¨ç‰¹ã€è„¸ä¹¦ ) \n- å…±ä¸‰ä¸ªæ’ä»¶ï¼ˆæœ€æ–°æ–‡ç« ã€åˆ†ç±»ã€æ ‡ç­¾äº‘ï¼‰\n- å†…å®¹ç›®å½•\n- ä»£ç é«˜äº®\n- å“åº”å¼ç½‘é¡µè®¾è®¡\n- æ‡’åŠ è½½\n- ä¸»é¢˜é›†æˆæœ¬åœ°æœç´¢\n- Valine è¯„è®ºç³»ç»Ÿ\n- Baidu é“¾æ¥æäº¤ã€Google Analytics\n- Service Worker\n- MacOSã€IOS and Android dark mode (Safariã€Chrome)\n\n## å®‰è£…æ–¹æ³•\n\n### ä¸‹è½½\n\n```bash\ngit clone https://github.com/xzhih/hexo-theme-casper.git themes/hexo-casper\n```\n\n### æ¿€æ´»\n\næŠŠhexoé…ç½®æ–‡ä»¶ `_config.yml` é‡Œçš„ `theme` å­—æ®µå†…å®¹æ”¹ä¸º `hexo-casper` ã€‚\n\n### å‡çº§\n\nå»ºè®®å…ˆå¤‡ä»½ä¸€ä¸‹åœ¨æ‰§è¡Œä¸‹é¢çš„æ“ä½œã€‚\n\n```bash\ncd themes/casper \ngit pull\n```\n\n### æ·»åŠ ç»Ÿä¸€çš„æ–‡ç« æ¨¡æ¿å‚æ•°\n\næŠŠä¸‹é¢çš„å†…å®¹åŠ å…¥åˆ° `scaffolds/post.md`, \n\n```yaml\ncover_img:     # åœ¨æ–‡ç« æ‘˜è¦ä¸Šæ˜¾ç¤º\nfeature_img:   # åœ¨æ–‡ç« è¯¦ç»†é¡µé¢ä¸Šç½®é¡¶\ndescription:   # æ–‡ç« æè¿°\nkeywords:      # å…³é”®å­—\n```\n\n### valine è¯„è®ºç³»ç»Ÿ\n\nä½¿ç”¨æ–¹æ³•è¯·åˆ°ä»–çš„[å®˜ç½‘](https://valine.js.org)æŸ¥çœ‹ï¼Œå¹¶ç»“åˆä¸‹é¢çš„é…ç½®æ–‡ä»¶è¯¦ç»†æ·»åŠ appIDå’ŒappKey\n\n**æ·»åŠ å…³äºé¡µé¢**\n\n```bash\nhexo new page about\n```\n\n## è‡ªå®šä¹‰é…ç½®\n\nç¼–è¾‘ `themes/hexo-casper/_config.yml` è®¾ç½®ä½ æƒ³æ˜¾ç¤ºå‡ºæ¥çš„ç‰¹æ€§\n\n```yaml\n# Config\nrss:            # link\nfavicon: https://i.loli.net/2017/11/26/5a19c0b50432e.png\nblog_logo: \nheader_image: https://i.loli.net/2017/11/26/5a19c56faa29f.jpg\nbio: This is a demo\npost_toc: true\n\n# èœå•\nmenu:\n  About: /about\n  Archives: /archives\n  # å…¶ä»–çš„å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„æ¨¡æ¿æ·»åŠ \n\n# ä½œè€…\nauthor_image:   # é“¾æ¥\nauthor_bio:     # æè¿°\nauthor_location: # åœ°å€\n\n# ç¤¾äº¤é“¾æ¥\nsocial:\n  facebook: https://www.facebook.com\n  twitter: https://www.twitter.com\n  twitter: https://twitter.com\n  facebook: https://facebook\n  telegram:\n  bilibili:\n  youtube:\n  \n# æ’ä»¶ï¼ˆæ˜¾ç¤ºåœ¨ç½‘ç«™åº•éƒ¨ï¼‰\nwidgets:\n  recent_posts: true\n  category: true\n  tagcloud: true\n  # è¿™æ˜¯ä¸ªç®€æ´çš„ä¸»é¢˜ï¼Œæˆ‘è®¤ä¸º3ä¸ªå°±å¤Ÿäº†\n\n# æ–‡ç« å›¾ç‰‡ç›¸å†Œï¼ˆç‚¹å‡»å›¾ç‰‡å¯ä»¥æ”¾å¤§ï¼‰\n# https://github.com/dimsemenov/PhotoSwipe\nlightgallery: true\n\n# æ‡’åŠ è½½\n# é¦–é¡µå·²ç»é»˜è®¤å¼€å¯ï¼Œå…¶ä»–é¡µé¢åœ¨æ­¤å¼€å¯\n# https://github.com/dinbror/blazy\nlazyload: true\n\n# æœç´¢åŠŸèƒ½\nlocal_search: true\n\n# Valine è¯„è®ºç³»ç»Ÿ\n# https://valine.js.org\ncomment: false\nvaline:\n  notify: false # mail notifier , https://github.com/xCss/Valine/wiki \n  verify: false # Verification code\n  appId: # your leancloud application appid\n  appKey: # your leancloud application appkey\n  placeholder: Just go go # comment box placeholder\n  avatar: mm # gravatar style\n  pageSize: 10 # pagination size\n  visitor: true # page view record\n\n# PWA \n# ä½ éœ€è¦åœ¨ hexo ç›®å½•çš„ source æ–‡ä»¶å¤¹é‡Œåˆ›å»ºä¸€ä¸ª manifest.json æ–‡ä»¶\nmanifest: false\nservice_workers: false\n\nnavColor: '3c484e'\n\n# Baidu é“¾æ¥æäº¤\nbaidu: false\n\n# Google Analytics\ngoogleAnalytics: false\nGA_TRACKING_ID: UA-XXXXXXXXXX-1\n\n```\n\n## æœ¬åœ°æœç´¢åŠŸèƒ½å‚è€ƒ\n\nhttps://github.com/wzpan/hexo-generator-search \nhttps://github.com/SuperKieran/hexo-generator-search-zip\n\n## æºä¸»é¢˜çš„ç‰ˆæƒå£°æ˜å’Œ License \n\n[https://github.com/TryGhost/Casper/blob/master/LICENSE](https://github.com/TryGhost/Casper/blob/master/LICENSE)\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["web","hexo"],"categories":["æ•™ç¨‹"]},{"title":"å¦‚ä½•åœ¨è·¯ç”±å™¨ä¸Šæ ¼å¼åŒ–Uç›˜ã€ç¡¬ç›˜","url":"/format-Upan-partition/","content":"\n## å¼•è¨€\n\næœ¬æ•™ç¨‹é€‚ç”¨äºæ¢…æ—ã€padavanã€LEDEï¼ˆopenwrtï¼‰ç­‰å›ºä»¶\n\nä»¥ä¸‹å…·ä½“æ–¹æ³•éƒ½åŸºäº ext4ï¼ŒNTFS ç›¸å…³é”™è¯¯ä¸åšå›ç­”\n\nä½¿ç”¨sshè¿æ¥è·¯ç”±å™¨ï¼ŒæŠŠUç›˜æ’åˆ°è·¯ç”±å™¨ä¸Š\n\næˆ‘ä»¬éœ€è¦åœ¨å‘½ä»¤è¡Œè¿›è¡Œä»¥ä¸‹4æ­¥æ“ä½œï¼š\n\n## å®‰è£…fdisk\n\nä¸€èˆ¬æ¢…æ—ã€Padavan å›ºä»¶éƒ½ä¼šè‡ªå¸¦çš„ï¼Œä¸ç”¨å®‰è£…ï¼Œå¦‚æœæ²¡æœ‰åˆ™æŒ‰ç…§ä¸‹é¢ç»™å‡ºçš„å‘½ä»¤\n\n```bash\nopkg update\nopkg install fdisk\n# è¾“å‡ºConfiguring fdisk. å¹¶ä¸”æ²¡æœ‰é”™è¯¯\n# fdiskå°±å®‰è£…å¥½äº†\n```\n\n## æŸ¥çœ‹ä½ çš„è®¾å¤‡\n\n```bash\nfdisk -l \n# è¿™é‡Œå…ˆè¾“å‡ºç³»ç»Ÿåˆ†åŒºä¹‹ç±»çš„ä¸ç”¨ç®¡ï¼Œå¤–ç½®è®¾å¤‡ä¸€èˆ¬åœ¨æœ€å\nDisk /dev/sda: 30.7 GB, 30752000000 bytes\n64 heads, 32 sectors/track, 29327 cylinders\nUnits = cylinders of 2048 * 512 = 1048576 bytes\nDevice Boot      Start         End      Blocks  Id System\n/dev/sda1               2       29327    30029824  83 Linux\n```\n\nä¸Šé¢çš„ä¿¡æ¯æ³¨æ„çœ‹åˆ°å’Œä½ çš„å­˜å‚¨å¤§å°ä¸€æ ·çš„è®¾å¤‡ï¼Œæˆ‘çš„æ˜¯ `/dev/sda`ï¼Œåœ¨å®ƒé‡Œé¢æœ‰ä¸ª `/dev/sda1`çš„åˆ†åŒº\n\n## åˆ é™¤åˆ†åŒºã€æ–°å»ºåˆ†åŒº\n\nå…ˆå¸è½½ U ç›˜ï¼Œå¦‚æœæç¤º `No such file or directory` æ²¡å…³ç³»ï¼Œè¯´æ˜æœ¬æ¥å°±æ²¡æŒ‚è½½ä¸Š\n\n```bash\n# padavanã€æ¢…æ—å¯ä»¥æ‰§è¡Œä»¥ä¸‹è¿™ä¸ªæ¨å‡º usb\nejusb\n\n# å…¶ä»–å›ºä»¶ï¼Œæˆ–è€…æ¢…æ—ä½¿ç”¨ä»¥ä¸Šå‘½ä»¤æ— æ•ˆï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¸è½½åˆ†åŒº\numount /dev/sda1 \n```\n\nç„¶ååˆ†åŒº\n\n```bash\nfdisk /dev/sda # è¿™æ˜¯ä½ çš„è®¾å¤‡åˆ¥æ‰“æˆåˆ†åŒº\n\nWelcome to fdisk (util-linux 2.29.2).\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\nCommand (m for help): d \n# è¾“å…¥då›è½¦ï¼Œæˆ‘åªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œå®ƒè‡ªåŠ¨é€‰æ‹©äº†ï¼Œå¦‚æœä½ æœ‰å¤šä¸ªåˆ†åŒºï¼Œå¯ä»¥å¤šæ¬¡ä½¿ç”¨d\nSelected partition 1\nPartition 1 has been deleted.\n\nCommand (m for help): n # è¾“å…¥nä¼šè½¦ï¼Œåˆ›å»ºåˆ†åŒº\nPartition type\np   primary (0 primary, 0 extended, 4 free)\ne   extended (container for logical partitions)\n\nSelect (default p): p # é€‰æ‹©p\nPartition number (1-4, default 1): # è¾“å…¥ 1 å›è½¦\nFirst sector (2048-2065023, default 2048): # å›è½¦\nLast sector, +sectors or +size{K,M,G,T,P} (2048-2065023, default 2065023): # å›è½¦\nCreated a new partition 1 of type 'Linux' and of size 1007.3 MiB.\n\nCommand (m for help): w # è¾“å…¥ w å›è½¦ï¼Œä¿å­˜å¹¶é€€å‡º\nThe partition table has been altered.\nCalling ioctl() to re-read partition table.\nSyncing disks.\n```\n\nç»è¿‡ä»¥ä¸Šçš„æ“ä½œï¼Œä½ å¯ä»¥ç”¨ `fdisk -l` å‘½ä»¤æŸ¥çœ‹Uç›˜ä¸Šæ˜¯å¦åªæœ‰ä¸€ä¸ª Linux åˆ†åŒº\n\n```bash\nfdisk -l \n# æ‰¾åˆ°ä½ çš„è®¾å¤‡ å¯ä»¥çœ‹åˆ°IDä¸º83å°±å¯¹äº†\nDisk /dev/sda: 30.7 GB, 30752000000 bytes\n64 heads, 32 sectors/track, 29327 cylinders\nUnits = cylinders of 2048 * 512 = 1048576 bytes\nDevice Boot      Start         End      Blocks  Id System\n/dev/sda1               2       29327    30029824  83 Linux\n```\n\n## æ ¼å¼åŒ–åˆ†åŒº\n\nåˆ†åŒºå·²ç»æœ‰äº†ï¼Œç°åœ¨å¼€å§‹æ ¼å¼åŒ–\n\nç”¨ `mkfs.ext4` å‘½ä»¤æ ¼å¼åŒ–ï¼Œå¹¶ä¸”è®¾ç½®å·æ ‡ä¸º onmp\n\n**æ³¨æ„**ï¼Œå¦‚æœä¸‹é¢çš„å‘½ä»¤æç¤º `/dev/sda1 is mounted`ï¼Œåˆ™éœ€è¦å…ˆå¸è½½ U ç›˜ï¼Œå’Œåˆ†åŒºå‰å¸è½½çš„æ–¹æ³•ä¸€æ ·\n\n```bash\nmkfs.ext4 -m 0 -L onmp /dev/sda1 \n# å¦‚æœä½ çš„ç¡¬ç›˜æ¯”è¾ƒå¤§ï¼Œ256Gä»¥ä¸Šçš„è¯ï¼Œæ˜¯ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š\n# mkfs.ext4 -m 0 -L ONMP -T largefile /dev/sda1\n\nmke2fs 1.42.8 (20-Jun-2013)\nFilesystem label=onmp\nOS type: Linux\nBlock size=4096 (log=2)\nFragment size=4096 (log=2)\nStride=0 blocks, Stripe width=0 blocks\n1880480 inodes, 7507456 blocks\n0 blocks (0.00%) reserved for the super user\nFirst data block=0\nMaximum filesystem blocks=0\n230 block groups\n32768 blocks per group, 32768 fragments per group\n8176 inodes per group\nSuperblock backups stored on blocks:\n        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,\n        4096000\n\nAllocating group tables: done\nWriting inode tables: done\nCreating journal (32768 blocks): done\nWriting superblocks and filesystem accounting information: done\n\n```\n\nè¿™æ ·ï¼ŒUç›˜å°±è¢«æ ¼å¼åŒ–å®Œäº†ï¼Œæ‹”æ’ U ç›˜å¯ä»¥é‡æ–°æŒ‚è½½ï¼Œæˆ–è€…ä½ æƒ³ç”¨ä»¥ä¸‹å‘½ä»¤æŒ‚è½½ä¹Ÿè¡Œ\n\n```bash\nmkdir /mnt/onmp\nmount -t ext4 /dev/sda1 /mnt/onmp\n```\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n","tags":["shell","è·¯ç”±å™¨"],"categories":["æ•™ç¨‹"]},{"title":"ONMPå®‰è£…æ•™ç¨‹","url":"/onmp-installation/","content":"\n## å‰è¨€\n\nä¹‹å‰ç”¨è¿‡æè·¯ç”± 1sï¼Œåˆ·äº†æ©å±± Hå¤§çš„å›ºä»¶ï¼Œå‘ç°å†…ç½®äº† web ç¯å¢ƒï¼Œæ²¡æƒ³åˆ°ä¸€ä¸ªè·¯ç”±å™¨éƒ½èƒ½è·‘çš„åŠ¨ LNMPã€‚æˆ‘ä¹‹å‰æœ€æé™çš„å°è¯•å°±æ˜¯åœ¨ä¸€ä¸ª 4åˆ€3å¹´ çš„ sentris ovz å°é¸¡ä¸Šè·‘è¿‡ WordPress ï¼Œé‚£å°å°é¸¡ é…ç½®å¾ˆä½ï¼Œåªæœ‰ 64M çš„å†…å­˜ğŸ˜‚ã€‚ä¸è¿‡ LNMP æµç•…è¿è¡Œçš„å› ç´ æŒºå¤šï¼ŒPHP åƒ CPUã€MySQL åƒ IOï¼Œä¸åŒçš„ç¨‹åºè¡¨ç°ä¹Ÿä¸ä¸€æ ·ã€‚é‚£å°æè·¯ç”±è¢«æˆ‘æŠ˜è…¾äº†æ²¡ä¸¤ä¸‹å°±æ”¾å¼ƒäº†åœ¨ä¸Šé¢æ­ç½‘ç«™ï¼Œæ¯•ç«Ÿæ€§èƒ½å¤ªä½ã€‚\n\nåæ¥æˆ‘ä¸Šè½¦äº†æ–è®¯ K2Pï¼Œæ‹¿å›æ¥èŠ±äº†ä¸€ä¸ªæ™šä¸Šæ”¹å¥½äº† 32+512+usbï¼Œåˆ·çš„æ˜¯ç¯å¤§çš„ç¡¬æ”¹å›ºä»¶ï¼Œå°‘äº†Hå¤§å›ºä»¶çš„é‡Œé¢çš„ä¸°å¯Œæ‹“å±•ï¼Œæ„Ÿè§‰éƒ½ä¸å¯¹äº†ï¼Œk2p æ—¢ç„¶ç¡¬æ”¹äº†ï¼Œé‚£å°±å¥½å¥½ç©å®ƒï¼Œä¹‹å‰ä¸æ˜¯å«Œå¼ƒæ 1s çš„æ€§èƒ½ä¸è¶³å˜›ï¼Œç°åœ¨ K2P æ¯”èµ·å®ƒæ¥è¯´ï¼Œæ€§èƒ½å¼ºäº†ä¸€äº›ï¼Œè¿å­˜å¤§ã€CPUå¼ºã€è¿˜æ˜¯ USB3.0ï¼Œé‚£å°±å†™ä¸ªä¸€é”®å®‰è£… web ç¯å¢ƒå§ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ä¸ªé¡¹ç›®ã€‚\n\n## ç®€è¿°\n\nONMP æ˜¯ä¸€ä¸ª web ç¯å¢ƒå¿«é€Ÿå®‰è£…è„šæœ¬ï¼Œé€‚ç”¨äºå®‰è£…äº† [Entware](https://entware.net/) çš„è·¯ç”±å™¨ï¼Œç›®å‰å·²ç»åœ¨ Padavanã€LEDEï¼ˆopenwrtï¼‰ã€æ¢…æ—ä¸Šæµ‹è¯•æˆåŠŸã€‚\n\nå’Œ LNMP æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ\nLNMP ä»£è¡¨çš„æ˜¯ï¼šLinux ç³»ç»Ÿä¸‹ Nginx/MySQL/PHP è¿™ç§ç½‘ç«™æœåŠ¡å™¨æ¶æ„ï¼Œè€Œä¸ºäº†åŒºåˆ†è·¯ç”±å™¨ç¯å¢ƒçš„ä¸åŒï¼Œä½¿ç”¨çš„ ONMP è¿™ä¸ªå‘½åï¼Œæœ¬è´¨è¿˜æ˜¯ LNMPã€‚\n\né¡¹ç›®åœ°å€ï¼šhttps://github.com/xzhih/ONMP\n\n## ç‰¹æ€§\n\næ­¤è„šæœ¬ä¸ä»…è‡ªåŠ¨åŒ–å®‰è£… web ç¯å¢ƒï¼Œè¿˜å†…ç½®äº†ä¸€äº›å¥½ç”¨çš„ç½‘ç«™ç¨‹åºä¸€é”®å…é…ç½®å¿«é€Ÿå®‰è£…ã€‚\n\n```\nONMPå†…ç½®äº†ä»¥ä¸‹ç¨‹åºçš„ä¸€é”®å®‰è£…ï¼š\n(1) phpMyAdminï¼ˆæ•°æ®åº“ç®¡ç†å·¥å…·ï¼‰\n(2) WordPressï¼ˆä½¿ç”¨æœ€å¹¿æ³›çš„CMSï¼‰\n(3) Owncloudï¼ˆç»å…¸çš„ç§æœ‰äº‘ï¼‰\n(4) Nextcloudï¼ˆOwncloudå›¢é˜Ÿçš„æ–°ä½œï¼Œç¾è§‚å¼ºå¤§çš„ä¸ªäººäº‘ç›˜ï¼‰\n(5) h5aiï¼ˆä¼˜ç§€çš„æ–‡ä»¶ç›®å½•ï¼‰\n(6) Lycheeï¼ˆä¸€ä¸ªå¾ˆå¥½çœ‹ï¼Œæ˜“äºä½¿ç”¨çš„Webç›¸å†Œï¼‰\n(7) Kodexplorerï¼ˆå¯é“äº‘akaèŠ’æœäº‘åœ¨çº¿æ–‡æ¡£ç®¡ç†å™¨ï¼‰\n(8) Typecho (æµç•…çš„è½»é‡çº§å¼€æºåšå®¢ç¨‹åº)\n(9) Z-Blog (ä½“ç§¯å°ï¼Œé€Ÿåº¦å¿«çš„PHPåšå®¢ç¨‹åº)\n(10) DzzOffice (å¼€æºåŠå…¬å¹³å°)\n```\n\n## å®‰è£…æ•™ç¨‹\n\n### 1. å®‰è£… Entware\n\nEntware æ˜¯ä¸€ä¸ªé€‚ç”¨äºåµŒå…¥å¼ç³»ç»Ÿçš„è½¯ä»¶åŒ…åº“ï¼Œä½¿ç”¨ opkg åŒ…ç®¡ç†ç³»ç»Ÿè¿›è¡Œç®¡ç†ï¼Œç°åœ¨åœ¨å®˜æ–¹çš„æºä¸Šå·²ç»æœ‰è¶…è¿‡2000ä¸ªè½¯ä»¶åŒ…äº†ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸çš„ä¸°å¯Œ\n\nä¸åŒçš„å›ºä»¶ï¼Œå®‰è£…æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œè¯·è®¤å‡†å®‰è£…æ–¹å¼ï¼ˆè‡ªå·±æ˜¯ä»€ä¹ˆå›ºä»¶æ€»è¯¥æ‡‚å¾—å§ğŸ˜‚ï¼‰\n\n[åœ¨ Padavan ä¸Šä½¿ç”¨ Entware](https://zhih.me/Padavan-entware/)\n\n[åœ¨ LEDE ä¸Šä½¿ç”¨ Entware](https://zhih.me/LEDE-entware)\n\n[åœ¨æ¢…æ—ä¸Šä½¿ç”¨ Entware](https://zhih.me/Merlin-entware)\n\n### 2. å®‰è£…onmp\n\nä¸€é”®å‘½ä»¤ï¼Œå¤åˆ¶->ç²˜è´´->å›è½¦\n\n```bash\nsh -c \"$(curl -kfsSL https://raw.githubusercontent.com/xzhih/ONMP/master/oneclick.sh)\"\n```\n\nä¸€é•¿ä¸²çš„å¤åˆ¶å¦‚æœå‡ºé”™ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹ç»™å‡ºçš„å‘½ä»¤ï¼Œä¸€æ­¥æ­¥è¿›è¡Œå®‰è£…\n\n```bash\n# è¿›å…¥ entware æŒ‚è½½ç›®å½•\ncd /opt && opkg install wget unzip \n\n# ä¸‹è½½è½¯ä»¶åŒ…\nwget --no-check-certificate -O /opt/onmp.zip https://github.com/xzhih/ONMP/archive/master.zip \n\n# è§£å‹\nunzip /opt/onmp.zip\n\ncd /opt/onmp\n\n# è¿è¡Œ\nchmod +x ./onmp.sh \n./onmp.sh\n```\n\nè¦æ˜¯æ­£å¸¸è¿è¡Œåˆ°è„šæœ¬ï¼Œä¼šå‡ºç°ä¸‹é¢çš„æƒ…æ™¯ï¼Œé€‰1å®‰è£…å³å¯\n\n![å®‰è£…](https://pic.zhih.me/blog/posts/onmp-installation/å®‰è£….jpg)\n\næ­£å¸¸å®‰è£…ä¸­è¦æ˜¯å‡ºç°é”™è¯¯ï¼Œä¼šæœ‰é”™è¯¯ä¿¡æ¯ï¼Œæ ¹æ®æç¤ºæ“ä½œï¼Œç›®å‰å¾—åˆ°çš„å¤§å¤šæ•°åé¦ˆéƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼Œå› ä¸º entware çš„æºåœ¨å›½å¤–ï¼Œè€Œä¸”ä»–ä»¬çš„ç®¡ç†è€…è¯´ä¹‹å‰å—åˆ°äº†æ¥è‡ªäºšæ´²çš„ DDOSï¼Œæ‰€ä»¥å¯¹è¿™è¾¹é™æµäº†ï¼Œé€Ÿåº¦è¾ƒæ…¢ã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œå¯ä»¥å»çœ‹çœ‹å‰§ï¼Œæ²¡å‡†å›æ¥çš„æ—¶å€™å°±å¥½äº†ğŸ˜„\n\nå®‰è£…æˆåŠŸå¾—åˆ°çš„ç»“æœæ˜¯è¿™æ ·çš„\n\n![å®‰è£…æˆåŠŸ](https://pic.zhih.me/blog/posts/onmp-installation/å®‰è£…æˆåŠŸ.jpg)\n\nå¦‚æœä½ ä¹Ÿæ˜¯å’Œä¸Šå›¾ä¸€æ ·ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼ŒæˆåŠŸçš„å®‰è£…ä¸Šäº† ONMPï¼Œä½ å¯ä»¥å°½æƒ…çš„ç©è€äº†\n\n## ONMP è¯¦ç»†ä½¿ç”¨æ•™ç¨‹\n\n### åŸºæœ¬å‘½ä»¤ï¼š\n\n```\nç®¡ç†ï¼šonmp open\nå¯åŠ¨ã€åœæ­¢ã€é‡å¯ï¼šonmp start|stop|restart\næŸ¥çœ‹ç½‘ç«™åˆ—è¡¨ï¼šonmp list \n```\n\n### è®¾ç½®æ•°æ®åº“å¯†ç ï¼š\n\nè¾“å…¥ `onmp open` åé€‰æ‹©3ï¼Œä¼šæç¤º `Enter password:` ï¼Œè¿™ä¸ªæ—¶å€™è¦è¾“å…¥å½“å‰æ•°æ®åº“çš„å¯†ç ï¼Œæ¯”å¦‚æˆ‘åˆå§‹è®¾ç½®çš„æ•°æ®åº“å¯†ç æ˜¯ 123456ï¼Œå›è½¦åè¦æ˜¯å¯†ç æ­£ç¡®ï¼Œä¼šæç¤ºè¾“å…¥ä½ è¦è®¾ç½®çš„æ–°å¯†ç ï¼Œå›è½¦åä¼šæç¤ºå†æ¬¡è¾“å…¥ç¡®è®¤ã€‚ä¹Ÿå°±æ˜¯ï¼Œä¸€æ¬¡æ—§å¯†ç ï¼Œä¸¤æ¬¡æ–°å¯†ç ã€‚\n\nè¿™ä¸ªä½ç½®å¾ˆç®€å•ï¼Œä½†æ˜¯å¾ˆå¤šäººéƒ½è¯´æ”¹ä¸äº†å¯†ç ï¼Œå…¶å®æ˜¯æ²¡çœ‹æç¤ºï¼Œæ²¡è¾“å…¥æ—§å¯†ç ï¼Œæ‰€ä»¥æˆ‘å†™æ¸…æ¥šä¸€äº›ã€‚\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["onmp","shell"],"categories":["æ•™ç¨‹"]},{"title":"åœ¨Padavan ä¸Šä½¿ç”¨Entware","url":"/Padavan-entware/","content":"\n## å‰è¨€\n\nEntware æ˜¯ä¸€ä¸ªé€‚ç”¨äºåµŒå…¥å¼ç³»ç»Ÿçš„è½¯ä»¶åŒ…åº“ï¼Œä½¿ç”¨ opkg åŒ…ç®¡ç†ç³»ç»Ÿè¿›è¡Œç®¡ç†ï¼Œç°åœ¨åœ¨å®˜æ–¹çš„æºä¸Šå·²ç»æœ‰è¶…è¿‡ 2000 ä¸ªè½¯ä»¶åŒ…äº†ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸çš„ä¸°å¯Œ\n\nå®˜æ–¹åœ°å€ï¼š[Entware](https://entware.net/)\n\n## Uç›˜ã€ç¡¬ç›˜æ ¼å¼åŒ–ï¼ˆå¯é€‰ï¼‰\n\næˆ‘ä»¬çš„è®¾å¤‡æœ¬èº«çš„å‚¨å­˜è¾ƒå°‘ï¼Œè€Œä¸”å¦‚æœå“ªå¤©å´©äº†ï¼Œæ•°æ®è¿˜æœ‰æ‰¾ä¸å›çš„é£é™©ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æŠŠè½¯ä»¶åŒ…å’Œç¨‹åºå®‰è£…åˆ° U ç›˜ä¹‹ç±»çš„å¤–ç½®è®¾å¤‡ä¸Šï¼Œæ‰€ä»¥éœ€è¦å¯¹å®ƒè¿›è¡Œæ ¼å¼åŒ–ï¼Œä»¥ä¸‹æ•™ç¨‹å…¨åŸºäº ext4 åˆ†åŒºæ ¼å¼ï¼ŒNTFS æ ¼å¼æˆ‘ä¸ªäººä¸æ¨èä½¿ç”¨\n\næ ¼å¼åŒ–æ•™ç¨‹ï¼š[å¦‚ä½•åœ¨è·¯ç”±å™¨ä¸Šæ ¼å¼åŒ–Uç›˜ã€ç¡¬ç›˜](https://zhih.me/format-Upan-partition)\n\n## å®‰è£… Entware\n\n### 1. æ–°å»º opt æ–‡ä»¶å¤¹\n\n- å¦‚æœä½ æ˜¯åœ¨ç”µè„‘ä¸Šæ ¼å¼åŒ–çš„ U ç›˜ï¼Œå¹¶ä¸”çŸ¥é“æ€ä¹ˆåœ¨ç”µè„‘ä¸Šè¯»å– ext4 åˆ†åŒºï¼Œé‚£ä¹ˆåœ¨ ext4 åˆ†åŒºçš„æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª opt æ–‡ä»¶å¤¹\n\n- æˆ–è€…ä½ å¯ä»¥æŠŠ U ç›˜æ’åˆ°è·¯ç”±å™¨ä¸Šï¼Œå¼€å¯ samba å¹¶é€šè¿‡ç”µè„‘è®¿é—® sambaï¼Œåœ¨ U ç›˜ä¸‹åˆ›å»º opt æ–‡ä»¶å¤¹\n\n- å¦‚æœä½ ä¸Šé¢çš„ä¸ä¼šï¼Œå¹¶ä¸”æŒ‰ç…§æˆ‘çš„æ•™ç¨‹åœ¨è·¯ç”±å™¨ä¸Šæ ¼å¼åŒ– U ç›˜ï¼Œè¿˜å¯ä»¥æŒ‰ç…§ä»¥ä¸‹åšæ³•\n\n```bash\nejusb\nmkdir /media/onmp\nmount -t ext4 /dev/sda1 /media/onmp\n# /dev/sda1 æ˜¯ä½ çš„ ext4 åˆ†åŒº\n\nmkdir /media/onmp/opt\n```\n\nè¿™æ ·å°±åˆ›å»ºå¥½ opt æ–‡ä»¶å¤¹äº†ï¼Œä¹‹åè£…çš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šåœ¨é‡Œé¢\n\n### 2. å¼€å¯ Entware\n\nå…ˆå¸è½½ U ç›˜\n\n```bash\nejusb\n```\n\nç„¶ååœ¨è·¯ç”±å™¨ç®¡ç†é¡µæ‰“å¼€ Entware\n\n![åœ¨ Padavan ä¸Šä½¿ç”¨ entware ](https://pic.zhih.me/blog/posts/Padavan-entware/åœ¨Padavanä¸Šä½¿ç”¨entware.jpg)\n\næ‹”ä¸‹ U ç›˜å†é‡æ–°æ’å…¥ï¼Œç­‰ä¸€å°ä¼šå„¿\n\n### 3. æŸ¥çœ‹æ˜¯å¦æˆåŠŸæŒ‚è½½ /opt\n\nè¿›å…¥ shellï¼Œè¾“å…¥ `df -h`ï¼Œçœ‹åˆ° `/opt` æŒ‚è½½äº†å°±å¯¹äº†\n\n![æŸ¥çœ‹æ˜¯å¦æˆåŠŸæŒ‚è½½ /opt](https://pic.zhih.me/blog/posts/Padavan-entware/æŸ¥çœ‹æ˜¯å¦æˆåŠŸæŒ‚è½½.jpg)\n\nå¦‚æœ opt æ²¡æŒ‚è½½ï¼Œè¯´æ˜æ²¡å®‰è£…ä¸Šï¼Œè¯·ä¿è¯ opt æ–‡ä»¶å¤¹å·²ç»åˆ›å»ºæ­£ç¡®ï¼Œç¡®è®¤æ— è¯¯ï¼Œåˆ™å¯ä»¥è¿› shell è¾“å…¥ `opkg.sh` å›è½¦å®‰è£…\n\nå¦‚æœä½¿ç”¨å›ºä»¶è‡ªå¸¦è„šæœ¬å‡ºç°é”™è¯¯ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ä»¥ä¸‹è„šæœ¬\n\n```bash\nwget -O - http://bin.entware.net/mipselsf-k3.4/installer/generic.sh | /bin/sh\n```\n\n### æµ‹è¯• opkg å‘½ä»¤\n\nä»¥ä¸Šæ­¥éª¤ä¹‹åï¼Œä¸å‡ºæ„å¤–å°±è£…ä¸Šäº†ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æµ‹è¯•ä¸€ä¸‹\n\n```bash\nopkg update\n```\n\n## å…¶ä»–\n\n[åœ¨ LEDE ä¸Šä½¿ç”¨ Entware](https://zhih.me/LEDE-entware/)\n\n[åœ¨æ¢…æ—ä¸Šä½¿ç”¨ Entware](https://zhih.me/Merlin-entware/)\n\nONMP æ˜¯ä¸€ä¸ª web ç¯å¢ƒå¿«é€Ÿå®‰è£…è„šæœ¬ï¼Œé€‚ç”¨äºå®‰è£…äº† [Entware](https://entware.net/) çš„è·¯ç”±å™¨ï¼Œç›®å‰å·²ç»åœ¨ Padavanã€LEDEï¼ˆopenwrtï¼‰ã€æ¢…æ—ä¸Šæµ‹è¯•æˆåŠŸã€‚\n\n[ONMP å®‰è£…æ•™ç¨‹](https://zhih.me/onmp-installation/)\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n","tags":["onmp","entware"],"categories":["æ•™ç¨‹"]},{"title":"åœ¨LEDEä¸Šä½¿ç”¨Entware","url":"/LEDE-entware/","content":"\n## å¼•è¨€\n\nEntware æ˜¯ä¸€ä¸ªé€‚ç”¨äºåµŒå…¥å¼ç³»ç»Ÿçš„è½¯ä»¶åŒ…åº“ï¼Œä½¿ç”¨ opkg åŒ…ç®¡ç†ç³»ç»Ÿè¿›è¡Œç®¡ç†ï¼Œç°åœ¨åœ¨å®˜æ–¹çš„æºä¸Šå·²ç»æœ‰è¶…è¿‡2000ä¸ªè½¯ä»¶åŒ…äº†ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸çš„ä¸°å¯Œ\n\nå®˜æ–¹åœ°å€ï¼š[Entware](https://entware.net/)\n\n## Uç›˜ã€ç¡¬ç›˜æ ¼å¼åŒ–ï¼ˆå¯é€‰ï¼‰\n\næˆ‘ä»¬çš„è®¾å¤‡æœ¬èº«çš„å‚¨å­˜è¾ƒå°‘ï¼Œè€Œä¸”å¦‚æœå“ªå¤©å´©äº†ï¼Œæ•°æ®è¿˜æœ‰æ‰¾ä¸å›çš„é£é™©ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æŠŠè½¯ä»¶åŒ…å’Œç¨‹åºå®‰è£…åˆ°Uç›˜ä¹‹ç±»çš„å¤–ç½®è®¾å¤‡ä¸Šï¼Œæ‰€ä»¥éœ€è¦å¯¹å®ƒè¿›è¡Œæ ¼å¼åŒ–ï¼ŒNTFS æ ¼å¼æˆ‘ä¸ªäººä¸æ¨èä½¿ç”¨\n\næ ¼å¼åŒ–æ•™ç¨‹ï¼š[å¦‚ä½•åœ¨è·¯ç”±å™¨ä¸Šæ ¼å¼åŒ–Uç›˜ã€ç¡¬ç›˜](https://zhih.me/format-Upan-partition)\n\n## ä¸€é”®å®‰è£…\n\nç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥å®ç°ä¸€é”®å®‰è£…ï¼Œæ­¤è„šæœ¬åªæ”¯æŒ ext4 åˆ†åŒº\n\nè¿è¡Œå‘½ä»¤ï¼Œé€‰æ‹©è¦å®‰è£…åˆ°çš„åˆ†åŒºï¼Œç­‰å¾…å®‰è£…å®Œæˆ\n\n```bash \nsh -c \"$(curl -kfsSL https://raw.githubusercontent.com/xzhih/ONMP/master/lede-ent.sh)\"\n```\n\nå¦‚æœæç¤ºæ‰¾ä¸åˆ° curl å‘½ä»¤ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•\n\n```bash\ncd /tmp\nwget -c -O https://raw.githubusercontent.com/xzhih/ONMP/master/lede-ent.sh\nchmod +x ./lede-ent.sh\n./lede-ent.sh\n```\n\nä¸€é”®å®‰è£…å¦‚æœå‡ºé”™ï¼Œæˆ–è€…é‡å¯å Entware å¤±æ•ˆï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ‰‹åŠ¨å®‰è£…\n\n## æ‰‹åŠ¨å®‰è£…\n\næ‰‹åŠ¨å®‰è£…å¯ä¸€é”®å®‰è£…ä¸åŒï¼Œä¸€é”®å®‰è£…ä½¿ç”¨è½¯è¿æ¥ opt çš„æ–¹å¼ï¼Œè€Œæ‰‹åŠ¨åˆ™æ˜¯ä»¥æŒ‚è½½ç‚¹çš„æ–¹å¼ï¼Œå¯ä»¥è¯´æ›´ç¨³å®š\n\n### Uç›˜æŒ‚è½½\n\nåˆ†åŒºã€æ ¼å¼éƒ½æ²¡é—®é¢˜ä¹‹åï¼Œå¼€å§‹æŒ‚è½½\n\n```bash\nmkdir /mnt/onmp\n```\n\n#### æŒ‚è½½æ–¹æ³•1\n\n```bash\nmount -t ext4 /dev/sda1 /mnt/onmp\n# è¿™æ ·å°±æŒ‚è½½ä¸Šäº†\n\ndf -h\nFilesystem                Size      Used Available Use% Mounted on\n/dev/sda1               975.5M      2.5M    906.6M   0% /mnt/onmp\n# å¯ä»¥çœ‹åˆ°å·²ç»æŒ‚è½½\n```\n\n#### æŒ‚è½½æ–¹æ³•2ï¼ˆæ¨èï¼‰\n\n```bash\nvi /etc/fstab # æŒ‰ä¸€ä¸‹iç¼–è¾‘æ–‡ä»¶\n\n# æ·»åŠ ä¸‹é¢è¿™ä¸€è¡Œ\n/dev/sda1 /mnt/onmp ext4 defaults 0 1 \n# æŒ‰ä¸€ä¸‹Escå†è¾“å…¥å†’å·`:`ï¼Œè¾“å…¥wqå›è½¦ä¿å­˜\n\n# ä»¥åæ¯æ¬¡è¦æŒ‚è½½å°±ç›´æ¥è¾“å…¥è¿™ä¸ªå‘½ä»¤\nmount -a \n```\n\nå¼€æœºè‡ªåŠ¨æŒ‚è½½\n\n```bash\nvi /etc/rc.local # ç¼–è¾‘ï¼ŒvimåŸºæœ¬ç”¨æ³•å’Œä¸Šé¢ä¸€æ ·\n\n# åœ¨exit 0ä¹‹å‰æ·»åŠ ä»¥ä¸‹å‘½ä»¤ï¼Œå¼€æœºåä¼šè‡ªåŠ¨æ‰§è¡ŒæŒ‚è½½\nmount -a \n```\n\n### å®‰è£…å’Œä½¿ç”¨ Entware\n\n#### 1. æŒ‚è½½opt\n\nåœ¨Uç›˜ä¸Šåˆ›å»ºä¸€ä¸ªç©ºçš„ opt æ–‡ä»¶å¤¹\n\n```bash\nmkdir /mnt/onmp/opt\n```\n\nåœ¨ç³»ç»Ÿæ ¹ç›®å½•åˆ›å»º opt æ–‡ä»¶å¤¹ï¼Œå¹¶ç»‘å®šUç›˜çš„ opt æ–‡ä»¶å¤¹\n\n```bash\nmkdir /opt\nmount -o bind /mnt/onmp/opt /opt\n# å¯ä»¥ç”¨ mount æˆ– df -h å‘½ä»¤æŸ¥çœ‹æ˜¯å¦æŒ‚è½½æˆåŠŸ\n```\n\n#### 2. è¿è¡Œ Entware å®‰è£…å‘½ä»¤\n\nä¸åŒçš„ CPU å¹³å°æœ‰ä¸åŒçš„å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ `uname -m` å‘½ä»¤æŸ¥çœ‹å¹³å°\n\n- armv5\n\n```bash\nwget -O - http://bin.entware.net/armv5sf-k3.2/installer/generic.sh | /bin/sh\n```\n\n- armv7\n\n```bash\nwget -O - http://bin.entware.net/armv7sf-k3.2/installer/generic.sh | /bin/sh\n```\n\n- armv8 (aarch64)\n\n```bash\nwget -O - http://bin.entware.net/aarch64-k3.10/installer/generic.sh | /bin/sh\n```\n\n- x86-64\n\n```bash\nwget -O - http://bin.entware.net/x64-k3.2/installer/generic.sh | /bin/sh\n```\n\n- MIPS\n\n```bash\nwget -O - http://bin.entware.net/mipselsf-k3.4/installer/generic.sh | /bin/sh\n```\n\nåœ¨è¾“å…¥å‘½ä»¤ä¹‹åä¹‹åä¼šè‡ªå·±è·‘èµ·æ¥ï¼Œå‡ºç°ä»¥ä¸‹ç»“æœå°±ä»£è¡¨æˆåŠŸï¼Œæ²¡æˆåŠŸçš„è®°å¾—æŠŠUç›˜ä¸Šçš„optæ–‡ä»¶å¤¹æ¸…ç©ºå†æ¥\n\n```\nInfo: Congratulations!\nInfo: If there are no errors above then Entware was successfully initialized.\n```\n\n#### 3. å¼€æœºå¯åŠ¨\n\nç¼–è¾‘ `/etc/rc.local` å°†ä»¥ä¸‹ä»£ç åŠ åœ¨ `exit 0` ä¹‹å‰ï¼Œ`mount -a` ä¹‹å\n\n```\nmkdir -p /opt\nmount -o bind /mnt/onmp/opt /opt\n/opt/etc/init.d/rc.unslung start\n```\n\n#### 4. ç¯å¢ƒå˜é‡\n\nç¼–è¾‘ `/etc/profile` åœ¨ä»–çš„æœ€ååŠ å…¥ä»¥ä¸‹ä»£ç \n\n```\n. /opt/etc/profile\n```\n\nè¿™æ ·å¼€æœºä¹‹åå°†ä¼šæ·»åŠ  `/opt/bin` å’Œ `/opt/sbin` åˆ°ç¯å¢ƒå˜é‡ PATH é‡Œ\n\n**æ³¨æ„**ï¼Œ`.` çš„åé¢æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä¸æ˜¯è¿ç€çš„\n\n#### 5. é‡å¯\n\né‡å¯ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤æ£€æŸ¥æ˜¯å¦æˆåŠŸ\n\n```bash\n# æ£€æŸ¥ç¯å¢ƒå˜é‡\necho $PATH\n# å¯ä»¥çœ‹åˆ°å·²ç»æœ‰/optçš„è·¯å¾„äº†\n/opt/bin:/opt/sbin:/usr/sbin:/usr/bin:/sbin:/bin \n\n# æ£€æŸ¥ `/opt` æŒ‚è½½æƒ…å†µ\ndf -h\n/dev/sda1               975.5M     13.9M    895.2M   2% /mnt/onmp # Uç›˜æŒ‚è½½æˆåŠŸ\n/dev/sda1               975.5M     13.9M    895.2M   2% /opt # optæŒ‚è½½æˆåŠŸ\n\n# opkg æ›´æ–°æ•°æ®\nopkg update\nDownloading http://pkg.entware.net/binaries/x86-64/Packages.gz \nUpdated list of available packages in /opt/var/opkg-lists/packages # æˆåŠŸ\n```\n\nç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå·²ç»å¯ä»¥ä» `Entware` ä¸Šè¿›è¡Œä¸‹è½½å®‰è£…åŒ…å¹¶å®‰è£…åˆ°Uç›˜ä¸Š\n\nè¿™ä¸‹å¯ä»¥äº«å—ä¸°å¯Œçš„è½¯ä»¶åŒ…ï¼Œè¿˜ä¸å ç”¨å†…éƒ¨å‚¨å­˜ç©ºé—´ï¼Œéå¸¸é€‚åˆLEDEè½¯è·¯ç”±\næˆ‘çš„ onmp ä¸€é”®åŒ…ä¹Ÿå¯ä»¥åœ¨ LEDE ä¸Šä½¿ç”¨äº†\n\n## Tips\n\næ¯æ¬¡å‡çº§å›ºä»¶åå¦‚æœå¤±æ•ˆäº†ï¼Œé‡æ–°è®¾ç½®å¼€æœºå¯åŠ¨å’Œç¯å¢ƒå˜é‡å³å¯\n\n## PS \n\n[åœ¨æ¢…æ—ä¸Šä½¿ç”¨Entware](https://zhih.me/Merlin-entware/)\n\n[åœ¨Padavanä¸Šä½¿ç”¨entware](https://zhih.me/Padavan-entware/)\n\nONMP æ˜¯ä¸€ä¸ª web ç¯å¢ƒå¿«é€Ÿå®‰è£…è„šæœ¬ï¼Œé€‚ç”¨äºå®‰è£…äº† [Entware](https://entware.net/) çš„è·¯ç”±å™¨ï¼Œç›®å‰å·²ç»åœ¨ Padavanã€LEDEï¼ˆopenwrtï¼‰ã€æ¢…æ—ä¸Šæµ‹è¯•æˆåŠŸã€‚\n\n[ONMP å®‰è£…æ•™ç¨‹](https://zhih.me/onmp-installation/)\n\n## å‚è€ƒ\n\n[Install on Synology NAS](https://github.com/Entware/Entware/wiki/Install-on-Synology-NAS)\n\n[How To Configure Routers Asus RT-N56U/RT-N65U For Entware Usage](https://bitbucket.org/padavan/rt-n56u/wiki/EN/HowToConfigureEntware)\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n","tags":["LEDE","onmp","entware"],"categories":["æ•™ç¨‹"]},{"title":"åœ¨æ¢…æ—ä¸Šä½¿ç”¨Entware","url":"/Merlin-entware/","content":"\n## å¼•è¨€\n\nEntware æ˜¯ä¸€ä¸ªé€‚ç”¨äºåµŒå…¥å¼ç³»ç»Ÿçš„è½¯ä»¶åŒ…åº“ï¼Œä½¿ç”¨ opkg åŒ…ç®¡ç†ç³»ç»Ÿè¿›è¡Œç®¡ç†ï¼Œç°åœ¨åœ¨å®˜æ–¹çš„æºä¸Šå·²ç»æœ‰è¶…è¿‡ 2000 ä¸ªè½¯ä»¶åŒ…äº†ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸çš„ä¸°å¯Œ\n\nå®˜æ–¹åœ°å€ï¼š[Entware](https://entware.net/)\n\n## Uç›˜ã€ç¡¬ç›˜æ ¼å¼åŒ–ï¼ˆå¯é€‰ï¼‰\n\næˆ‘ä»¬çš„è®¾å¤‡æœ¬èº«çš„å‚¨å­˜è¾ƒå°‘ï¼Œè€Œä¸”å¦‚æœå“ªå¤©å´©äº†ï¼Œæ•°æ®è¿˜æœ‰æ‰¾ä¸å›çš„é£é™©ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æŠŠè½¯ä»¶åŒ…å’Œç¨‹åºå®‰è£…åˆ°Uç›˜ä¹‹ç±»çš„å¤–ç½®è®¾å¤‡ä¸Šï¼Œæ‰€ä»¥éœ€è¦å¯¹å®ƒæ ¼å¼åŒ–ä¸º ext4ï¼ŒNTFS æ ¼å¼ä¸æ¨èä½¿ç”¨\n\næ ¼å¼åŒ–æ•™ç¨‹ï¼š[å¦‚ä½•åœ¨è·¯ç”±å™¨ä¸Šæ ¼å¼åŒ–Uç›˜ã€ç¡¬ç›˜](https://zhih.me/format-Upan-partition)\n\n## Uç›˜æŒ‚è½½ï¼ˆå¯é€‰ï¼‰\n\næ¢…æ—å›ºä»¶å¯ä»¥åœ¨æ’å…¥ç£ç›˜çš„æ—¶å€™è‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ç³»ç»Ÿå¹¶æŒ‚è½½ï¼Œæ‰€ä»¥è¯´æ˜¯ç›¸å½“æ–¹ä¾¿äº†ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½ä¸éœ€è¦æ‰§è¡Œè¿™ä¸€æ­¥ï¼Œä¸è¿‡æœ‰äº›å›ºä»¶å¯èƒ½è¿˜æ²¡æœ‰å¾ˆå®Œå–„ï¼Œæ‰€ä»¥æˆ‘ç»™å‡ºä»¥ä¸‹ä¸€ç§æŒ‚è½½çš„æ–¹æ³•ï¼Œä¾›å‚è€ƒã€‚\n\nåˆ†åŒºã€æ ¼å¼éƒ½æ²¡é—®é¢˜ä¹‹åï¼Œå¼€å§‹æŒ‚è½½\n\n```bash\nmkdir /mnt/sda1\nmount -t ext4 /dev/sda1 /mnt/sda1/\n# è¿™æ ·å°±æŒ‚è½½ä¸Šäº†\ndf -h\nFilesystem                Size      Used Available Use% Mounted on\n/dev/sda1               975.5M      2.5M    906.6M   0% /tmp/mnt/sda1\n# å¯ä»¥çœ‹åˆ°å·²ç»æŒ‚è½½\n```\n\n## å®‰è£…å’Œä½¿ç”¨ Entware\n\næ¢…æ—å†…ç½®äº†ä¸€ä¸ªå®‰è£…å‘½ä»¤å¾ˆæ–¹ä¾¿\n\n```bash\nentware-setup.sh\n\n# ç„¶åä¼šæç¤ºä½ é€‰æ‹©å“ªä¸ªåˆ†åŒºï¼Œå°±é€‰æ‹©åˆšæ‰æŒ‚è½½çš„é‚£ä¸ª\nÂ·Â·Â·çœç•¥\nInfo:  Looking for available partitions...\n[1] --> /tmp/mnt/sda1\n=>  Please enter partition number or 0 to exit\n[0-1]: 1 # é€‰1å›è½¦\nÂ·Â·Â·çœç•¥\n# è·‘å®Œä¹‹ååªè¦ä¸æç¤ºé”™è¯¯ï¼Œå°±æ˜¯å®‰è£…æˆåŠŸäº†\n```\n\nç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå·²ç»å¯ä»¥ä» Entware ä¸Šè¿›è¡Œä¸‹è½½å®‰è£…åŒ…å¹¶å®‰è£…åˆ°Uç›˜ä¸Š\n\nè¿™ä¸‹å¯ä»¥äº«å—ä¸°å¯Œçš„è½¯ä»¶åŒ…ï¼Œè¿˜ä¸å ç”¨å†…éƒ¨å‚¨å­˜ç©ºé—´\n\n## PS \n\n[åœ¨Padavanä¸Šä½¿ç”¨entware](https://zhih.me/Padavan-entware/)\n\n[åœ¨LEDEä¸Šä½¿ç”¨Entware](https://zhih.me/LEDE-entware/)\n\nONMP æ˜¯ä¸€ä¸ª web ç¯å¢ƒå¿«é€Ÿå®‰è£…è„šæœ¬ï¼Œé€‚ç”¨äºå®‰è£…äº† [Entware](https://entware.net/) çš„è·¯ç”±å™¨ï¼Œç›®å‰å·²ç»åœ¨ Padavanã€LEDEï¼ˆopenwrtï¼‰ã€æ¢…æ—ä¸Šæµ‹è¯•æˆåŠŸã€‚\n\n[ONMP å®‰è£…æ•™ç¨‹](https://zhih.me/onmp-installation/)\n\n>æœ¬æ–‡ç« å‘è¡¨äºåº•å™ªåšå®¢ https://zhih.me , è½¬è½½è¯·æ³¨æ˜\n>ç›´æ¥å·çš„äººï¼Œä½ æ‰“çƒçœŸè”¡\n\n","tags":["onmp","entware","æ¢…æ—"],"categories":["æ•™ç¨‹"]}]